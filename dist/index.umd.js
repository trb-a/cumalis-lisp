!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((r="undefined"!=typeof globalThis?globalThis:r||self).Scheme={})}(this,(function(r){"use strict";function e(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.push.apply(t,n)}return t}function t(r){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e(Object(n),!0).forEach((function(e){o(r,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}))}return r}function n(r){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}function a(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function o(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function i(r,e){return l(r)||function(r,e){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null==t)return;var n,a,o=[],i=!0,u=!1;try{for(t=t.call(r);!(i=(n=t.next()).done)&&(o.push(n.value),!e||o.length!==e);i=!0);}catch(r){u=!0,a=r}finally{try{i||null==t.return||t.return()}finally{if(u)throw a}}return o}(r,e)||s(r,e)||p()}function u(r){return l(r)||f(r)||s(r)||p()}function c(r){return function(r){if(Array.isArray(r))return m(r)}(r)||f(r)||s(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(r){if(Array.isArray(r))return r}function f(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function s(r,e){if(r){if("string"==typeof r)return m(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?m(r,e):void 0}}function m(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=s(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){t=t.call(r)},n:function(){var r=t.next();return i=r.done,r},e:function(r){u=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(u)throw o}}}}var d,b,y,g="cumalis-lisp",h="0.5.4",w={quote:"'",quasiquote:"`",unquote:",","unquote-splicing":",@"},S=/^(?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+$/,j={"":"\\a","\b":"\\b","\t":"\\t","\n":"\\n","\r":"\\r",'"':'\\"',"\\":"\\\\","|":"\\|"},N=function(r){var e,t="",n="",a=v(r);try{for(a.s();!(e=a.n()).done;){var o=e.value,i=o.length>2&&0===o.indexOf('""')?o.replace(/^""/,"").replace(/""$/,""):o;t=t+(""===t||"("===n.slice(0,1)||")"===o.slice(-1)||Object.values(w).indexOf(n)>=0?"":" ")+i,n=o}}catch(r){a.e(r)}finally{a.f()}return t},x=function(r){return function r(e){var t,n=[],a=v(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;if("string"==typeof o)n.push(o);else if(o instanceof Array)if("string"==typeof o[0]&&Object.values(w).includes(o[0]))n.push.apply(n,c(r(o)));else if("#"===o[0]||"#u8"===o[0]){if(2!==o.length||!(o[1]instanceof Array))throw new Error("Illegal token tree: #/#u8 must have only one token array");n.push("".concat(o[0],"(")),n.push.apply(n,c(r(o[1]))),n.push(")")}else if("string"==typeof o[0]&&/^#\d+=/.exec(o[0])){if(2!==o.length)throw new Error("Illegal token tree: datum label must have the content");n.push.apply(n,[o[0]].concat(c(r(o.splice(1)))))}else n.push("("),n.push.apply(n,c(r(o))),n.push(")")}}catch(r){a.e(r)}finally{a.f()}return n}(r)},E=function(r,e){var t=null!=e?e:{},a=t.extended,o=void 0!==a&&a,u=t.style,l=void 0===u?"write":u,f=t.labels,s=void 0===f?"cyclic":f,m=t.maxdepth,p=void 0===m?1/0:m,v=new Set,d=new Set;!function r(e,t,n){F.Object(e),!o&&t>p||(o||!("cyclic"===s&&n.has(e)||"shared"===s&&v.has(e))?(v.add(e),n.add(e),R.Pair(e)?(r(e[1],t+1,n),r(e[2],t+1,n)):R.Vector(e)&&e[1].forEach((function(e){return r(e,t+1,n)}))):d.add(e))}(r,0,new Set);var b=new Map;return function r(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(F.Object(e),!o&&t>p)return"...";if(!a&&!o&&d.has(e)){if(b.has(e))return"#".concat(b.get(e),"#");var u=b.size+1;b.set(e,u);var f=r(e,t,!0);return["#".concat(u,"="),f]}switch(e[0]){case"<symbol>":return o||S.test(e[1])?e[1]:"|"+e[1].replace(/[\x00-\x1f\x7f"|\\]/g,(function(r){var e,t;return null!==(e=j[r])&&void 0!==e?e:"\\x".concat(null===(t=r.codePointAt(0))||void 0===t?void 0:t.toString(16))}))+"|";case"<null>":return o?null:[];case"<string>":return o?e[1]:"display"!==l?'"'+e[1].replace(/[\x00-\x1f\x7f]"|\\/g,(function(r){var e,t;return null!==(e=j[r])&&void 0!==e?e:"\\x".concat(null===(t=r.codePointAt(0))||void 0===t?void 0:t.toString(16))}))+'"':'""'+e[1]+'""';case"<number>":return o?P(e):"".concat(e[1]);case"<boolean>":return o?e[1]:e[1]?"#t":"#f";case"<character>":if(o)return e[1];if("display"!==l){var s,m=null!==(s=Object.entries(or).find((function(r){return i(r,2)[1]===e[1]})))&&void 0!==s?s:[],v=i(m,1),y=v[0];return"#\\".concat(null!=y?y:e[1])}return'""'+e[1]+'""';case"<vector>":return["#",c(e[1].map((function(e){return r(e,t+1)})))];case"<bytevector>":return["#u8",c(e[1].map((function(r){return"".concat(r)})))];case"<pair>":var g=i(e,3),h=g[1],N=g[2];return"<null>"===N[0]?[r(h,t+1)]:"<pair>"!==N[0]?[r(h,t+1),".",r(N,t+1)]:"<symbol>"===h[0]&&w[h[1]]?[w[h[1]]].concat(c(r(N,t+1))):[r(h,t+1)].concat(c(r(N,t+1)));case"<js>":return o?["&",e[1]]:"#<$js[".concat(null===e[1]?"null":n(e[1]),"]>");case"<procedure>":return o?e:"built-in"===e[1]?"#<procedure[built-in/".concat(e[2],"]>"):"#<procedure[".concat(e[1],"]>");default:return o?e:"#".concat(e[0])}}(r,0)},I=function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=E(r,t(t({maxdepth:8},e),{},{extended:!1})),a=x([n]);return N(a)}catch(r){return"<!!WRITE-ERROR!!>"}},O=function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=E(r,t(t({},e),{},{extended:!1}));if(!(n instanceof Array&&"begin"===n[0]))throw new Error('fromASTToText error: The top of AST is must be a "begin" expression.');var a=x(n.slice(1));return N(a)},P=function(r){return"number"==typeof r[1]?r[1]:"+inf.0"===r[1]?1/0:"-inf.0"===r[1]?-1/0:NaN},B=function(r){return D.Number(Number.isFinite(r)?Number.isNaN(r)?"+nan.0":r:r<0?"-inf.0":"+inf.0")},C=function(r){return r[2]},A=function(r){return r[1]},k=function(r){return r[2]},L=function(r){for(var e=[],t=r;t;t=k(t))e.push(t);return e},V=function(r){return r[1]},z=function(r,e){var t,n,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=V(r),u=i.env,c=i.handler,l=i.depth,f=i.info;return["#CALL-STACK#",{depth:l+1,env:null!==(t=o.env)&&void 0!==t?t:u,expr:e,want:null,oper:null,args:null,before:null!==(n=o.before)&&void 0!==n?n:null,after:null!==(a=o.after)&&void 0!==a?a:null,handler:c,info:R.Pair(e)&&e[4]||f},r]},M=function(r,e){var t,n,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=V(r),u=i.env,c=i.handler,l=i.depth,f=i.info,s=i.before,m=i.after;return["#CALL-STACK#",{depth:l,env:null!==(t=o.env)&&void 0!==t?t:u,expr:e,want:null!==(n=o.want)&&void 0!==n?n:null,oper:null!==(a=o.oper)&&void 0!==a?a:null,args:null,before:void 0===o.before?s:o.before,after:void 0===o.after?m:o.after,handler:void 0!==o.handler?o.handler:c,info:R.Pair(e)&&e[4]||f},k(r)]},T=function(r){return[r[0],{},r]},D={Symbol:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<symbol>"].concat(e)},String:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<string>"].concat(e)},Number:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<number>"].concat(e)},Boolean:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<boolean>"].concat(e)},Character:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<character>"].concat(e)},Pair:function(r,e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;return n?["<pair>",r,e,t,n]:["<pair>",r,e,t]},Null:function(){return["<null>"]},Vector:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<vector>"].concat(e)},ByteVector:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<bytevector>"].concat(e)},EndOfFile:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<end-of-file>"].concat(e)},Procedure:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<procedure>"].concat(e)},Port:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<port>"].concat(e)},RecordType:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<record-type>"].concat(e)},Record:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<record>"].concat(e)},SyntaxRules:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<syntax-rules>"].concat(e)},Parameter:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<parameter>"].concat(e)},MultiValue:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<multi-value>"].concat(e)},Exception:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<exception>"].concat(e)},Undefined:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<undefined>"].concat(e)},Promise:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<promise>"].concat(e)},Error:function(r,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return["<error>",r,e,t]},Continuation:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<continuation>"].concat(e)},JS:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["<js>"].concat(e)},List:function(r){function e(){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return e.reverse().reduce((function(r,e){return["<pair>",e,r,!1]}),["<null>"])})),Suspend:function(r){function e(){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["#SUSPEND#"].concat(e)})),PromiseContinuation:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["#PROMISE-CONTINUATION#"].concat(e)},StaticNS:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["#STATIC-NS-STACK#"].concat(e)},DynamicNS:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["#DYNAMIC-NS-STACK#"].concat(e)},HandlerStack:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return["#HANDLER-STACK#"].concat(e)}},Q={Call:function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return D.List.apply(D,[r].concat(t))},CallBuiltIn:function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return D.List.apply(D,[D.Procedure("built-in",r)].concat(t))},Lambda:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return R.List(e[0])?Q.CallBuiltIn.apply(Q,["lambda"].concat(c(e))):Q.CallBuiltIn.apply(Q,["lambda",K(e[0],e[1])].concat(c(e.slice(2))))},CallThunk:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return Q.Call(Q.CallBuiltIn.apply(Q,["lambda",["<null>"]].concat(e)))},Begin:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return Q.CallBuiltIn.apply(Q,["begin"].concat(e))},Quote:function(r){return Q.CallBuiltIn("quote",r)},Set:function(r,e){return Q.CallBuiltIn("set!",r,e)},Raise:function(r){return Q.CallBuiltIn("raise",r)},RaiseContinuable:function(r){return Q.CallBuiltIn("raise-continuable",r)},Let:function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Q.CallBuiltIn.apply(Q,["let",D.List.apply(D,c(r.map((function(r){return D.List.apply(D,c(r))}))))].concat(t))},If:function(r,e,t){return t?Q.CallBuiltIn("if",r,e,t):Q.CallBuiltIn("if",r,e)},And:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return Q.CallBuiltIn.apply(Q,["and"].concat(e))},Or:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return Q.CallBuiltIn.apply(Q,["or"].concat(e))},Cond:function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Q.CallBuiltIn.apply(Q,["cond",r].concat(t))},Case:function(r,e){return Q.CallBuiltIn("case",r,D.List.apply(D,c(e.map((function(r){return D.List.apply(D,c(r))})))))},Define:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return Q.CallBuiltIn.apply(Q,["define"].concat(e))},DefineValues:function(r,e){return Q.CallBuiltIn("define-values",R.List(r)?r:D.List.apply(D,c(r)),e)},Append:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return Q.CallBuiltIn.apply(Q,["append"].concat(e))},Cons:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return Q.CallBuiltIn.apply(Q,["cons"].concat(e))},Values:function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return Q.CallBuiltIn.apply(Q,["values"].concat(e))},BeginIfMultiple:function(){return 0===arguments.length?["<undefined>"]:1===arguments.length?arguments.length<=0?void 0:arguments[0]:Q.Begin.apply(Q,arguments)}},R={Symbol:function(r){return r instanceof Array&&"<symbol>"===r[0]},String:function(r){return r instanceof Array&&"<string>"===r[0]},Number:function(r){return r instanceof Array&&"<number>"===r[0]},Boolean:function(r){return r instanceof Array&&"<boolean>"===r[0]},Character:function(r){return r instanceof Array&&"<character>"===r[0]},Pair:function(r){return r instanceof Array&&"<pair>"===r[0]},Null:function(r){return r instanceof Array&&"<null>"===r[0]},Vector:function(r){return r instanceof Array&&"<vector>"===r[0]},ByteVector:function(r){return r instanceof Array&&"<bytevector>"===r[0]},EndOfFile:function(r){return r instanceof Array&&"<end-of-file>"===r[0]},Port:function(r){return r instanceof Array&&"<port>"===r[0]},RecordType:function(r){return r instanceof Array&&"<record-type>"===r[0]},Record:function(r){return r instanceof Array&&"<record>"===r[0]},MultiValue:function(r){return r instanceof Array&&"<multi-value>"===r[0]},SyntaxRules:function(r){return r instanceof Array&&"<syntax-rules>"===r[0]},Parameter:function(r){return r instanceof Array&&"<parameter>"===r[0]},Exception:function(r){return r instanceof Array&&"<exception>"===r[0]},Undefined:function(r){return r instanceof Array&&"<undefined>"===r[0]},Promise:function(r){return r instanceof Array&&"<promise>"===r[0]},Error:function(r){return r instanceof Array&&"<error>"===r[0]},Continuation:function(r){return r instanceof Array&&"<continuation>"===r[0]},JS:function(r){return r instanceof Array&&"<js>"===r[0]},List:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return R.Pair(r)||R.Null(r)})),Procedure:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&("<procedure>"===r[0]||"<continuation>"===r[0]||"<parameter>"===r[0])})),Object:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"string"==typeof r[0]&&/^<.*>/.test(r[0])})),Evaluatable:function(r){return R.List(r)||R.Symbol(r)},False:function(r){return R.Boolean(r)&&!1===r[1]},RealNumber:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return R.Number(r)&&"number"==typeof r[1]})),IntegerNumber:function(r){return R.Number(r)&&"number"==typeof r[1]&&Number.isInteger(r[1])},Objects:function(r){return r instanceof Array&&r.every((function(r){return R.Object(r)}))},Suspend:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"#SUSPEND#"===r[0]})),JSPromiseContinuation:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"#PROMISE-CONTINUATION#"===r[0]})),CallStack:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"#CALL-STACK#"===r[0]})),SpecialObject:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"string"==typeof r[0]&&/^#.+#$/.test(r[0])})),Dictionary:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return"object"===n(r)&&!!r&&r.constructor===Object})),Stack:function(r){return r instanceof Array&&3===r.length&&"string"==typeof r[0]&&/^#.*-STACK#$/.test(r[0])}},q=function(r,e){return function(t,n){if(!r(t))throw D.Error("domain-error",null!=n?n:e)}},U=function(r,e){return function(t,n){if(!(t instanceof Array))throw D.Error("domain-error",null!=n?n:e);var a,o=v(t);try{for(o.s();!(a=o.n()).done;){var i=a.value;if(!r(i))throw D.Error("domain-error",null!=n?n:e)}}catch(r){o.e(r)}finally{o.f()}}},F={List:q(R.List,"A <pair> or <null> is expected."),Pair:q(R.Pair,"A <pair> is expected."),Symbol:q(R.Symbol,"A <symbol> is expected."),Number:q(R.Number,"A <number> is expected."),Boolean:q(R.Boolean,"A <boolean> is expected."),Object:q(R.Object,"A Scheme object is expected."),String:q(R.String,"A <string> is expected."),Vector:q(R.Vector,"A <vector> is expected."),ByteVector:q(R.ByteVector,"A <bytevector> is expected."),Character:q(R.Character,"A <character> is expected."),Error:q(R.Error,"A <error> is expected."),Procedure:q(R.Procedure,"A <procedure> is expected."),SyntaxRules:q(R.SyntaxRules,"A <syntax-rules> is expected."),Parameter:q(R.Parameter,"A <parameter> is expected."),RecordType:q(R.RecordType,"A <record-type> is expected."),Record:q(R.Record,"A <record> is expected."),MultiValue:q(R.MultiValue,"A <multi-value> is expected."),Port:q(R.Port,"A <port> is expected."),Lists:U(R.List,"An array of <pair>/<null> is expected."),Pairs:U(R.Pair,"An array of <pair> is expected."),Symbols:U(R.Symbol,"An array of <symbol> is expected."),Numbers:U(R.Number,"An array of <number> is expected."),Booleans:U(R.Boolean,"An array of <boolean> is expected."),Objects:U(R.Object,"An array of Scheme object is expected."),Strings:U(R.String,"An array of <string> is expected."),Vectors:U(R.Vector,"An array of <vector> is expected."),ByteVectors:U(R.ByteVector,"An array of  <bytevector> is expected."),Characters:U(R.Character,"An array of <character> is expected."),RealNumber:q(R.RealNumber,"A real <number> (not infinite, not NaN) is expected."),IntegerNumber:q(R.IntegerNumber,"A integer <number> is expected."),RealNumbers:U(R.RealNumber,"An array of real <number> is expected."),IntegerNumbers:U(R.IntegerNumber,"An array of integer <number> is expected.")},J=function(r){if(null==r)throw D.Error("program-error","Required object.")},$=function(r){return"object"===n(r)&&null!==r&&"Object"===r.constructor.name},Z=Object.prototype.hasOwnProperty,_=function(r){var e=new Set;return function r(t){if(R.Pair(t)){var n=i(t,3),a=n[1],o=n[2];if(e.has(o))throw new Error("Circular list detected.");return e.add(o),[a].concat(c(r(R.List(o)?o:["<null>"])))}return[]}(r)},X=function r(e){var t=new Set;return function(e){var n=i(e,3),a=n[1],o=n[2];if(R.Pair(o)){if(t.has(o))throw new Error("Circular list detected.");t.add(o);var u=i(r(o),2),l=u[0],f=u[1];return[[a].concat(c(l)),f]}return[[a],o]}(e)},K=function(r,e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;return r.reverse().reduce((function(e,a,o){return n&&o===r.length-1?D.Pair(a,e,t,n):D.Pair(a,e,t)}),e||["<null>"])},W=(d=0,b=0,y=0,function(){return"::"+"T-S-XXXXXXX".replace(/[TSX]/g,(function(r){return b=Date.now(),"T"===r?"0000000000000".concat(b.toString(16)).slice(-14):"S"===r?"000".concat((d===b?(d=b,y=0):y++).toString(16)).slice(-4):"000".concat((Math.random()*Math.pow(16,4)|0).toString(16)).slice(-4)}))}),G=function(r,e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e.filter((function(r){return"variadic"===r.type})).length>1)throw new Error("Only one variadic parameter is allowed.");return{name:r,parameters:e,body:t,isMacro:n,hidden:a}},H=function(r,e){return t(t({},e),{},{name:r})},Y=function(r,e){return r.length===e.length&&r.every((function(r,t){return r===e[t]}))},rr=function(r){if(R.List(r)){if(R.Null(r))return[[],null];var e,t=i(X(r),2),n=t[0],a=t[1];return F.Symbols(n),R.Null(a)||F.Symbol(a),[n.map((function(r){var e;return{name:null!==(e=r[3])&&void 0!==e?e:r[1]}})),R.Null(a)?null:{name:null!==(e=a[3])&&void 0!==e?e:a[1],type:"variadic"}]}var o;return F.Symbol(r),[[],{name:null!==(o=r[3])&&void 0!==o?o:r[1],type:"variadic"}]},er=function(r){return!!r&&"object"===n(r)&&r.language===g&&!!r.version&&(R.Object(r.content)||R.SpecialObject(r.content))},tr=function(r){return er(r)&&R.Suspend(r.content)},nr=new RegExp("(?:"+[/\s+/.source,/;[^\n]*(?:\n|$)/.source,/(?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+/.source,/\|(?:[^|\\]|\n|\\(?:.|\n))+\|/.source,/#!(?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+/.source,/"(?:[^"\\]|\n|\\(?:.|\n))*"/.source,/(?:[()[\]{}'`]|,(?!@)|,@)/.source,/#(?:t(?:rue)?|f(?:alse)?|\(|u8\(|\d+[#=]|;)/.source,/#[dDbBoOxXeEiI](?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+/.source,/#\\(?:(?:[^A-Za-z]|\n)|[A-Za-z](?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])*)/.source,Array(16).fill(/#\|(?:[^|#]|\|[^#]|#[^|]|\n|(?:NEST))*\|#/.source).reduce((function(r,e){return r.replace("NEST",e)}))].join("|")+")","y"),ar={a:"",b:"\b",t:"\t",n:"\n",r:"\r"},or={alarm:"",backspace:"\b",delete:"",escape:"",newline:"\n",null:"\0",return:"\r",space:" ",tab:"\t"},ir=function(r,e){var t=function(r){for(var e,t=[0],n=/\n/g;e=n.exec(r);)t.push(e.index+1);return function(e){var n,a=t.filter((function(r){return r<=e})).slice(-1)[0],o=r.slice(a,e);return[t.indexOf(a)+1,o.length+(null!==(n=o.match(/[^\x01-\x7E\xA1-\xDF]/g))&&void 0!==n?n:[]).length+1]}}(r),n=[];nr.lastIndex=0;for(var a=!1;nr.lastIndex<r.length;){var o,u=nr.lastIndex,c=i(t(u),2),l=c[0],f=c[1],s=e?{filename:e,line:l,column:f}:{line:l,column:f},m=i(null!==(o=nr.exec(r))&&void 0!==o?o:[],1)[0];if(null==m){var p=r.slice(u).split(/(\s|\n)+/,2)[0]||r[u],v=p.length>10?p.slice(0,10)+"...":p;throw new Error('Tokenize failed. Unexpected token is: "'.concat(v,'": ').concat(JSON.stringify(s)))}"#!fold-case"!==m&&"#!no-fold-case"!==m?(a&&(m.match(/^(?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+$/)||m.match(/#\\(?:(?:[^A-Za-z]|\n)|[A-Za-z](?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])*)/))&&(m=m.toLowerCase()),n.push([m,s])):a=!m.includes("#!no-")}return n},ur=function(r){var e=r.filter((function(r){return!r[0].match(/^(\s|;|#\||#!(no-)?fold-case)/)}));return[function r(){for(var t=[],n=e.shift();n;n=e.shift()){var a=i(n,2),o=a[0],u=a[1];if(!o.match(/^(\s|;|#\|)/))if("("===o)t.push(r().concat(u));else if(["#(","#u8("].includes(o))t.push([o.slice(0,-1),r(),u]);else{if(["'","`",",",",@","#;"].includes(o)||o.match(/^#\d+=$/)){var l=r(),f=l.shift();if(null==f)throw'Unexpected end of source after quoting/datum label "'.concat(o,'": ').concat(JSON.stringify(u));return"#;"!==o&&t.push([o,f]),t.push.apply(t,c(l)),t}if(")"===o)return t;t.push(o)}}return t}(),e]},cr=function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map;if("string"==typeof e){var u;if(u=/^([+-])(nan|inf)\.0$/i.exec(e))return D.Number(u[0].toLowerCase());if(u=/^(?:#d)?[-+]?\d+(?:\.\d*)?(?:e[-+]?\d+)?$/i.exec(e))return B(Number(e.replace(/^(#d)?0*/i,"")));if(u=/^(?:#b[-+]?[01]+|#o[-+]?[0-7]+|#x[-+]?[0-9A-Fa-f]+)/i.exec(e))return B(Number(e.replace(/^#([xob])([+-]?)/i,"0$1"))*(e.includes("-")?-1:1));if(/^#[dboxei]/i.exec(e))throw new Error("Unsupported type of number literal: ".concat(e,": ").concat(JSON.stringify(t)));if(u=/^"((?:.|\n)*)"$/.exec(e)){var l=u[1].replace(/\\(x[0-9a-fA-F]+;|[ \t]*\n[ \t]*|[^x \t\n])/g,(function(r){return"x"===r[1]?String.fromCodePoint(Number("0x".concat(r.replace(/;$/,"").slice(2)))):/\s|\n/.test(r[1])?"":null!==(e=ar[r[1]])&&void 0!==e?e:r[1];var e}));return D.String(l,!0)}if(u=/^#([tf])/.exec(e))return D.Boolean("t"===u[1]);if(u=/^#\\((.|\n)*)$/.exec(e)){var f=1===u[1].length?u[1]:u[1].match(/^x[0-9A-Fa-f]+$/)?String.fromCodePoint(Number("0x".concat(u[1].slice(1)))):or[u[1]];if(!f)throw new Error("Illegal character literal: ".concat(f,": ").concat(JSON.stringify(t)));return D.Character(f)}if("."!==e&&(u=/^(([A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+)$/.exec(e)))return D.Symbol(u[1]);if("."!==e&&(u=/^\|(([^\\]|\n|\\(.|\n))+)\|$/.exec(e))){var s=u[1].replace(/\\(x[0-9a-fA-F]+;|\s*\n\s*|[^x\s\n])/g,(function(r){return"x"===r[1]?String.fromCodePoint(Number("0x".concat(r.replace(/;$/,"").slice(2)))):/\s|\n/.test(r[1])?"":null!==(e=ar[r[1]])&&void 0!==e?e:r[1];var e}));return D.Symbol(s)}if(u=/^#(\d+)#$/.exec(e)){var m=u[1];if(!o.has(m))throw new Error("Invalid datum reference (".concat(e,"): ").concat(JSON.stringify(t)));return o.get(m)}throw new Error('Parse error: unexpected token: "'.concat(e,'": ').concat(JSON.stringify(t)))}if(e instanceof Array&&"&"!==e[0]){var p;t=null!==(p=e.find((function(r){return $(r)})))&&void 0!==p?p:t;var v=e.filter((function(r){return!$(r)}));if(0===v.length)return D.Null();if(2===v.length&&"."===v[0])return r(v[1],t,a,o);if("#"===v[0]){if(2!==v.length)throw new Error("Illegal vector literal. No datum: ".concat(JSON.stringify(t)));if(!(v[1]instanceof Array))throw new Error("Illegal vector literal. Datum is not an array: ".concat(JSON.stringify(t)));return D.Vector(v[1].map((function(e){return r(e,t,a,o)})),!0)}if("#u8"===v[0]){if(2!==v.length)throw new Error("Illegal byte vector literal. No datum: ".concat(JSON.stringify(t)));if(!(v[1]instanceof Array))throw new Error("Illegal byte vector literal. Byte vector must have an array: ".concat(JSON.stringify(t)));var d=v[1].map((function(e){return r(e,t,a,o)}));if(!d.every((function(r){return R.RealNumber(r)&&Number.isInteger(r[1])&&r[1]>=0&&r[1]<=255})))throw new Error("Illegal byte vector literal. All the contents of a byte vector must be 0-255.: ".concat(JSON.stringify(t)));return D.ByteVector(d.map(P),!0)}if("string"==typeof v[0]&&["'","`",",",",@"].includes(v[0])){if(2!==v.length)throw new Error('Illegal quote "'.concat(v[0],'". Quoted item must be a datum: ').concat(JSON.stringify(t)));var b={"'":"quote","`":"quasiquote",",":"unquote",",@":"unquote-splicing"}[v[0]];return D.Pair(D.Symbol(b),D.Pair(r(v[1],t,a,o),D.Null(),!0),!0,null!=a&&a.removeLineInfo?null:t)}if("string"==typeof v[0]&&/^#(\d+)=$/.exec(v[0])){var y,g=/^#(\d+)=$/.exec(v[0]),h=i(g,2),w=h[1];if(2!==v.length)throw new Error("Illegal datum label. No next datum: ".concat(JSON.stringify(t)));var S=D.Symbol(v[0]);o.set(w,S);var j=r(v[1],t,a,o);return(y=S).splice.apply(y,[0,S.length].concat(c(j))),S}return D.Pair(r(v[0],t,a,o),r(v.slice(1),t,a,o),!0,null!=a&&a.removeLineInfo?null:t)}if(null===e)return D.Null();if("number"==typeof e)return B(e);if("boolean"==typeof e)return D.Boolean(e);if(e instanceof Array&&"&"===e[0]){if(2!=e.length)throw new Error('Parse error: JS Node must be like ["&", <object>]: '.concat(n(e)," value: ").concat(e));return D.JS("inline",e[1])}if(R.Object(e))return e;throw new Error("Parse error: unexpected node type: ".concat(n(e)," value: ").concat(e))},lr=cr,fr=function(r,e){var t=ir(r),n=i(ur(t),2),a=n[0],o=n[1];if(o.length>0)throw new Error("Parse error: extra tokens. (missing right curly?), ".concat(JSON.stringify(o[0][1])));return cr(["begin"].concat(c(a)),null,e)},sr=G("not",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.False(e))})),mr=G("boolean?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Boolean(e))})),pr=G("boolean=?",[{name:"boolean1"},{name:"boolean2"},{name:"booleans",type:"variadic"}],(function(r){var e=r.boolean1,t=r.boolean2,n=r.booleans;return F.Boolean(e),F.Boolean(t),F.Booleans(n),D.Boolean([t].concat(c(n)).every((function(r){return r[1]===e[1]})))})),vr={not:sr,booleanQ:mr,booleanEQ:pr},dr=G("bytevector?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.ByteVector(e))})),br=G("make-bytevector",[{name:"k"},{name:"byte",type:"optional"}],(function(r){var e=r.k,t=r.byte;return F.IntegerNumber(e),t&&F.IntegerNumber(t),D.ByteVector(Array(e[1]).fill(t?t[1]:0),!1)})),yr=G("bytevector",[{name:"bytes",type:"variadic"}],(function(r){var e=r.bytes;return F.IntegerNumbers(e),D.ByteVector(e.map((function(r){return r[1]})),!1)})),gr=G("bytevector-length",[{name:"bvec"}],(function(r){var e=r.bvec;return F.ByteVector(e),D.Number(e[1].length)})),hr=G("bytevector-u8-ref",[{name:"bvec"},{name:"k"}],(function(r){var e=r.bvec,t=r.k;if(F.ByteVector(e),F.IntegerNumber(t),!(t[1]in e[1]))throw D.Error("out-of-range","Index is out of range.");return D.Number(e[1][t[1]])})),wr=G("bytevector-u8-set!",[{name:"bvec"},{name:"k"},{name:"byte"}],(function(r){var e=r.bvec,t=r.k,n=r.byte;if(F.ByteVector(e),F.IntegerNumber(t),F.IntegerNumber(n),!(t[1]in e[1]))throw D.Error("out-of-range","Index is out of range.");return e[1][t[1]]=n[1],["<undefined>"]})),Sr=G("bytevector-copy",[{name:"bvec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.bvec,t=r.start,n=r.end;F.ByteVector(e);var a=e[1];if(0===a.length)return D.ByteVector([],!1);var o=R.Number(t)?t[1]:0,i=R.Number(n)?n[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw D.Error("domain-error","Index must be integer.");return D.ByteVector(a.slice(o,i),!1)})),jr=G("bytevector-copy!",[{name:"to"},{name:"at"},{name:"from"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e,t=r.to,n=r.at,a=r.from,o=r.start,i=r.end;F.ByteVector(t),F.IntegerNumber(n),F.ByteVector(a);var u=R.Number(o)?o[1]:0,l=R.Number(i)?i[1]:a[1].length;if("number"!=typeof u||!Number.isInteger(u)||"number"!=typeof l||!Number.isInteger(l))throw D.Error("domain-error","Index must be integer.");if(!(n[1]in t[1]))throw D.Error("out-of-range","Index is out of range.");if(t[1].length-n[1]<l-u)throw D.Error("out-of-range","Index is out of range.");var f=a[1].slice(u,l);return(e=t[1]).splice.apply(e,[n[1],f.length].concat(c(f))),["<undefined>"]})),Nr=G("bytevector-append",[{name:"vecs",type:"variadic"}],(function(r){var e=r.vecs;return F.ByteVectors(e),D.ByteVector(e.map((function(r){return r[1]})).flat(),!1)})),xr=G("utf8->string",[{name:"bvec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.bvec,t=r.start,n=r.end;F.ByteVector(e);var a=e[1],o=R.Number(t)?t[1]:0,i=R.Number(n)?n[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw D.Error("domain-error","Index must be integer.");var u=new Uint8Array(a.slice(o,i));return D.String((new TextDecoder).decode(u),!1)})),Er=G("string->utf8",[{name:"str"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,t=r.start,n=r.end;F.String(e);var a=e[1],o=R.Number(t)?t[1]:0,i=R.Number(n)?n[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw D.Error("domain-error","Index must be integer.");var u=(new TextEncoder).encode(a.slice(o,i));return D.ByteVector(Array.from(u),!1)})),Ir={bytevectorQ:dr,makeBytevector:br,bytevector:yr,bytevectorLength:gr,bytevectorU8Ref:hr,bytevectorU8SetD:wr,bytevectorCopy:Sr,bytevectorCopyD:jr,bytevectorAppend:Nr,utf8ToString:xr,stringToUtf8:Er},Or=G("char?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Character(e))})),Pr=G("char=?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,t=r.char2,n=r.chars;return F.Character(e),F.Character(t),F.Characters(n),D.Boolean([t].concat(c(n)).every((function(r){return r[1]===e[1]})))})),Br=G("char<?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,t=r.char2,n=r.chars;F.Character(e),F.Character(t),F.Characters(n);var a=[e,t].concat(c(n)).map((function(r){return r[1]}));return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]<r})))})),Cr=G("char>?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,t=r.char2,n=r.chars;F.Character(e),F.Character(t),F.Characters(n);var a=[e,t].concat(c(n)).map((function(r){return r[1]}));return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]>r})))})),Ar=G("char<=?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,t=r.char2,n=r.chars;F.Character(e),F.Character(t),F.Characters(n);var a=[e,t].concat(c(n)).map((function(r){return r[1]}));return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]<=r})))})),kr=G("char>=?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,t=r.char2,n=r.chars;F.Character(e),F.Character(t),F.Characters(n);var a=[e,t].concat(c(n)).map((function(r){return r[1]}));return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]>=r})))})),Lr=G("char->integer",[{name:"char"}],(function(r){var e=r.char;F.Character(e);var t=e[1].codePointAt(0);if(void 0===t)throw D.Error("out-of-range","Can't convert character to codepoint.");return D.Number(t)})),Vr=G("integer->char",[{name:"n"}],(function(r){var e=r.n;return F.IntegerNumber(e),D.Character(String.fromCodePoint(e[1]))})),zr={charQ:Or,charEQ:Pr,charLtQ:Br,charGtQ:Cr,charLeQ:Ar,charGeQ:kr,charToInteger:Lr,integerToChar:Vr},Mr=G("procedure?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Procedure(e))}),!0),Tr=G("apply",[{name:"proc"},{name:"args",type:"variadic"}],(function(r,e,t){var n,a=r.proc,o=r.args;if(F.Procedure(a),F.Objects(o),J(e),J(t),0===o.length)n=[];else{var i=[o.slice(0,o.length-1),o[o.length-1]],u=i[0],l=i[1];F.List(l),n=[].concat(c(u),c(_(l)))}return Q.Call(a,D.MultiValue(n))}),!0),Dr=G("map",[{name:"proc"},{name:"list1"},{name:"lists",type:"variadic"}],(function(r){var e=r.proc,t=r.list1,n=r.lists;F.Procedure(e),F.List(t),F.Lists(n);var a=[t].concat(c(n));return a.every((function(r){return R.Pair(r)}))?Q.Cons(Q.Call(e,D.MultiValue(a.map((function(r){return r[1]})))),Q.CallBuiltIn("map",D.MultiValue([e].concat(c(a.map((function(r){return r[2]}))))))):Q.Quote(["<null>"])}),!0),Qr=G("string-map",[{name:"proc"},{name:"str1"},{name:"strs",type:"variadic"}],(function(r){var e=r.proc,t=r.str1,n=r.strs;F.Procedure(e),F.String(t),F.Strings(n);var a=[t].concat(c(n));return a.every((function(r){return r[1].length>1}))?Q.CallBuiltIn("string-append",Q.CallBuiltIn("string",Q.Call.apply(Q,[e].concat(c(a.map((function(r){return D.Character(r[1][0])})))))),Q.CallBuiltIn.apply(Q,["string-map",e].concat(c(a.map((function(r){return D.String(r[1].slice(1),!1)})))))):a.every((function(r){return 1===r[1].length}))?Q.CallBuiltIn("string",Q.Call.apply(Q,[e].concat(c(a.map((function(r){return D.Character(r[1][0])})))))):D.String("",!1)}),!0),Rr=G("vector-map",[{name:"proc"},{name:"vector1"},{name:"vectors",type:"variadic"}],(function(r){var e=r.proc,t=r.vector1,n=r.vectors;F.Procedure(e),F.Vector(t),F.Vectors(n);var a=[t].concat(c(n));return a.every((function(r){return r[1].length>1}))?Q.CallBuiltIn("vector-append",Q.CallBuiltIn("vector",Q.Call(e,D.MultiValue(a.map((function(r){return r[1][0]}))))),Q.CallBuiltIn.apply(Q,["vector-map",e].concat(c(a.map((function(r){return D.Vector(r[1].slice(1),!1)})))))):a.every((function(r){return r[1].length>=1}))?Q.CallBuiltIn("vector",Q.Call(e,D.MultiValue(a.map((function(r){return r[1][0]}))))):D.Vector([],!1)}),!0),qr=G("for-each",[{name:"proc"},{name:"list1"},{name:"lists",type:"variadic"}],(function(r){var e=r.proc,t=r.list1,n=r.lists;F.Procedure(e),F.List(t),F.Lists(n);var a=[t].concat(c(n));return a.every((function(r){return R.Pair(r)}))?Q.Begin(Q.Call(e,D.MultiValue(a.map((function(r){return r[1]})))),Q.CallBuiltIn("for-each",D.MultiValue([e].concat(c(a.map((function(r){return r[2]}))))))):["<undefined>"]}),!0),Ur=G("string-for-each",[{name:"proc"},{name:"str1"},{name:"strs",type:"variadic"}],(function(r){var e=r.proc,t=r.str1,n=r.strs;F.Procedure(e),F.String(t),F.Strings(n);var a=[t].concat(c(n));return a.every((function(r){return r[1].length>1}))?Q.Begin(Q.Call.apply(Q,[e].concat(c(a.map((function(r){return D.Character(r[1][0])}))))),Q.CallBuiltIn.apply(Q,["string-for-each",e].concat(c(a.map((function(r){return D.String(r[1].slice(1),!1)})))))):a.every((function(r){return 1===r[1].length}))?Q.Call.apply(Q,[e].concat(c(a.map((function(r){return D.Character(r[1][0])}))))):["<undefined>"]}),!0),Fr=G("vector-for-each",[{name:"proc"},{name:"vector1"},{name:"vectors",type:"variadic"}],(function(r){var e=r.proc,t=r.vector1,n=r.vectors;F.Procedure(e),F.Vector(t),F.Vectors(n);var a=[t].concat(c(n));return a.every((function(r){return r[1].length>1}))?Q.Begin(Q.Call(e,D.MultiValue(a.map((function(r){return r[1][0]})))),Q.CallBuiltIn.apply(Q,["vector-for-each",e].concat(c(a.map((function(r){return D.Vector(r[1].slice(1),!1)})))))):a.every((function(r){return 1===r[1].length}))?Q.Call(e,D.MultiValue(a.map((function(r){return r[1][0]})))):Q.Quote(["<null>"])}),!0),Jr=G("call-with-current-continuation",[{name:"proc"}],(function(r,e,t){var n=r.proc;return F.Procedure(n),J(t),Q.Call(n,D.Continuation(k(t)))}),!0),$r=H("call/cc",Jr),Zr=G("values",[{name:"objs",type:"variadic"}],(function(r){var e=r.objs;return F.Objects(e),1===e.length?e[0]:D.MultiValue(e)})),_r=G("call-with-values",[{name:"producer"},{name:"consumer"}],(function(r,e,t){var n=r.producer,a=r.consumer;F.Procedure(n),F.Procedure(a),J(t);var o=M(t,D.List(a),{want:"args",oper:a});return z(o,D.List(n))})),Xr=G("dynamic-wind",[{name:"before"},{name:"thunk"},{name:"after"}],(function(r,e,t){var n=r.before,a=r.thunk,o=r.after;F.Procedure(n),F.Procedure(a),F.Procedure(o),J(t);var i=D.Continuation(k(t));return z(t,Q.Begin(Q.Call(n),Q.Call(i,Q.Call(a))),{before:n,after:o})})),Kr={procedureQ:Mr,apply:Tr,map:Dr,stringMap:Qr,vectorMap:Rr,forEach:qr,stringForEach:Ur,vectorForEach:Fr,callWithCurrentContinuation:Jr,callCC:$r,values:Zr,callWithValues:_r,dynamicWind:Xr},Wr=G("eqv?",[{name:"obj1"},{name:"obj2"}],(function(r){var e=r.obj1,t=r.obj2;F.Object(e),F.Object(t);var n=function(r){return R.String(r)||R.ByteVector(r)||R.Vector(r)?r.slice(0,r.length-1):R.Pair(r)?r.slice(0,3):r};return D.Boolean(e===t||Y(n(e),n(t)))})),Gr=H("eq?",Wr),Hr=G("equal?",[{name:"obj1"},{name:"obj2"}],(function(r){var e=r.obj1,t=r.obj2;F.Object(e),F.Object(t);return D.Boolean(function r(e,t){return e===t||(R.Pair(e)&&R.Pair(t)?r(e[1],t[1])&&r(e[2],t[2]):R.Vector(e)&&R.Vector(t)?e[1]===t[1]||e[1].length===t[1].length&&e[1].every((function(e,n){return r(e,t[1][n])})):R.ByteVector(e)&&R.ByteVector(t)?Y(e[1],t[1]):Wr.body({obj1:e,obj2:t})[1])}(e,t))})),Yr={eqvQ:Wr,eqQ:Gr,equalQ:Hr},re=G("with-exception-handler",[{name:"handler"},{name:"thunk"}],(function(r,e,t){var n=r.handler,a=r.thunk;return F.Procedure(n),F.Procedure(a),J(t),M(t,Q.Call(a),{handler:D.HandlerStack(n,V(t).handler)})})),ee=G("raise",[{name:"obj"}],(function(r,e,t){var n=r.obj;throw F.Object(n),J(t),D.Exception(t,n,!1)})),te=G("raise-continuable",[{name:"obj"}],(function(r,e,t){var n=r.obj;throw F.Object(n),J(t),D.Exception(t,n,!0)})),ne=G("error",[{name:"message"},{name:"objs",type:"variadic"}],(function(r,e,t){var n=r.message,a=r.objs;throw F.String(n),F.Objects(a),J(t),D.Exception(t,D.Error("error",n[1],a),!0)})),ae=G("error-object?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Error(e))})),oe=G("error-object-message",[{name:"err"}],(function(r){var e,t=r.err;return F.Error(t),D.String(null!==(e=t[2])&&void 0!==e?e:t[1],!1)})),ie=G("error-object-irritants",[{name:"err"}],(function(r){var e=r.err;return F.Error(e),D.List.apply(D,c(e[3]))})),ue=G("read-error?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Error(e)&&"read-error"===e[1])})),ce=G("file-error?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Error(e)&&"file-error"===e[1])})),le={withExceptionHandler:re,raise:ee,raiseContinuable:te,error:ne,errorObjectQ:ae,errorObjectMessage:oe,errorObjectIrritants:ie,readErrorQ:ue,fileErrorQ:ce},fe=G("quote",[{name:"value",evaluate:!1}],(function(r){var e=r.value;return F.Object(e),e})),se=G("lambda",[{name:"formals",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.formals,a=r.body;F.Object(n),F.Objects(a),J(t);var o=i(rr(n),2),u=o[0],l=o[1];return D.Procedure("lambda",l?[].concat(c(u),[l]):u,Q.BeginIfMultiple.apply(Q,c(a)),!1,V(t).env)})),me=G("if",[{name:"test"},{name:"consequent",evaluate:!1},{name:"alternate",type:"optional",evaluate:!1}],(function(r){var e=r.test,t=r.consequent,n=r.alternate;return F.Object(e),F.Object(t),R.False(e)?n?(F.Object(n),n):["<undefined>"]:t}),!0),pe=G("set!",[{name:"variable",evaluate:!1},{name:"expr"}],(function(r,e,t){var n=r.variable,a=r.expr;if(J(e),J(t),F.Symbol(n),F.Object(a),R.Undefined(a))throw D.Error("undefined-variable",'Attempt to set undefined value to a variable "'.concat(n[1],'"'));if(!e.setStatic(V(t).env.static,n,a))throw D.Error("unbound-variable",'Attempt to set value to an unbound variable "'.concat(n[1],'"'));return["<undefined>"]})),ve=G("cond",[{name:"clause",evaluate:!1},{name:"clauses",type:"variadic",evaluate:!1}],(function(r){var e=r.clause,t=r.clauses;F.Pair(e),F.Pairs(t);var n=0===t.length?["<undefined>"]:Q.Cond.apply(Q,[t[0]].concat(c(t.splice(1)))),a=u(_(e)),o=a[0],i=a[1],l=a.slice(2);if(R.Symbol(o)&&"else"===o[1])return Q.BeginIfMultiple.apply(Q,[i].concat(c(l)));if(i){if(R.Symbol(i)&&"=>"===i[1]){if(1!==l.length)throw D.Error("syntax-error","Illegal cond syntax (test => expression).");var f=D.Symbol(W());return Q.Let([[f,o]],Q.If(f,Q.Call(l[0],f),n))}return Q.If(o,Q.BeginIfMultiple.apply(Q,[i].concat(c(l))),n)}return Q.Or(o,n)}),!0),de=G("case",[{name:"key"},{name:"clauses",type:"variadic",evaluate:!1}],(function(r){var e=r.key,t=r.clauses;F.Object(e),F.Pairs(t);var n=t.find((function(r,n){if(R.Symbol(r[1])&&"else"===r[1][1]){if(n!==t.length-1)throw D.Error("syntax-error","Illegal case syntax (else placement).");return!0}return F.Pair(r[1]),_(r[1]).some((function(r){return Wr.body({obj1:r,obj2:e})[1]}))}));if(n){var a=u(_(n)),o=a[1],i=a.slice(2);if(o){if(R.Symbol(o)&&"=>"===o[1]){if(1!==i.length)throw D.Error("syntax-error","Illegal cond syntax (test => expression).");return Q.Call(i[0],D.MultiValue([e]))}return Q.BeginIfMultiple.apply(Q,[o].concat(c(i)))}throw D.Error("syntax-error","Illegal cond syntax (short clause).")}return["<undefined>"]}),!0),be=G("and",[{name:"first",type:"optional"},{name:"rest",type:"variadic",evaluate:!1}],(function(r){var e=r.first,t=r.rest;return e?(F.Object(e),F.Objects(t),0===t.length||R.False(e)?Q.Quote(e):Q.And.apply(Q,c(t))):D.Boolean(!0)}),!0),ye=G("or",[{name:"first",type:"optional"},{name:"rest",type:"variadic",evaluate:!1}],(function(r){var e=r.first,t=r.rest;return e?(F.Object(e),F.Objects(t),0!==t.length&&R.False(e)?Q.Or.apply(Q,c(t)):Q.Quote(e)):D.Boolean(!1)}),!0),ge=G("when",[{name:"test"},{name:"expr",evaluate:!1},{name:"exprs",type:"variadic",evaluate:!1}],(function(r){var e=r.test,t=r.expr,n=r.exprs;return F.Object(e),F.Object(t),F.Objects(n),R.False(e)?["<undefined>"]:Q.BeginIfMultiple.apply(Q,[t].concat(c(n)))}),!0),he=G("unless",[{name:"test"},{name:"expr",evaluate:!1},{name:"exprs",type:"variadic",evaluate:!1}],(function(r){var e=r.test,t=r.expr,n=r.exprs;return F.Object(e),F.Object(t),F.Objects(n),R.False(e)?Q.BeginIfMultiple.apply(Q,[t].concat(c(n))):["<undefined>"]}),!0),we=G("let",[{name:"args",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.args;F.Objects(n);var a=u(R.Symbol(n[0])?n:[null].concat(c(n))),o=a[0],l=a[1],f=a.slice(2);F.List(l),F.Objects(f),J(t);var s=_(l).map((function(r){F.Pair(r),F.Symbol(r[1]),F.Pair(r[2]);var e=i(r,3);return[e[1],i(e[2],2)[1]]})),m=s.map((function(r){return i(r,1)[0]})),p=s.map((function(r){return i(r,2)[1]})),v=Q.Lambda.apply(Q,[m,null].concat(c(f)));return o?(F.Symbol(o),Q.CallThunk(Q.Define(o,v),Q.Call.apply(Q,[o].concat(c(p))))):Q.Call.apply(Q,[v].concat(c(p)))}),!0),Se=G("let*",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.bindings,a=r.body;if(F.List(n),F.Objects(a),J(t),R.Pair(n)){F.Pair(n[1]),F.Pair(n[1][2]);var o=i(n,3),u=i(o[1],3),l=u[1],f=i(u[2],2)[1],s=o[2];return F.Symbol(l),Q.Call(Q.Lambda([l],null,Q.CallBuiltIn.apply(Q,["let*",s].concat(c(a)))),f)}return Q.BeginIfMultiple.apply(Q,c(a))}),!0),je=G("letrec",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.bindings,a=r.body;F.List(n),F.Objects(a),J(e),J(t);var o=_(n).map((function(r){F.Pair(r),F.Symbol(r[1]),F.Pair(r[2]);var e=i(r,3);return[e[1],i(e[2],2)[1]]})),u=V(t).env,l=u.static,f=u.dynamic,s=T(l);return o.forEach((function(r){var t=i(r,1)[0];return e.defineStatic(s,t,["<undefined>"])})),Q.Call(D.Procedure("lambda",[],Q.Begin.apply(Q,[Q.DefineValues(o.map((function(r){return i(r,1)[0]})),Q.Values.apply(Q,c(o.map((function(r){return i(r,2)[1]})))))].concat(c(a))),!1,{static:s,dynamic:f}))}),!0),Ne={quote:fe,lambda:se,If:me,setD:pe,cond:ve,Case:de,and:be,or:ye,when:ge,unless:he,Let:we,LetStar:Se,letrecStar:G("letrec*",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.bindings,a=r.body;F.List(n),F.Objects(a),J(e),J(t);var o=_(n).map((function(r){F.Pair(r),F.Symbol(r[1]),F.Pair(r[2]);var e=i(r,3);return[e[1],i(e[2],2)[1]]})),u=V(t).env,l=u.static,f=u.dynamic,s=T(l);return o.forEach((function(r){var t=i(r,1)[0];return e.defineStatic(s,t,["<undefined>"])})),Q.Call(D.Procedure("lambda",[],Q.Begin.apply(Q,c(o.map((function(r){var e=i(r,2),t=e[0],n=e[1];return Q.Set(t,n)}))).concat(c(a))),!1,{static:s,dynamic:f}))}),!0),letrec:je,letValues:G("let-values",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.bindings,a=r.body;return F.List(n),F.Objects(a),J(t),Q.CallThunk.apply(Q,c(_(n).map((function(r){F.Pair(r),F.Pair(r[2]);var e=i(r,3),n=e[1],a=i(e[2],2)[1],o=D.Procedure("lambda",[],a,!1,V(t).env);return Q.CallBuiltIn("define-values",n,Q.Call(o))}))).concat(c(a)))}),!0),letStarValues:G("let*-values",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.bindings,a=r.body;if(F.List(n),F.Objects(a),J(t),R.Pair(n)){F.Pair(n[1]),F.Pair(n[1][2]);var o=i(n,3),u=i(o[1],3),l=u[1],f=i(u[2],2)[1],s=o[2];return Q.CallThunk(Q.CallBuiltIn("define-values",l,f),Q.CallBuiltIn.apply(Q,["let*-values",s].concat(c(a))))}return Q.BeginIfMultiple.apply(Q,c(a))}),!0),begin:G("begin",[{name:"exprs",type:"variadic",evaluate:!0},{name:"last",type:"tail",evaluate:!1}],(function(r,e,t){var n=r.exprs,a=r.last;return function(r){if(!(r instanceof Array))throw D.Error("program-error","An array is expected.")}(n),F.Object(a),J(t),0===V(t).depth?z(t,a):a}),!0),Do:G("do",[{name:"specs",evaluate:!1},{name:"clause",evaluate:!1},{name:"commands",type:"variadic",evaluate:!1}],(function(r){var e=r.specs,t=r.clause,n=r.commands;F.List(e),F.List(t),F.Objects(n);var a=_(e).map((function(r){F.Pair(r),F.Pair(r[2]),F.Symbol(r[1]);var e=i(r,3),t=e[1],n=i(e[2],3),a=n[1],o=n[2];return[t,a,R.Pair(o)?o[1]:null]})),o=i(t,3),u=o[1],l=o[2];return F.Object(u),F.List(l),Q.Let(a.map((function(r){var e=i(r,2);return[e[0],e[1]]})),Q.If(u,Q.Begin.apply(Q,c(_(l))),Q.Begin.apply(Q,c(n).concat([Q.CallBuiltIn.apply(Q,["do",D.List.apply(D,c(a.map((function(r){var e=i(r,3),t=e[0],n=e[2];return D.List(t,null!=n?n:t,null!=n?n:t)})))),t].concat(c(n)))]))))}),!0),makeParameter:G("make-parameter",[{name:"init"},{name:"converter",type:"optional"}],(function(r,e,t){var n=r.init,a=r.converter;F.Object(n),J(e),J(t);for(var o=W();o in V(t).env.dynamic[1];)o=W();return a&&F.Procedure(a),e.defineDynamic(V(t).env.dynamic,o,n),D.Parameter(o,null!=a?a:null)})),parameterize:G("parameterize",[{name:"assocs",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.assocs,a=r.body;F.Pair(n),F.Pairs(a),J(e),J(t);var o=V(t).env,u=_(n).map((function(r){F.Pair(r),F.Pair(r[2]);var e=i(r,3);return[e[1],i(e[2],2)[1]]})),l={static:o.static,dynamic:D.DynamicNS({},o.dynamic)},f=Q.BeginIfMultiple.apply(Q,c(u.map((function(r){var e=i(r,2),t=e[0],n=e[1];return Q.CallBuiltIn("define-parameter",t,n)}))).concat(c(a)));return M(t,f,{env:l})})),defineParameter:G("define-parameter",[{name:"param"},{name:"value",evaluate:!1}],(function(r,e,t){var n=r.param,a=r.value;F.Parameter(n),F.Object(a),J(e),J(t);var o=i(n,3)[2];return Q.CallBuiltIn("define-parameter-1",n,o?Q.Call(o,a):a)}),!0,!0),defineParameter1:G("define-parameter-1",[{name:"param"},{name:"value"}],(function(r,e,t){var n,a=r.param,o=r.value;if(F.Parameter(a),F.Object(o),J(e),J(t),!R.Undefined(null!==(n=A(V(t).env.dynamic)[a[1]])&&void 0!==n?n:["<undefined>"]))throw D.Error("redefine-variable",null);return e.defineDynamic(V(t).env.dynamic,a[1],o),["<undefined>"]}),!1,!0),guard:G("guard",[{name:"arg1",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.arg1,a=r.body;F.Pair(n),F.Objects(a),F.Symbol(n[1]),F.Pair(n[2]),J(t);var o=i(n,3),u=o[1],l=o[2],f=D.Continuation(k(t)),s=D.Procedure("lambda",[{name:u[1]}],Q.Call(f,Q.CallBuiltIn.apply(Q,["cond"].concat(c(_(l)),[D.List(D.Symbol("else"),Q.RaiseContinuable(u))]))),!1,V(t).env);return Q.CallBuiltIn("with-exception-handler",s,Q.Lambda.apply(Q,[[],null].concat(c(a))))}),!0),quasiquote:G("quasiquote",[{name:"template",evaluate:!1}],(function(r){var e=r.template;F.Object(e);var t=[],n=[],a=function r(e,a){if(R.Pair(e)){var o=i(e,3),u=o[1],c=o[2];if(R.Symbol(u)&&"quasiquote"===u[1])return D.Pair(u,r(c,a+1));if(R.Symbol(u)&&"unquote"===u[1]||"unquote-splicing"===u[1]){if(0!==a)return D.Pair(u,r(c,a-1));var l=D.Symbol("unquote-splicing"===u[1]?"@"+W():W());return F.Pair(c),t.push(l),n.push(c[1]),l}return D.Pair(r(u,a),r(c,a))}return R.Vector(e)?D.Vector(e[1].map((function(e){return r(e,a)})),!1):e}(e,0);return Q.CallBuiltIn.apply(Q,["quasiquote-1",a,D.List.apply(D,t)].concat(n))}),!0),quasiquote1:G("quasiquote-1",[{name:"template",evaluate:!1},{name:"marks",evaluate:!1},{name:"exprs",type:"variadic"}],(function(r){var e=r.template,t=r.marks,n=r.exprs;F.Object(e),F.List(t),F.Objects(n);var a=_(t);F.Symbols(a);var o=new Map;if(a.length!==n.length)throw D.Error("arity-error","quasiquote-1: marks and exprs unmatch.");a.forEach((function(r,e){return o.set(r[1],n[e])}));return function r(e){if(R.Pair(e)){var t=i(e,3),n=t[1],a=t[2];if(R.Symbol(n)&&"@"===n[1][0]&&o.has(n[1])){var u=o.get(n[1]);if(R.List(u))return R.Null(u)?r(a):K(_(u),r(a));throw D.Error("error","unquote-splicing evaluated as non-list object.")}return D.Pair(r(n),r(a))}return R.Vector(e)?D.Vector(e[1].map((function(e){if(R.Symbol(e)&&"@"===e[1][0]&&o.has(e[1])){var t=o.get(e[1]);if(R.List(t))return R.Null(t)?[]:_(t);throw D.Error("error","unquote-splicing evaluated as non-list object.")}return[r(e)]})).flat(),!1):R.Symbol(e)&&o.has(e[1])&&"@"!==e[1][0]?o.get(e[1]):e}(e)}),!1,!0),letSyntax:G("let-syntax",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.bindings,a=r.body;F.List(n,"aa"),F.Objects(a),J(t);var o=_(n).map((function(r){F.Pair(r),F.Pair(r[2]),F.Symbol(r[1]);var e=i(r,3),n=e[1],a=i(e[2],2)[1];return[n,D.Procedure("lambda",[],a,!1,V(t).env)]}));return Q.CallThunk.apply(Q,c(o.map((function(r){var e=i(r,2),t=e[0],n=e[1];return Q.CallBuiltIn("define-syntax",t,Q.Call(n))}))).concat(c(a)))}),!0),letrecSyntax:G("letrec-syntax",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.bindings,a=r.body;F.List(n),F.Objects(a),J(e),J(t);var o=_(n).map((function(r){F.Pair(r),F.Pair(r[2]),F.Symbol(r[1]);var e=i(r,3);return[e[1],i(e[2],2)[1]]})),u=V(t).env,l=u.static,f=u.dynamic,s=T(l);return o.forEach((function(r){var t=i(r,1)[0];return e.defineStatic(s,t,["<undefined>"])})),Q.Call(D.Procedure("lambda",[],Q.Begin.apply(Q,c(o.map((function(r){var e=i(r,2),t=e[0],n=e[1];return Q.CallBuiltIn("define-syntax",t,n)}))).concat(c(a))),!1,{static:s,dynamic:f}))}),!0),syntaxRules:G("syntax-rules",[{name:"arg1",evaluate:!1},{name:"arg2",evaluate:!1},{name:"args",type:"variadic",evaluate:!1}],(function(r,e,t){var n=r.arg1,a=r.arg2,o=r.args;F.Object(n),F.Object(a),F.Objects(o),J(e),J(t);var u=i(R.Symbol(n)?[n[1],a,o]:["...",n,[a].concat(c(o))],3),l=u[0],f=u[1],s=u[2];F.List(f);var m=_(f).map((function(r){return F.Symbol(r),r[1]})),p=function r(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(R.Pair(n))return D.Pair(r(n[1],a),r(n[2],a));if(R.Symbol(n)){var o;if(e.getStatic(V(t).env.static,n))return D.Symbol(n[1],V(t).env.static,null!==(o=n[3])&&void 0!==o?o:null);if(m.includes(n[1])||l===n[1]||"_"===n[1])return n;if(a.has(n[1]))return a.get(n[1]);var i=D.Symbol(n[1],null,W());return a.set(n[1],i),i}return n};F.Pairs(s);var d,b=[],y=v(s);try{for(y.s();!(d=y.n()).done;){var g,h=p(d.value);F.Pair(h),F.Pair(h[2]);var w=i(h,3),S=w[1],j=i(w[2],2)[1];F.Pair(S);var N=i(X(S),1)[0],x=N.findIndex((function(r){return R.Symbol(r)&&r[1]===l})),E=x<0?N.slice(1):N.slice(1,x-1),I=x<0?[]:N.slice(x+1),O=["<syntax-rule-pattern>",E,x<0?null:null!==(g=N[x-1])&&void 0!==g?g:null,I];b.push([O,j])}}catch(r){y.e(r)}finally{y.f()}return D.SyntaxRules(l,m,b)})),applySyntaxRules:G("use-syntax-rules",[{name:"spec"},{name:"args",type:"variadic"}],(function(r,e,t){var n=r.spec,a=r.args;F.SyntaxRules(n),F.Objects(a),J(e),J(t);var o,u=i(n,4),l=u[1],f=u[2],s=u[3];if(0===a.length)o=[];else{var m=[a.slice(0,a.length-1),a[a.length-1]],p=m[0],d=m[1];F.List(d),o=[].concat(c(p),c(_(d)))}var b,y=new Map,g=null,h=V(k(t)).env.static,w=function(r,t){if(R.Symbol(r)&&f.includes(r[1])){if(R.Symbol(t)){var n=e.getStatic(h,r),a=e.getStatic(h,r);return r[1]===t[1]&&n===a}return!1}return!!R.Symbol(r)||!!Hr.body({obj1:r,obj2:t})[1]},S=v(s);try{for(S.s();!(b=S.n()).done;){var j=b.value,N=i(j,1),x=i(N[0],4),E=x[1],I=x[2],O=x[3];if(I?o.length>=E.length+O.length:o.length===E.length+O.length){var P=o.length-E.length-O.length,B=[].concat(c(E),c(Array(P).fill(I)),c(O));if(B.every((function(r,e){return w(r,o[e])}))){R.Symbol(I)&&y.set(I[1],[]),g=j[1];for(var C=0;C<B.length;C++){var A=B[C],L=o[C];if(R.Symbol(A)&&"_"!==A[1]){var z=y.get(A[1]);z&&!R.Object(z)?z.push(L):y.set(A[1],L)}}break}}}}catch(r){S.e(r)}finally{S.f()}if(!g)throw D.Error("syntax-rules-unmatch","No rules match arguments.");return function r(e){if(R.Pair(e)){var t=i(e,3),n=t[1],a=t[2];if(R.Symbol(n)&&y.has(n[1])&&R.Symbol(a[1])&&a[1][1]===l){var o=y.get(n[1]);if(!o||R.Object(o))throw D.Error("syntax-error",'Pattern variable "'.concat(n[1],' is not variadic." '));return K(o,r(a[2]))}return R.Pair(n)&&R.Symbol(n[1])&&n[1][1]===l&&R.Pair(n[2])?D.Pair(r(n[2][1]),r(a)):D.Pair(r(n),r(a))}if(R.Symbol(e)&&y.has(e[1])){var u=y.get(e[1]);if(!R.Object(u))throw D.Error("syntax-error",'Pattern variable "'.concat(e[1],'" must be variadic. (add "').concat(l,'" after the symbol)" '));return u}return e}(g)}),!1,!0),syntaxError:G("syntax-error",[{name:"message"},{name:"args",type:"variadic"}],(function(r){var e=r.message,t=r.args;throw F.String(e),F.Objects(t),D.Error("syntax-error",e[1],t)}))},xe=G("pair?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Pair(e))})),Ee=G("cons",[{name:"obj1"},{name:"obj2"}],(function(r){var e=r.obj1,t=r.obj2;return F.Object(e),F.Object(t),D.Pair(e,t)})),Ie=G("car",[{name:"pair"}],(function(r){var e=r.pair;return F.Pair(e),e[1]})),Oe=G("cdr",[{name:"pair"}],(function(r){var e=r.pair;return F.Pair(e),e[2]})),Pe=G("set-car!",[{name:"pair"},{name:"obj"}],(function(r){var e=r.pair,t=r.obj;if(F.Pair(e),F.Object(t),e[3])throw D.Error("immutable-object","Specified list is immutable");return e[1]=t,e})),Be=G("set-cdr!",[{name:"pair"},{name:"obj"}],(function(r){var e=r.pair,t=r.obj;if(F.Pair(e),F.Object(t),e[3])throw D.Error("immutable-object","Specified list is immutable");return e[2]=t,e})),Ce=G("caar",[{name:"pair"}],(function(r){var e=r.pair;return F.Pair(e),F.Pair(e[1]),e[1][1]})),Ae=G("cadr",[{name:"pair"}],(function(r){var e=r.pair;return F.Pair(e),F.Pair(e[2]),e[2][1]})),ke=G("cdar",[{name:"pair"}],(function(r){var e=r.pair;return F.Pair(e),F.Pair(e[1]),e[1][2]})),Le=G("cddr",[{name:"pair"}],(function(r){var e=r.pair;return F.Pair(e),F.Pair(e[2]),e[2][2]})),Ve=G("null?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Null(e))})),ze=G("list?",[{name:"obj"}],(function(r){var e=r.obj;if(F.Object(e),!R.List(e))return D.Boolean(!1);if(R.Null(e))return D.Boolean(!0);try{var t=i(X(e),2)[1];return D.Boolean(R.Null(t))}catch(r){return D.Boolean(!1)}})),Me=G("make-list",[{name:"k"},{name:"fill",type:"optional"}],(function(r){var e=r.k,t=r.fill;return F.IntegerNumber(e),t?(F.Object(t),D.List.apply(D,c(Array.from({length:e[1]},(function(){return t}))))):D.List.apply(D,c(Array.from({length:e[1]},(function(){return["<undefined>"]}))))})),Te=G("list",[{name:"objs",type:"variadic"}],(function(r){var e=r.objs;return F.Objects(e),D.List.apply(D,c(e))})),De=G("length",[{name:"list"}],(function(r){var e=r.list;return F.List(e),D.Number(_(e).length)})),Qe=G("append",[{name:"args",type:"variadic"}],(function(r){var e=r.args;if(F.Objects(e),0===e.length)return["<null>"];if(1===e.length)return e[0];var t=[e.slice(0,e.length-1),e[e.length-1]],n=t[0],a=t[1];return F.Lists(n),K(n.map((function(r){return _(r)})).flat(),a)})),Re=G("reverse",[{name:"list"}],(function(r){var e=r.list;return F.List(e),D.List.apply(D,c(_(e).reverse()))})),qe=G("list-tail",[{name:"list"},{name:"k"}],(function(r){var e=r.list,t=r.k;if(F.Object(e),F.IntegerNumber(t),0===t[1])return e;F.List(e);for(var n=e,a=0;R.Pair(n);n=n[2],a++)if(a===t[1])return n;throw D.Error("out-of-range","Specified list is shorter than specified number ".concat(t[1]))})),Ue=G("list-ref",[{name:"list"},{name:"k"}],(function(r){var e=r.list,t=r.k;F.Pair(e),F.IntegerNumber(t);for(var n=e,a=0;R.Pair(n);n=n[2],a++)if(a===t[1])return n[1];throw D.Error("out-of-range","Specified list is shorter than specified number ".concat(t[1]))})),Fe=G("list-set!",[{name:"list"},{name:"k"},{name:"obj"}],(function(r){var e=r.list,t=r.k,n=r.obj;F.Pair(e),F.IntegerNumber(t),F.Object(n);for(var a=e,o=0;R.Pair(a);a=a[2],o++)if(o===t[1]){if(a[3])throw D.Error("immutable-object","Specified list is immutable");return a[1]=n,["<undefined>"]}throw D.Error("out-of-range","Specified list is shorter than specified number ".concat(t[1]))})),Je=G("memq",[{name:"obj"},{name:"list"}],(function(r){var e=r.obj,t=r.list;F.Object(e),F.List(t);var n=_(t).findIndex((function(r){return Gr.body({obj1:e,obj2:r})[1]}));return n<0?D.Boolean(!1):qe.body({list:t,k:D.Number(n)})})),$e=G("memv",[{name:"obj"},{name:"list"}],(function(r){var e=r.obj,t=r.list;F.Object(e),F.List(t);var n=_(t).findIndex((function(r){return Wr.body({obj1:e,obj2:r})[1]}));return n<0?D.Boolean(!1):qe.body({list:t,k:D.Number(n)})})),Ze=G("member",[{name:"obj"},{name:"list"},{name:"compare",type:"optional"}],(function(r){var e=r.obj,t=r.list,n=r.compare;if(F.Object(e),F.List(t),R.Null(t))return D.Boolean(!1);if(n){F.Procedure(n);var a=i(t,3),o=a[1],u=a[2];return Q.If(Q.Call(n,o,e),t,Q.CallBuiltIn("member",e,u,n))}var c=_(t).findIndex((function(r){return Hr.body({obj1:e,obj2:r})[1]}));return c<0?D.Boolean(!1):Q.Quote(qe.body({list:t,k:D.Number(c)}))}),!0),_e=G("assq",[{name:"obj"},{name:"alist"}],(function(r){var e=r.obj,t=r.alist;F.Object(e),F.List(t);var n=_(t).find((function(r){return F.Pair(r),Gr.body({obj1:e,obj2:r[1]})[1]}));return null!=n?n:D.Boolean(!1)})),Xe=G("assv",[{name:"obj"},{name:"alist"}],(function(r){var e=r.obj,t=r.alist;F.Object(e),F.List(t);var n=_(t).find((function(r){return F.Pair(r),Wr.body({obj1:e,obj2:r[1]})[1]}));return null!=n?n:D.Boolean(!1)})),Ke=G("assoc",[{name:"obj"},{name:"alist"},{name:"compare",type:"optional"}],(function(r){var e=r.obj,t=r.alist,n=r.compare;if(F.Object(e),F.List(t),R.Null(t))return D.Boolean(!1);if(n){F.Procedure(n);var a=i(t,3),o=a[1],u=a[2];return F.Pair(o),Q.If(Q.Call(n,D.MultiValue([o[1],e])),Q.Quote(o),Q.CallBuiltIn("assoc",D.MultiValue([e,u,n])))}var c=_(t).find((function(r){return F.Pair(r),Hr.body({obj1:e,obj2:r[1]})[1]}));return c?Q.Quote(c):D.Boolean(!1)}),!0),We=G("list-copy",[{name:"obj"}],(function(r){var e=r.obj;if(F.Object(e),R.List(e)){if(R.Null(e))return["<null>"];var t=i(X(e),2),n=t[0],a=t[1];return K(n,a)}return e})),Ge={pairQ:xe,cons:Ee,car:Ie,cdr:Oe,setCarD:Pe,setCdrD:Be,caar:Ce,cadr:Ae,cdar:ke,cddr:Le,nullQ:Ve,listQ:ze,makeList:Me,list:Te,length:De,append:Qe,reverse:Re,listTail:qe,listRef:Ue,listSetD:Fe,memq:Je,memv:$e,member:Ze,assq:_e,assv:Xe,assoc:Ke,listCopy:We},He=G("number?",[{name:"obj"}],(function(r){var e=r.obj;return D.Boolean(R.Number(e))})),Ye=G("real?",[{name:"obj"}],(function(r){var e=r.obj;return D.Boolean(R.Number(e))})),rt=G("integer?",[{name:"obj"}],(function(r){var e=r.obj;return D.Boolean(R.Number(e)&&Number.isInteger(P(e)))})),et=G("exact?",[{name:"z"}],(function(r){var e=r.z;F.Number(e);var t=P(e);return D.Boolean(Number.isSafeInteger(t))})),tt=G("inexact?",[{name:"z"}],(function(r){var e=r.z;F.Number(e);var t=P(e);return D.Boolean(!Number.isSafeInteger(t))})),nt=H("exact-integer?",et),at=G("finite?",[{name:"z"}],(function(r){var e=r.z;F.Number(e);var t=P(e);return D.Boolean(Number.isFinite(t))})),ot=G("infinite?",[{name:"z"}],(function(r){var e=r.z;F.Number(e);var t=P(e);return D.Boolean(!Number.isNaN(t)&&!Number.isFinite(t))})),it=G("=",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,t=r.z2,n=r.zs;F.Number(e),F.Number(t),F.Numbers(n);var a=[e,t].concat(c(n)).map(P);return D.Boolean(a.slice(1).every((function(r){return a[0]===r})))})),ut=G("<",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,t=r.z2,n=r.zs;F.Number(e),F.Number(t),F.Numbers(n);var a=[e,t].concat(c(n)).map(P);return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]<r})))})),ct=G(">",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,t=r.z2,n=r.zs;F.Number(e),F.Number(t),F.Numbers(n);var a=[e,t].concat(c(n)).map(P);return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]>r})))})),lt=G("<=",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,t=r.z2,n=r.zs;F.Number(e),F.Number(t),F.Numbers(n);var a=[e,t].concat(c(n)).map(P);return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]<=r})))})),ft=G(">=",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,t=r.z2,n=r.zs;F.Number(e),F.Number(t),F.Numbers(n);var a=[e,t].concat(c(n)).map(P);return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]>=r})))})),st=G("nan?",[{name:"z"}],(function(r){var e=r.z;F.Number(e);var t=P(e);return D.Boolean(Number.isNaN(t))})),mt=G("zero?",[{name:"z"}],(function(r){var e=r.z;F.Number(e);var t=P(e);return D.Boolean(0===t)})),pt=G("positive?",[{name:"z"}],(function(r){var e=r.z;F.Number(e);var t=P(e);return D.Boolean(t>0)})),vt=G("negative?",[{name:"z"}],(function(r){var e=r.z;F.Number(e);var t=P(e);return D.Boolean(t<0)})),dt=G("odd?",[{name:"n"}],(function(r){var e=r.n;F.Number(e);var t=P(e);return D.Boolean(Number.isInteger(t)&&1===Math.abs(t%2))})),bt=G("even?",[{name:"n"}],(function(r){var e=r.n;F.Number(e);var t=P(e);return D.Boolean(Number.isInteger(t)&&0===Math.abs(t%2))})),yt=G("max",[{name:"xs",type:"variadic"}],(function(r){var e=r.xs;return F.Numbers(e),B(Math.max.apply(Math,c(e.map(P))))})),gt=G("min",[{name:"xs",type:"variadic"}],(function(r){var e=r.xs;return F.Numbers(e),B(Math.min.apply(Math,c(e.map(P))))})),ht=G("+",[{name:"zs",type:"variadic"}],(function(r){var e=r.zs;return F.Numbers(e),B(e.map(P).reduce((function(r,e){return r+e}),0))})),wt=G("-",[{name:"z1"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,t=r.zs;F.Number(e),F.Numbers(t);var n=P(e),a=t.map(P);return B(0===a.length?-n:a.reduce((function(r,e){return r-e}),n))})),St=G("*",[{name:"zs",type:"variadic"}],(function(r){var e=r.zs;return F.Numbers(e),B(e.map(P).reduce((function(r,e){return r*e}),1))})),jt=G("/",[{name:"z1"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,t=r.zs;F.Number(e),F.Numbers(t);var n=P(e),a=t.map(P);return a.includes(0)?D.Error("division-by-zero",null):B(0===a.length?1/n:a.reduce((function(r,e){return r/e}),n))})),Nt=G("abs",[{name:"x"}],(function(r){var e=r.x;F.Number(e);var t=P(e);return B(Math.abs(t))})),xt=G("floor/",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,t=r.n2;F.Number(e),F.Number(t);var n=P(e),a=P(t),o=(n%a+a)%a,i=(n-o)/a;return D.MultiValue([B(i),B(o)])})),Et=G("floor-quotient",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,t=r.n2;F.Number(e),F.Number(t);var n=P(e),a=P(t);return B((n-(n%a+a)%a)/a)})),It=G("floor-remainder",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,t=r.n2;F.Number(e),F.Number(t);var n=P(e),a=P(t);return B((n%a+a)%a)})),Ot=G("truncate/",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,t=r.n2;F.Number(e),F.Number(t);var n=P(e),a=P(t),o=n%a,i=(n-o)/a;return D.MultiValue([B(i),B(o)])})),Pt=G("truncate-quotient",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,t=r.n2;F.Number(e),F.Number(t);var n=P(e),a=P(t);return B((n-n%a)/a)})),Bt=G("truncate-remainder",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,t=r.n2;F.Number(e),F.Number(t);var n=P(e),a=P(t);return B(n%a)})),Ct=H("quotient",Pt),At=H("remainder",Bt),kt=H("modulo",It),Lt=G("gcd",[{name:"ns",type:"variadic"}],(function(r){var e=r.ns;if(F.Numbers(e),0===e.length)return B(0);return B(Math.abs(e.map(P).reduce((function r(e,t){return 0!==t?r(t,e%t):e}))))})),Vt=G("lcm",[{name:"ns",type:"variadic"}],(function(r){var e=r.ns;if(F.Numbers(e),0===e.length)return B(1);var t=function r(e,t){return 0!==t?r(t,e%t):e};return B(Math.abs(e.map(P).reduce((function(r,e){return r*e/t(r,e)}))))})),zt=G("floor",[{name:"x"}],(function(r){var e=r.x;F.Number(e);var t=P(e);return B(Math.floor(t))})),Mt=G("ceiling",[{name:"x"}],(function(r){var e=r.x;F.Number(e);var t=P(e);return B(Math.ceil(t))})),Tt=G("truncate",[{name:"x"}],(function(r){var e=r.x;F.Number(e);var t=P(e);return B(Math.trunc(t))})),Dt=G("round",[{name:"x"}],(function(r){var e=r.x;F.Number(e);var t=P(e);return B(Math.round(t))})),Qt={numberQ:He,realQ:Ye,integerQ:rt,exactQ:et,inexactQ:tt,exactIntegerQ:nt,finiteQ:at,infiniteQ:ot,eq:it,lt:ut,gt:ct,le:lt,ge:ft,nanQ:st,zeroQ:mt,positiveQ:pt,negativeQ:vt,oddQ:dt,evenQ:bt,max:yt,min:gt,add:ht,sub:wt,mul:St,div:jt,abs:Nt,floorS:xt,floorQuotient:Et,floorRemainder:It,truncateS:Ot,truncateQuotient:Pt,truncateRemainder:Bt,quotient:Ct,remainder:At,modulo:kt,gcd:Lt,lcm:Vt,floor:zt,ceiling:Mt,truncate:Tt,rationalize:G("rationalize",[{name:"x"},{name:"y"}],(function(){throw D.Error("not-supported",'"Fraction numbers are not supported.')})),round:Dt,square:G("square",[{name:"x"}],(function(r){var e=r.x;F.Number(e);var t=P(e);return B(Math.pow(t,2))})),exactIntegerSqrt:G("exact-integer-sqrt",[{name:"k"}],(function(r){var e=r.k;F.IntegerNumber(e);var t=P(e);if(!Number.isSafeInteger(t)||t<0)throw D.Error("out-of-range","exact-integer-sqrt can calculate safe integer & positive value.");for(var n=t;n>0;n--){var a=Math.floor(Math.sqrt(n)),o=t-Math.pow(a,2);if(t<Math.pow(a+1,2))return D.MultiValue([B(a),B(o)])}return D.MultiValue([B(0),B(t)])})),expt:G("expt",[{name:"z1"},{name:"z2"}],(function(r){var e=r.z1,t=r.z2;F.Number(e),F.Number(t);var n=P(e),a=P(t);return B(Math.pow(n,a))})),inexact:G("inexact",[{name:"z"}],(function(r){var e=r.z;return F.Number(e),e})),exact:G("exact",[{name:"z"}],(function(r){var e=r.z;F.Number(e);var t=P(e),n=Number(t.toFixed());if(!Number.isSafeInteger(n))throw D.Error("out-of-range",'"exact" can\'t calculate exact number for '.concat(e[1],"."));return e})),numberToString:G("number->string",[{name:"z"},{name:"radix",type:"optional"}],(function(r){var e=r.z,t=r.radix;F.Number(e),F.Number(t);var n=P(e);if(isNaN(n))return D.String("+nan.0",!1);if(isFinite(n)){t&&F.IntegerNumber(t);var a=t?P(t):10;if(![2,8,10,16].includes(a))throw D.Error("out-of-range","radix must be one of 2, 8, 10, 16.");return D.String(n.toString(a),!1)}return D.String("".concat(n>0?"+":"-","inf.0"),!1)})),stringToNumber:G("string->number",[{name:"str"},{name:"radix",type:"optional"}],(function(r){var e=r.str,t=r.radix;F.String(e);var n,a=e[1];if(t){if(F.IntegerNumber(t),![2,8,10,16].includes(P(t)))throw D.Error("out-of-range","radix must be one of 2, 8, 10, 16.");var o="#".concat({2:"b",8:"o",10:"d",16:"x"}[P(t)]);a=a.replace(/^(#[dDbBoOxX])?/,o)}try{n=lr(a)}catch(r){return D.Boolean(!1)}return R.Number(n)?n:D.Boolean(!1)}))},Rt=G("call-with-port",[{name:"port"},{name:"proc"}],(function(r){var e=r.port,t=r.proc;return F.Port(e),F.Procedure(t),Q.Begin(Q.Call(t,e),Q.CallBuiltIn("close-port",e))})),qt=G("input-port?",[{name:"obj"}],(function(r){var e,t=r.obj;return F.Object(t),D.Boolean(!(!R.Port(t)||null===(e=t[3])||void 0===e||!e.includes("r")))})),Ut=G("output-port?",[{name:"obj"}],(function(r){var e,t=r.obj;return F.Object(t),D.Boolean(!(!R.Port(t)||null===(e=t[3])||void 0===e||!e.includes("w")))})),Ft=G("textual-port?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Port(e)&&"string"==typeof e[5])})),Jt=G("binary-port?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Port(e)&&"string"!=typeof e[5])})),$t=G("port?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Port(e))})),Zt=G("input-port-open?",[{name:"port"}],(function(r){var e,t=r.port;return F.Port(t),D.Boolean(!(null===(e=t[3])||void 0===e||!e.includes("r")))})),_t=G("output-port-open?",[{name:"port"}],(function(r){var e,t=r.port;return F.Port(t),D.Boolean(!(null===(e=t[3])||void 0===e||!e.includes("w")))})),Xt=G("close-port",[{name:"port"}],(function(r,e){var t=r.port;if(F.Port(t),!t[3])return["<undefined>"];if("built-in"===t[1]){var n;if(!e)throw D.Error("program-error","No interpreter object.");var a=e.getBuiltInPort(t[2]);if(!a)throw D.Error("program-error","Illegal built-in file object.");null===(n=a.close)||void 0===n||n.call(a)}else if("string"!==t[1]){if("file"===t[1]){if(null==e||!e.fs)throw D.Error("program-error",'No interpreter object or No Node.js "fs" object set on Interpreter.');return e.fs.closeSync(t[2]),D.Boolean(!0)}throw D.Error("program-error",'Unknown port type "'.concat(t[1],'"'))}return t[3]=null,["<undefined>"]})),Kt=G("close-input-port",[{name:"port"}],(function(r){var e,t=r.port;if(F.Port(t),null===(e=t[3])||void 0===e||!e.includes("r"))return["<undefined>"];if("built-in"===t[1])throw D.Error("program-error","Can't close only output port for built-in port.");if("string"===t[1]);else if("bytevector"!==t[1])throw"file"===t[1]?D.Error("program-error","Can't close only input port for file port."):D.Error("program-error",'Unknown port type "'.concat(t[1],'"'));return t[3]=t[3].replace("r","")||null,["<undefined>"]})),Wt=G("close-output-port",[{name:"port"}],(function(r){var e,t=r.port;if(F.Port(t),null===(e=t[3])||void 0===e||!e.includes("w"))return["<undefined>"];if("built-in"===t[1])throw D.Error("program-error","Can't close only output port for built-in port.");if("string"===t[1]);else if("bytevector"!==t[1])throw"file"===t[1]?D.Error("program-error","Can't close only output port for file port."):D.Error("program-error",'Unknown port type "'.concat(t[1],'"'));return t[3]=t[3].replace("w","")||null,["<undefined>"]})),Gt=G("open-input-string",[{name:"str"}],(function(r){var e=r.str;return F.String(e),D.Port("string",e[1],"r",null,"")})),Ht=G("open-output-string",[],(function(){return D.Port("string","","w",null,"")})),Yt=G("get-output-string",[{name:"port"}],(function(r){var e,t=r.port;if(F.Port(t),"string"!==t[1]||null===(e=t[3])||void 0===e||!e.includes("w"))throw D.Error("read-error","Not a port created by open-output-string.");return D.String(t[2],!1)})),rn=G("open-input-bytevector",[{name:"bvec"}],(function(r){var e=r.bvec;return F.ByteVector(e),D.Port("bytevector",c(e[1]),"r",null,[])})),en=G("open-output-bytevector",[],(function(){return D.Port("bytevector",[],"w",null,[])})),tn=G("get-output-bytevector",[{name:"port"}],(function(r){var e,t=r.port;if(F.Port(t),"bytevector"!==t[1]||null===(e=t[3])||void 0===e||!e.includes("w"))throw D.Error("read-error","Not a port created by open-output-string.");return D.ByteVector(c(t[2]),!1)})),nn=G("read-char",[{name:"port",type:"optional"}],(function(r,e,t){var n,a=r.port;if(J(e),J(t),a||(a=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(a),null===(n=a[3])||void 0===n||!n.includes("r"))throw D.Error("read-error","Port is not open.");if("string"!=typeof a[5])throw D.Error("read-error","Not a text port.");var o=void 0;if(a[5].length>0)o=a[5][0],a[5]=a[5].slice(1);else if("built-in"===a[1]){var i,u=null==e?void 0:e.getBuiltInPort(a[2]);o=null==u||null===(i=u.read)||void 0===i?void 0:i.call(u,"character",null)}else if("string"===a[1])a[2].length>0?(o=a[2][0],a[2]=a[2].slice(1)):o=null;else{if("file"!==a[1])throw D.Error("program-error","Illegal type of port.");if(null==e||!e.fs)throw D.Error("read-error","No Interpreter or fs object.");for(var c=Buffer.alloc(4),l=0;;l++){if(!e.fs.readSync(a[2],c,{length:1,offset:l})){o=null;break}var f=c.toString("utf8",0,l+1);if(!f.includes("�")){o=f;break}if(l>=4)throw D.Error("read-error","Not a valid text(UTF-8) file.")}}if(null===o)return D.EndOfFile();if(void 0===o)throw D.Error("read-error",null);if("string"!=typeof o)throw D.Error("read-error","Read-data is not a expected format (number).");return D.Character(o)})),an=G("peek-char",[{name:"port",type:"optional"}],(function(r,e,t){var n=r.port;J(e),J(t),n||(n=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(n);var a=nn.body({port:n},e,t);return R.EndOfFile(a)||(n[5]="string"==typeof n[5]?a[1]+n[5]:a[1]),a})),on=G("read-line",[{name:"port",type:"optional"}],(function(r,e,t){var n=r.port;J(e),J(t),n||(n=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(n);for(var a="";;){var o=nn.body({port:n},e,t);if(R.EndOfFile(o))return""===a?o:D.String(a,!1);if("\n"===o[1])return D.String(a,!1);a+=o[1]}})),un=G("eof-object?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.EndOfFile(e))})),cn=G("eof-object",[],(function(){return D.EndOfFile()})),ln=G("char-ready?",[{name:"port",type:"optional"}],(function(r,e,t){var n,a=r.port;if(J(e),J(t),a||(a=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(a),null===(n=a[3])||void 0===n||!n.includes("r"))return D.Boolean(!1);if("built-in"===a[1]){var o;if(!e)throw D.Error("program-error","No interpreter object.");var i=e.getBuiltInPort(a[2]);if(!i)throw D.Error("program-error","Illegal built-in file object.");return D.Boolean(!(null===(o=i.ready)||void 0===o||!o.call(i)))}if("string"===a[1])return D.Boolean(!0);if("bytevector"===a[1])return D.Boolean(!1);throw"file"===a[1]?D.Error("program-error",'"Node.js file "ready" method is not implemented."'):D.Error("program-error",'Unknown port type "'.concat(a[1],'"'))})),fn=G("read-string",[{name:"k"},{name:"port",type:"optional"}],(function(r,e,t){var n=r.k,a=r.port;F.IntegerNumber(n),J(e),J(t),a||(a=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(a);for(var o="";;){var i=nn.body({port:a},e,t);if(R.EndOfFile(i))return 0===o.length?i:D.String(o,!1);if((o+=i[1]).length>=n[1])return D.String(o,!1)}})),sn=G("read-u8",[{name:"port",type:"optional"}],(function(r,e,t){var n,a=r.port;if(J(e),J(t),a||(a=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(a),null===(n=a[3])||void 0===n||!n.includes("r"))throw D.Error("read-error","Port is not open.");if("string"==typeof a[5])throw D.Error("read-error","Not a binary port.");var o=void 0;if(a[5].length>0)o=a[5][0],a[5]=a[5].slice(1);else if("built-in"===a[1]){var i,u=null==e?void 0:e.getBuiltInPort(a[2]);o=null==u||null===(i=u.read)||void 0===i?void 0:i.call(u,"byte",null)}else if("bytevector"===a[1])a[2].length>0?(o=a[2][0],a[2]=a[2].slice(1)):o=null;else{if("file"!==a[1])throw D.Error("program-error","Illegal type of port.");if(null==e||!e.fs)throw D.Error("read-error","No Interpreter or fs object.");var c=Buffer.alloc(1);o=e.fs.readSync(a[2],c)?c[0]:null}if(null===o)return D.EndOfFile();if(void 0===o)throw D.Error("read-error",null);if("number"!=typeof o)throw D.Error("read-error","Read-data is not a expected format (string).");return D.Number(o)})),mn=G("peek-u8",[{name:"port",type:"optional"}],(function(r,e,t){var n=r.port;J(e),J(t),n||(n=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(n);var a=sn.body({port:n},e,t);return R.EndOfFile(a)||(n[5]="string"!=typeof n[5]?[a[1]].concat(c(n[5])):[a[1]]),a})),pn=G("u8-ready?",[{name:"port",type:"optional"}],(function(r,e,t){var n,a=r.port;if(J(e),J(t),a||(a=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(a),null===(n=a[3])||void 0===n||!n.includes("r"))return D.Boolean(!1);if("built-in"===a[1]){var o;if(!e)throw D.Error("program-error","No interpreter object.");var i=e.getBuiltInPort(a[2]);if(!i)throw D.Error("program-error","Illegal built-in file object.");return D.Boolean(!(null===(o=i.ready)||void 0===o||!o.call(i)))}if("string"===a[1])return D.Boolean(!1);if("bytevector"===a[1])return D.Boolean(!0);if("file"===a[1]){if(null==e||!e.fs)throw D.Error("read-error","No Interpreter or fs object.");throw D.Error("program-error",'"Node.js file "ready" method is not implemented."')}throw D.Error("program-error",'Unknown port type "'.concat(a[1],'"'))})),vn=G("read-bytevector",[{name:"k"},{name:"port",type:"optional"}],(function(r,e,t){var n=r.k,a=r.port;F.IntegerNumber(n),J(e),J(t),a||(a=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(a);for(var o=[];;){var i=sn.body({port:a},e,t);if(R.EndOfFile(i))return 0===o.length?i:D.ByteVector(o,!1);if(o.push(i[1]),o.length>=n[1])return D.ByteVector(o,!1)}})),dn=G("read-bytevector!",[{name:"bvec"},{name:"port",type:"optional"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r,e,t){var n=r.bvec,a=r.port,o=r.start,i=r.end;F.ByteVector(n),J(e),J(t);var u=R.Number(o)?o[1]:0,c=R.Number(i)?i[1]:n[1].length;if("number"!=typeof u||!Number.isInteger(u)||"number"!=typeof c||!Number.isInteger(c))throw D.Error("domain-error","Index must be integer.");var l=c-u,f=vn.body({k:D.Number(l),port:a},e,t);if(R.EndOfFile(f))return f;for(var s=0;s<f[1].length;s++)n[1][u+s]=f[1][s];return D.Number(f[1].length)})),bn=G("newline",[{name:"port",type:"optional"}],(function(r,e,t){var n=r.port;return gn.body({str:D.String("\n",!1),port:n,start:null,end:null},e,t)})),yn=G("write-char",[{name:"char"},{name:"port",type:"optional"}],(function(r,e,t){var n=r.char,a=r.port;return F.Character(n),gn.body({str:D.String(n[1],!1),port:a,start:null,end:null},e,t)})),gn=G("write-string",[{name:"str"},{name:"port",type:"optional"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r,e,t){var n,a=r.str,o=r.port,i=r.start,u=r.end;F.String(a),J(e),J(t);var c=R.Number(i)?i[1]:0,l=R.Number(u)?u[1]:a[1].length;if("number"!=typeof c||!Number.isInteger(c)||"number"!=typeof l||!Number.isInteger(l))throw D.Error("domain-error","Index must be integer.");var f=a[1].slice(c,l);if(o||(o=e.getDynamic(V(t).env.dynamic,"current-output-port")),F.Port(o),null===(n=o[3])||void 0===n||!n.includes("w"))throw D.Error("write-error","Port is not open for writing.");if("string"!=typeof o[5])throw D.Error("write-error","Not a text port.");if("built-in"===o[1]){if(!e)throw D.Error("program-error","No interpreter object.");var s=e.getBuiltInPort(o[2]);if(!s||!s.write)throw D.Error("program-error","No built-in method defined to write.");s.write(f)}else if("string"===o[1])o[2]=o[2]+f;else{if("file"!==o[1])throw D.Error("program-error","Illegal type of port for writing.");if(null==e||!e.fs)throw D.Error("write-error","No Interpreter or fs object.");e.fs.writeSync(o[2],f)}return["<undefined>"]})),hn=G("write-u8",[{name:"byte"},{name:"port",type:"optional"}],(function(r,e,t){var n=r.byte,a=r.port;return F.IntegerNumber(n),wn.body({bvec:D.ByteVector([n[1]],!1),port:a},e,t)})),wn=G("write-bytevector",[{name:"bvec"},{name:"port",type:"optional"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r,e,t){var n,a=r.bvec,o=r.port,i=r.start,u=r.end;F.ByteVector(a),J(e),J(t);var l=R.Number(i)?i[1]:0,f=R.Number(u)?u[1]:a[1].length;if("number"!=typeof l||!Number.isInteger(l)||"number"!=typeof f||!Number.isInteger(f))throw D.Error("domain-error","Index must be integer.");var s=a[1].slice(l,f);if(o||(o=e.getDynamic(V(t).env.dynamic,"current-output-port")),F.Port(o),null===(n=o[3])||void 0===n||!n.includes("w"))throw D.Error("write-error","Port is not open for writing.");if("string"==typeof o[5])throw D.Error("write-error","Not a binary port.");if("built-in"===o[1]){if(!e)throw D.Error("program-error","No interpreter object.");var m=e.getBuiltInPort(o[2]);if(!m||!m.write)throw D.Error("program-error","No built-in method defined to write.");m.write(new Uint8Array(s))}else if("bytevector"===o[1]){var p;(p=o[2]).push.apply(p,c(s))}else{if("file"!==o[1])throw D.Error("program-error","Illegal type of port for writing.");if(null==e||!e.fs)throw D.Error("write-error","No Interpreter or fs object.");e.fs.writeSync(o[2],new Uint8Array(s))}return["<undefined>"]})),Sn=G("flush-output-port",[{name:"port",type:"optional"}],(function(r,e,t){var n,a=r.port;if(J(e),J(t),a||(a=e.getDynamic(V(t).env.dynamic,"current-output-port")),F.Port(a),null===(n=a[3])||void 0===n||!n.includes("w"))throw D.Error("write-error","Port is not open for writing.");if("built-in"===a[1]){var o;if(!e)throw D.Error("program-error","No interpreter object.");var i=e.getBuiltInPort(a[2]);if(!i)throw D.Error("program-error","No built-in method defined to write.");null===(o=i.flush)||void 0===o||o.call(i)}else if("file"===a[1]){if(null==e||!e.fs)throw D.Error("write-error","No Interpreter or fs object.");e.fs.fsyncSync(a[2])}return["<undefined>"]})),jn={callWithPort:Rt,inputPortQ:qt,outputPortQ:Ut,textualPortQ:Ft,binaryPortQ:Jt,portQ:$t,inputPortOpenQ:Zt,outputPortOpenQ:_t,closePort:Xt,closeInputPort:Kt,closeOutputPort:Wt,openInputString:Gt,openOutputString:Ht,getOutputString:Yt,openInputBytevector:rn,openOutputBytevector:en,getOutputBytevector:tn,readChar:nn,peekChar:an,readLine:on,eofObjectQ:un,eofObject:cn,charReadyQ:ln,readString:fn,readU8:sn,peekU8:mn,u8ReadyQ:pn,readBytevector:vn,readBytevectorD:dn,newline:bn,writeChar:yn,writeString:gn,writeU8:hn,writeBytevector:wn,flushOutputPort:Sn},Nn={stringQ:G("string?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.String(e))})),makeString:G("make-string",[{name:"k"},{name:"char",type:"optional"}],(function(r){var e=r.k,t=r.char;return F.IntegerNumber(e),t&&F.Character(t),D.String((t?t[1]:" ").repeat(e[1]),!1)})),string:G("string",[{name:"chars",type:"variadic"}],(function(r){var e=r.chars;return F.Characters(e),D.String(e.map((function(r){return r[1]})).join(""),!1)})),stringLength:G("string-length",[{name:"str"}],(function(r){var e=r.str;return F.String(e),D.Number(e[1].length)})),stringRef:G("string-ref",[{name:"str"},{name:"k"}],(function(r){var e=r.str,t=r.k;F.String(e),F.IntegerNumber(t);var n=e[1][t[1]];if(!n)throw D.Error("out-of-range","The specified string doesn't have character with index ".concat(t[1],"."));return D.Character(n)})),stringSetD:G("string-set!",[{name:"str"},{name:"k"},{name:"char"}],(function(r){var e=r.str,t=r.k,n=r.char;return F.String(e),F.IntegerNumber(t),F.Character(n),e[1]=e[1].slice(0,t[1])+n[1]+e[1].slice(t[1]+n[1].length),["<undefined>"]})),stringEQ:G("string=?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,t=r.str2,n=r.strs;return F.String(e),F.String(t),F.Strings(n),D.Boolean([t].concat(c(n)).every((function(r){return r[1]===e[1]})))})),stringLtQ:G("string<?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,t=r.str2,n=r.strs;F.String(e),F.String(t),F.Strings(n);var a=[e,t].concat(c(n)).map((function(r){return r[1]}));return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]<r})))})),stringGtQ:G("string>?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,t=r.str2,n=r.strs;F.String(e),F.String(t),F.Strings(n);var a=[e,t].concat(c(n)).map((function(r){return r[1]}));return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]>r})))})),stringLeQ:G("string<=?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,t=r.str2,n=r.strs;F.String(e),F.String(t),F.Strings(n);var a=[e,t].concat(c(n)).map((function(r){return r[1]}));return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]<=r})))})),stringGeQ:G("string>=?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,t=r.str2,n=r.strs;F.String(e),F.String(t),F.Strings(n);var a=[e,t].concat(c(n)).map((function(r){return r[1]}));return D.Boolean(a.every((function(r,e){return 0===e||a[e-1]>=r})))})),substring:G("substring",[{name:"str"},{name:"start"},{name:"end"}],(function(r){var e=r.str,t=r.start,n=r.end;return F.String(e),F.IntegerNumber(t),F.IntegerNumber(n),0===e[1].length?D.String("",!1):D.String(e[1].slice(t[1],n[1]),!1)})),stringAppend:G("string-append",[{name:"strs",type:"variadic"}],(function(r){var e=r.strs;return F.Strings(e),D.String(e.map((function(r){return r[1]})).join(""),!1)})),stringToList:G("string->list",[{name:"str"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,t=r.start,n=r.end;F.String(e);var a=e[1],o=R.Number(t)?t[1]:0,i=R.Number(n)?n[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw D.Error("domain-error","Index must be integer.");return D.List.apply(D,c(a.slice(o,i).split("").map((function(r){return D.Character(r)}))))})),listToString:G("list->string",[{name:"list"}],(function(r){var e=r.list;F.List(e);var t=_(e);return F.Characters(t),D.String(t.map((function(r){return r[1]})).join(""),!1)})),stringCopy:G("string-copy",[{name:"str"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,t=r.start,n=r.end;F.String(e);var a=e[1],o=R.Number(t)?t[1]:0,i=R.Number(n)?n[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw D.Error("domain-error","Index must be integer.");return D.String(a.slice(o,i),!1)})),stringCopyD:G("string-copy!",[{name:"to"},{name:"at"},{name:"from"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.to,t=r.at,n=r.from,a=r.start,o=r.end;F.String(e),F.IntegerNumber(t),F.String(n);var i=n[1],u=R.Number(a)?a[1]:0,c=R.Number(o)?o[1]:i.length;if("number"!=typeof u||!Number.isInteger(u)||"number"!=typeof c||!Number.isInteger(c))throw D.Error("domain-error","Index must be integer.");if(t[1]<0||t[1]>=i.length)throw D.Error("out-of-range","Index is out of range.");if(i.length-t[1]<c-u)throw D.Error("out-of-range","Index is out of range.");var l=i.slice(u,c);return e[1]=e[1].slice(0,t[1])+l+e[1].slice(t[1]+l.length),["<undefined>"]})),stringFillD:G("string-fill!",[{name:"str"},{name:"fill"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,t=r.fill,n=r.start,a=r.end;F.String(e),F.Character(t);var o=e[1],i=R.Number(n)?n[1]:0,u=R.Number(a)?a[1]:o.length;if("number"!=typeof i||!Number.isInteger(i)||"number"!=typeof u||!Number.isInteger(u))throw D.Error("domain-error","Index must be integer.");var c=o.slice(i,u);return e[1]=e[1].slice(0,i)+t[1].repeat(c.length)+e[1].slice(u),e}))},xn={Import:G("import",[{name:"sets",type:"variadic",evaluate:!1}],(function(r,e,t){var n,a=r.sets;if(F.Objects(a),J(e),J(t),!(V(t).depth<=(null!==(n=e.getOptions().toplevelDepth)&&void 0!==n?n:1)))throw D.Error("not-implemented",'"import" is only supported on the toplevel.');var o=a.map((function(r){return I(r)}));if(o.some((function(r){return["(only ","(except ","(prefix ","(rename "].some((function(e){return 0===r.indexOf(e)}))})))throw D.Error("not-implemented",'"import" with "only", "except", "prefix", or "rename" is not supported yet.');var i,u=v(o);try{for(u.s();!(i=u.n()).done;){var c=i.value;if("(scheme base)"!==c){var l=e.getBuiltInLibrary(c);if(!l)throw D.Error("error",'Library "'.concat(l,' not found."'));for(var f=l(e),s=0,m=Object.keys(f);s<m.length;s++){var p=m[s];e.defineStatic(V(t).env.static,D.Symbol(p),f[p])}}}}catch(r){u.e(r)}finally{u.f()}return["<undefined>"]}),!0),define:G("define",[{name:"arg1",evaluate:!1},{name:"arg2",type:"variadic",evaluate:!1}],(function(r,e,t){var n,a=r.arg1,o=r.arg2;F.Object(a),F.Objects(o),J(e),J(t);var u,l=V(t).depth<=(null!==(n=e.getOptions().toplevelDepth)&&void 0!==n?n:1);if(R.Symbol(a)){var f,s=a,m=i(o,1)[0];if(!l&&!R.Undefined(null!==(f=A(V(t).env.static)[s[1]])&&void 0!==f?f:["<undefined>"]))throw D.Error("redefine-variable",null);return e.defineStatic(V(t).env.static,s,["<undefined>"]),Q.Set(s,m)}F.Pair(a);var p=i(a,3),v=p[1],d=p[2],b=o;if(F.Symbol(v),F.List(d),!l&&!R.Undefined(null!==(u=A(V(t).env.static)[v[1]])&&void 0!==u?u:["<undefined>"]))throw D.Error("redefine-variable",null);var y=i(rr(d),2),g=y[0],h=y[1];return e.defineStatic(V(t).env.static,v,D.Procedure("lambda",h?[].concat(c(g),[h]):g,Q.BeginIfMultiple.apply(Q,c(b)),!1,V(t).env)),["<undefined>"]}),!0),defineValues:G("define-values",[{name:"formals",evaluate:!1},{name:"expr"}],(function(r,e,t){var n,a=r.formals,o=r.expr;F.Object(a),F.Object(o),J(e),J(t);for(var u=V(t).depth<=(null!==(n=e.getOptions().toplevelDepth)&&void 0!==n?n:1),l=i(rr(a),2),f=l[0],s=l[1],m=R.MultiValue(o)?o[1]:[o],p=0;p<f.length;p++){var v;if(!m[p])throw D.Error("arity-error",null);if(!u&&!R.Undefined(null!==(v=A(V(t).env.static)[f[p].name])&&void 0!==v?v:["<undefined>"]))throw D.Error("redefine-variable",null);e.defineStatic(V(t).env.static,D.Symbol(f[p].name),m[p])}return s&&e.defineStatic(V(t).env.static,D.Symbol(s.name),D.List.apply(D,c(m.slice(f.length)))),["<undefined>"]})),defineSyntax:G("define-syntax",[{name:"keyword",evaluate:!1},{name:"spec"}],(function(r,e,t){var n,a,o=r.keyword,i=r.spec;if(F.Symbol(o),F.SyntaxRules(i),J(e),J(t),!(V(t).depth<=(null!==(n=e.getOptions().toplevelDepth)&&void 0!==n?n:1))&&!R.Undefined(null!==(a=A(V(t).env.static)[o[1]])&&void 0!==a?a:["<undefined>"]))throw D.Error("redefine-variable",null);var u=D.Procedure("lambda",[{name:"exprs",type:"variadic",evaluate:!1}],Q.CallBuiltIn("use-syntax-rules",i,D.Symbol("exprs")),!0,V(t).env);return e.defineStatic(V(t).env.static,o,u),["<undefined>"]})),defineRecordType:G("define-record-type",[{name:"name",evaluate:!1},{name:"ctor",evaluate:!1},{name:"pred",evaluate:!1},{name:"fields",evaluate:!1,type:"variadic"}],(function(r,e,t){var n,a,o,l=r.name,f=r.ctor,s=r.pred,m=r.fields;F.Symbol(l),F.Pair(f),F.Symbol(s),F.Pairs(m),J(e),J(t);var p=V(t).depth<=(null!==(n=e.getOptions().toplevelDepth)&&void 0!==n?n:1);if(!(p||R.Undefined(null!==(a=A(V(t).env.static)[l[1]])&&void 0!==a?a:["<undefined>"])&&R.Undefined(null!==(o=A(V(t).env.static)[s[1]])&&void 0!==o?o:["<undefined>"])))throw D.Error("redefine-variable",null);var d=V(t).env,b=D.RecordType(l[1]),y=u(_(f)),g=y[0],h=y.slice(1);F.Symbol(g),F.Symbols(h);var w=D.Symbol("rec");e.defineStatic(V(t).env.static,g,D.Procedure("lambda",h.map((function(r){return{name:r[1]}})),Q.BeginIfMultiple.apply(Q,[Q.Define(w,Q.CallBuiltIn("make-record",b))].concat(c(h.map((function(r){return Q.CallBuiltIn("record-set!",w,r,r)}))),[w])),!1,d));var S=D.Symbol("rec");e.defineStatic(V(t).env.static,s,D.Procedure("lambda",[{name:S[1]}],Q.CallBuiltIn("record-type?",S,b),!1,d));var j,N=v(m);try{var x=function(){var r,n=j.value,a=i(_(n),3),o=a[0],u=a[1],c=a[2];if(F.Symbol(o),F.Symbol(u),!h.some((function(r){return r[1]===o[1]})))throw D.Error("domain-error","Unknown field name");if(!p&&!R.Undefined(null!==(r=A(V(t).env.static)[u[1]])&&void 0!==r?r:["<undefined>"]))throw D.Error("redefine-variable",null);var l=D.Symbol("rec");if(e.defineStatic(V(t).env.static,u,D.Procedure("lambda",[{name:l[1]}],Q.CallBuiltIn("record-get",l,o),!1,d)),c){var f;if(F.Symbol(c),!p&&!R.Undefined(null!==(f=A(V(t).env.static)[c[1]])&&void 0!==f?f:["<undefined>"]))throw D.Error("redefine-variable",null);var s=D.Symbol("rec"),m=D.Symbol("value");e.defineStatic(V(t).env.static,c,D.Procedure("lambda",[{name:s[1]},{name:m[1]}],Q.CallBuiltIn("record-set!",s,o,m),!1,d))}};for(N.s();!(j=N.n()).done;)x()}catch(r){N.e(r)}finally{N.f()}return["<undefined>"]})),makeRecord:G("make-record",[{name:"type"}],(function(r){var e=r.type;return F.RecordType(e),D.Record(e,{})}),!1,!0),recordTypeQ:G("record-type?",[{name:"rec"},{name:"type"}],(function(r){var e=r.rec,t=r.type;return F.Object(e),F.RecordType(t),R.Record(e)?Wr.body({obj1:e[1],obj2:t}):D.Boolean(!1)}),!1,!0),recordGet:G("record-get",[{name:"rec"},{name:"field",evaluate:!1}],(function(r){var e,t=r.rec,n=r.field;return F.Record(t),F.Symbol(n),null!==(e=t[2][n[1]])&&void 0!==e?e:["<undefined>"]}),!1,!0),recordSetD:G("record-set!",[{name:"rec"},{name:"field",evaluate:!1},{name:"value"}],(function(r){var e=r.rec,t=r.field,n=r.value;if(F.Record(e),F.Symbol(t),F.Object(n),R.Undefined(n))throw D.Error("undefined-value","Attempt to set an undefined value.");return e[2][t[1]]=n,["<undefined>"]}),!1,!0)},En={symbolQ:G("symbol?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Symbol(e))})),symbolEQ:G("symbol=?",[{name:"symbol1"},{name:"symbol2"},{name:"symbols",type:"variadic"}],(function(r){var e=r.symbol1,t=r.symbol2,n=r.symbols;return F.Symbol(e),F.Symbol(t),F.Symbols(n),D.Boolean([t].concat(c(n)).every((function(r){return r[1]===e[1]})))})),symbolToString:G("symbol->string",[{name:"obj"}],(function(r){var e=r.obj;return F.Symbol(e),D.String(e[1],!0)})),stringToSymbol:G("string->symbol",[{name:"obj"}],(function(r){var e=r.obj;return F.String(e),D.Symbol(e[1])}))},In={vectorQ:G("vector?",[{name:"obj"}],(function(r){var e=r.obj;return F.Object(e),D.Boolean(R.Vector(e))})),makeVector:G("make-vector",[{name:"k"},{name:"fill",type:"optional"}],(function(r){var e=r.k,t=r.fill;return F.IntegerNumber(e),t&&F.Object(t),D.Vector(Array(e[1]).fill(t||["<undefined>"]),!1)})),vector:G("vector",[{name:"objs",type:"variadic"}],(function(r){var e=r.objs;return F.Objects(e),D.Vector(e,!1)})),vectorLength:G("vector-length",[{name:"vec"}],(function(r){var e=r.vec;return F.Vector(e),D.Number(e[1].length)})),vectorRef:G("vector-ref",[{name:"vec"},{name:"k"}],(function(r){var e=r.vec,t=r.k;if(F.Vector(e),F.IntegerNumber(t),!(t[1]in e[1]))throw D.Error("out-of-range","Index is out of range.");return e[1][t[1]]})),vectorSetD:G("vector-set!",[{name:"vec"},{name:"k"},{name:"obj"}],(function(r){var e=r.vec,t=r.k,n=r.obj;if(F.Vector(e),F.IntegerNumber(t),F.Object(n),!(t[1]in e[1]))throw D.Error("out-of-range","Index is out of range.");if(R.Undefined(n))throw D.Error("undefined-value","Attempt to set a undefined value to vector.");return e[1][t[1]]=n,["<undefined>"]})),vector2list:G("vector->list",[{name:"vec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.vec,t=r.start,n=r.end;F.Vector(e);var a=e[1],o=R.Number(t)?t[1]:0,i=R.Number(n)?n[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw D.Error("domain-error","Index must be integer.");return D.List.apply(D,c(a.slice(o,i)))})),list2vector:G("list->vector",[{name:"list"}],(function(r){var e=r.list;return F.List(e),D.Vector(_(e),!1)})),vector2string:G("vector->string",[{name:"vec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.vec,t=r.start,n=r.end;F.Vector(e);var a=e[1],o=R.Number(t)?t[1]:0,i=R.Number(n)?n[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw D.Error("domain-error","Index must be integer.");return D.String(a.slice(o,i).map((function(r){return F.Character(r),r[1]})).join(""),!1)})),string2vector:G("string->vector",[{name:"str"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,t=r.start,n=r.end;F.String(e);var a=e[1],o=R.Number(t)?t[1]:0,i=R.Number(n)?n[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw D.Error("domain-error","Index must be integer.");return D.Vector(a.slice(o,i).split("").map((function(r){return D.Character(r)})),!1)})),vectorCopy:G("vector-copy",[{name:"vec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.vec,t=r.start,n=r.end;F.Vector(e);var a=e[1];if(0===a.length)return D.Vector([],!1);var o=R.Number(t)?t[1]:0,i=R.Number(n)?n[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw D.Error("domain-error","Index must be integer.");return D.Vector(a.slice(o,i),!1)})),vectorCopyD:G("vector-copy!",[{name:"to"},{name:"at"},{name:"from"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e,t=r.to,n=r.at,a=r.from,o=r.start,i=r.end;F.Vector(t),F.IntegerNumber(n),F.Vector(a);var u=R.Number(o)?o[1]:0,l=R.Number(i)?i[1]:a[1].length;if("number"!=typeof u||!Number.isInteger(u)||"number"!=typeof l||!Number.isInteger(l))throw D.Error("domain-error","Index must be integer.");if(!(n[1]in t[1]))throw D.Error("out-of-range","Index is out of range.");if(t[1].length-n[1]<l-u)throw D.Error("out-of-range","Index is out of range.");var f=a[1].slice(u,l);return(e=t[1]).splice.apply(e,[n[1],f.length].concat(c(f))),["<undefined>"]})),vectorAppend:G("vector-append",[{name:"vecs",type:"variadic"}],(function(r){var e=r.vecs;return F.Vectors(e),D.Vector(e.map((function(r){return r[1]})).flat(),!1)})),vectorFillD:G("vector-fill!",[{name:"vec"},{name:"fill"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.vec,t=r.fill,n=r.start,a=r.end;if(F.Vector(e),F.Object(t),R.Undefined(t))throw D.Error("undefined-value","Attempt to fill vector with an undefined value.");var o=e[1],i=R.Number(n)?n[1]:0,u=R.Number(a)?a[1]:o.length;if("number"!=typeof i||!Number.isInteger(i)||"number"!=typeof u||!Number.isInteger(u))throw D.Error("domain-error","Index must be integer.");for(var c=i;c<u;c++)c in o&&(o[c]=t);return e}))},On={suspend:G("suspend",[{name:"obj",type:"optional"}],(function(r,e,t){var n=r.obj;throw J(t),n&&F.Object(n),D.Suspend(D.Continuation(k(t)),null!=n?n:D.Undefined())}))},Pn=[G("write",[{name:"obj"},{name:"port",type:"optional"}],(function(r){var e,t=r.obj,n=r.port;F.Object(t),n&&F.Object(n);try{e=N(x([E(t)]))}catch(r){if(r instanceof Error)throw D.Error("write-error",r.message);throw r}return n?Q.CallBuiltIn("write-string",D.String(e,!1),n):Q.CallBuiltIn("write-string",D.String(e,!1))}),!0,!0),G("write-shared",[{name:"obj"},{name:"port",type:"optional"}],(function(r){var e,t=r.obj,n=r.port;F.Object(t),n&&F.Object(n);try{e=N(x([E(t,{labels:"shared"})]))}catch(r){if(r instanceof Error)throw D.Error("write-error",r.message);throw r}return n?Q.CallBuiltIn("write-string",D.String(e,!1),n):Q.CallBuiltIn("write-string",D.String(e,!1))}),!0,!0),G("write-simple",[{name:"obj"},{name:"port",type:"optional"}],(function(r){var e,t=r.obj,n=r.port;F.Object(t),n&&F.Object(n);try{e=N(x([E(t,{labels:"simple"})]))}catch(r){if(r instanceof Error)throw D.Error("write-error",r.message);throw r}return n?Q.CallBuiltIn("write-string",D.String(e,!1),n):Q.CallBuiltIn("write-string",D.String(e,!1))}),!0,!0),G("display",[{name:"obj"},{name:"port",type:"optional"}],(function(r){var e,t=r.obj,n=r.port;F.Object(t),n&&F.Object(n);try{e=N(x([E(t,{style:"display"})]))}catch(r){if(r instanceof Error)throw D.Error("write-error",r.message);throw r}return n?Q.CallBuiltIn("write-string",D.String(e,!1),n):Q.CallBuiltIn("write-string",D.String(e,!1))}),!0,!0)],Bn=[G("read",[{name:"port",type:"optional"}],(function(r,e,t){var n=r.port;if(J(e),J(t),n||(n=e.getDynamic(V(t).env.dynamic,"current-input-port")),F.Port(n),"string"!=typeof n[5])throw D.Error("read-error","Not a text port.");for(var a,o,c="";;){var l=nn.body({port:n},e,t);if(R.EndOfFile(l))break;c+=l[1]}try{var f=ir(c),s=i(ur(f),2);a=s[0],o=s[1]}catch(r){throw r instanceof Error?D.Error("read-error",r.message):D.Error("read-error","Error occured while reading.")}if(0===a.length){if(o.length>0)throw D.Error("read-error","The external representation is incomplete and therefore not parsable,");return D.EndOfFile()}var m=u(a),p=m[0],v=m.slice(1),d=cr(p),b=x(v),y=N(b);return n[5]=y+n[5],d}),!1,!0)],Cn=[].concat(c(Object.values(vr)),c(Object.values(Ir)),c(Object.values(zr)),c(Object.values(Kr)),c(Object.values(Yr)),c(Object.values(le)),c(Object.values(Ne)),c(Object.values(Ge)),c(Object.values(Qt)),c(Object.values(jn)),c(Object.values(Nn)),c(Object.values(xn)),c(Object.values(En)),c(Object.values(In)),c(Object.values(On))),An={"(scheme write)":function(r){Pn.forEach((function(e){return r.setBuiltInProcedure(e)}));var e={};return Pn.forEach((function(r){var t=r.name;return e[t]=D.Procedure("built-in",t)})),e},"(scheme read)":function(r){Bn.forEach((function(e){return r.setBuiltInProcedure(e)}));var e={};return Bn.forEach((function(r){var t=r.name;return e[t]=D.Procedure("built-in",t)})),e}},kn=[],Ln=console,Vn=function(){function r(e){var t,n,a=this;!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),o(this,"builtins",{jsObject:{},procedure:{},port:{"//input":{},"//output":{write:function(r){return Ln.log(r)}},"//error":{write:function(r){return Ln.warn(r)}}},static:{"current-input-port":D.Parameter("current-input-port",null),"current-output-port":D.Parameter("current-output-port",null),"current-error-port":D.Parameter("current-error-port",null)},dynamic:{"current-input-port":D.Port("built-in","//input","r",null,""),"current-output-port":D.Port("built-in","//output","w",null,""),"current-error-port":D.Port("built-in","//error","w",null,"")},library:{}}),o(this,"fs",null),this.options=null!=e?e:{},this.fs=null!==(t=null==e?void 0:e.fs)&&void 0!==t?t:null,kn.forEach((function(r){var e=i(r,2),t=e[0],n=e[1];return a.setBuiltInJSObject(t,n)})),Cn.forEach((function(r){return a.setBuiltInProcedure(r)})),Object.keys(An).forEach((function(r){return a.setBuiltInLibrary(r,An[r])})),null==e||null===(n=e.plugins)||void 0===n||n.forEach((function(r){return r(a)}))}var e,u,l;return e=r,(u=[{key:"getOptions",value:function(){return this.options}},{key:"setBuiltInProcedure",value:function(r){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=D.Procedure("built-in",r.name);return!e&&this.getProcedureContent(t)||(this.builtins.procedure[r.name]=r),t}},{key:"setBuiltInJSObject",value:function(r,e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=D.JS("built-in",r);return!t&&this.getJSObjectContent(n)||(this.builtins.jsObject[r]=e),n}},{key:"setBuiltInPort",value:function(r,e){var t,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=D.Port("built-in",r,null,null,null!==(t=e.binary)&&void 0!==t&&t.call(e)?[]:"");return!n&&this.getBuiltInPort(r)||(this.builtins.port[r]=e),a}},{key:"setBuiltInLibrary",value:function(r,e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!t&&this.getBuiltInPort(r)||(this.builtins.library[r]=e),D.Symbol(r)}},{key:"getProcedureContent",value:function(r){if(R.Continuation(r))return{parameters:[{name:"arg",evaluate:!0,type:"variadic"}],body:r,isMacro:!1,env:null};if(R.Parameter(r))return{parameters:[],body:r,isMacro:!1,env:null};if("lambda"===r[1]){var e=i(r,6);return{parameters:e[2],body:e[3],isMacro:e[4],env:e[5]}}var t=i(r,3)[2];if(Z.call(this.builtins.procedure,t)){var n=this.builtins.procedure[t],a=n.parameters,o=n.body,u=n.isMacro;return{parameters:a,body:o,isMacro:void 0!==u&&u,env:null}}return null}},{key:"getJSObjectContent",value:function(r){if("inline"===r[1])return r[2];var e=r[2];return Z.call(this.builtins.jsObject,e)?this.builtins.jsObject[e]:null}},{key:"getBuiltInPort",value:function(r){return Z.call(this.builtins.port,r)?this.builtins.port[r]:null}},{key:"getBuiltInLibrary",value:function(r){return Z.call(this.builtins.library,r)?this.builtins.library[r]:null}},{key:"defineStatic",value:function(r,e,t){var n=e[3]?e[3]:e[1];return r=e[2]?e[2]:r,A(r)[n]=t,n}},{key:"defineDynamic",value:function(r,e,t){return A(r)[e]=t,e}},{key:"setStatic",value:function(r,e,t){for(var n=e[3]?e[3]:e[1],a=r=e[2]?e[2]:r;null!==a;a=C(a)){var o=A(a);if(Z.call(o,n))return o[n]=t}return null}},{key:"setDynamic",value:function(r,e,t){for(var n=r;null!==n;n=C(n)){var a=A(n);if(Z.call(a,e))return a[e]=t}return null}},{key:"getStatic",value:function(r,e){for(var t=e[3]?e[3]:e[1],n=r=e[2]?e[2]:r;null!==n;n=C(n)){var a=A(n);if(Z.call(a,t))return a[t]}return Z.call(this.builtins.static,t)?this.builtins.static[t]:Z.call(this.builtins.procedure,t)&&!this.builtins.procedure[t].hidden?["<procedure>","built-in",t]:null}},{key:"getDynamic",value:function(r,e){for(var t=r;null!==t;t=C(t)){var n=A(t);if(Z.call(n,e))return n[e]}return Z.call(this.builtins.dynamic,e)?this.builtins.dynamic[e]:null}},{key:"eval",value:function(r){return this.evalAST(fr(r))}},{key:"evalJS",value:function(r){return this.evalAST(Q.Begin(lr(r)))}},{key:"resume",value:function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.Undefined();if(er(r)&&!tr(r))throw new Error("The content of envelope is not #SUSPEND# object.");var t=tr(r)?r.content[1]:r[1];return this.evalAST(Q.Begin(Q.Call(t,e)))}},{key:"evalAST",value:function(r){var e,t=(e=r,["#CALL-STACK#",{depth:0,env:{static:D.StaticNS({},null),dynamic:D.DynamicNS({},null)},expr:e,want:null,oper:null,args:null,before:null,after:null,handler:null,info:R.Pair(e)&&e[4]||null},null]),n=null;try{for(var a=t;a;){var o,u;if(V(a).depth>(null!==(o=this.options.stack)&&void 0!==o?o:16384))throw new Error("Call-stack overflow.");if(this.options.beforeExecute){var c,l=i(null!==(c=this.options.beforeExecute(a,n))&&void 0!==c?c:[a,n],2);a=l[0],n=l[1]}this.options.debug&&Ln.log("Executing(".concat(null!==(u=a[1].want)&&void 0!==u?u:"initial","/depth:").concat(a[1].depth,") ").concat(I(a[1].expr)));var f=i(this.execute(a,n),2),s=f[0],m=f[1];if(this.options.debug){var p,v=s?k(s)===a?"wind":k(a)===s?"unwind":k(s)==k(s)?"transfer":"unknown":"finish";Ln.log("Result: ".concat(m?I(m):m," (").concat(v,").")),s&&this.options.verbose&&Ln.log("Next(".concat(null!==(p=s[1].want)&&void 0!==p?p:"initial","/depth:").concat(s[1].depth,") ").concat(I(s[1].expr)))}this.options.afterExecute&&this.options.afterExecute(s,m,a,n),a=s,n=m}}catch(r){if(R.Exception(r)){var d=i(r,3),b=d[1],y=d[2],w=i(R.Error(y)?y:[null,"exception",I(y)],3),S=w[1],j=w[2],N=L(b).map((function(r){var e=i(r,2)[1],t=e.depth,n=e.want,a=e.expr,o=e.info;return"".concat(t,": ").concat(null!=n?n:"initial",": ").concat(I(a,{maxdepth:20}).slice(0,100),": ").concat(JSON.stringify(o))})).join("\n")+"\n";throw this.options.debug&&Ln.log("UNHANDLED ERROR: ".concat(S,", ").concat(j,"\n").concat(N)),Object.assign(new Error,{name:S,message:null!=j?j:S,stack:N})}if(R.Object(r)||R.SpecialObject(r))throw{language:g,version:h,content:r};throw r}if(!n)throw new Error("AST didn't return value");return n}},{key:"execute",value:function(r,e){var a,u=function(r){var e=V(r),n=e.args;return["#CALL-STACK#",t(t({},e),{},{args:n?c(n):null}),k(r)]}(r),l=V(u),f=l.expr;try{if(e){if("return"===l.want)return[k(u),e];if("macro"===l.want)return[M(u,e),null]}if(null===l.want){if(e)throw D.Error("internal-error",'Call-frame was given a value without any want. "'.concat(l.want,'"'));if(R.Symbol(f)){var s,m=this.getStatic(null!==(s=f[2])&&void 0!==s?s:V(u).env.static,f);if(m)return[k(u),m];throw D.Error("unbound-variable","".concat(f[1]," is not defined."))}if(R.Null(f))throw D.Error("program-error","Evaluating an empty list is an error in Scheme.");if(!R.Pair(f))return[k(u),f];l.want="oper"}if(!R.Pair(f))throw D.Error("internal-error","Illegal status of call-frame. frane.want is not null, but expr is not a <pair>.");if("oper"===l.want)if(e){if(!R.Procedure(e))throw D.Error("not-a-procedure","Operator evaluation didn't return a valid procedure");l.oper=e,l.want="args",e=null}else{if(!R.Procedure(f[1])){if(R.Symbol(f[1])||R.Pair(f[1]))return[z(u,f[1]),null];throw D.Error("invalid-procedure","Operator is not a valid procedure.")}l.oper=f[1],l.want="args"}if(!l.oper)throw D.Error("internal-error","Illegal status of call-frame. frame.want is not null or oper, but oper is still null.");var p=this.getProcedureContent(l.oper);if(!p)throw D.Error("program-error","Operator is not a valid procedure.");var d,b=p.parameters.filter((function(r){return!r.type||"head"===r.type})),y=p.parameters.filter((function(r){return"optional"===r.type})),g=i(p.parameters.filter((function(r){return"variadic"===r.type})),1)[0],h=p.parameters.filter((function(r){return"tail"===r.type}));if("args"===l.want)if(e?(d=[e],e=null):d=i(X(f),1)[0].slice(1),1===d.length&&R.MultiValue(d[0])){var w=i(d,1),S=i(w[0],2)[1];if(S.length<b.length+h.length||!g&&S.length>b.length+h.length+y.length)throw D.Error("arity-error","Length of items in `multiple-value' object does not match the length of parameters.");l.args=S,l.want="return"}else{if(d.length<b.length+h.length||!g&&d.length>b.length+h.length+y.length)throw D.Error("arity-error","Length of arguments does not match the length of parameters.");var j=Math.max(0,d.length-b.length-h.length),N=Math.max(0,d.length-b.length-y.length-h.length),x=[].concat(c(b),c(y.slice(0,j)),c(Array.from({length:N},(function(){return g}))),c(h));l.args=d.map((function(r,e){var t;return(null===(t=x[e].evaluate)||void 0===t||t)&&R.Evaluatable(r)?null:r})),l.want=-1}if(!l.args)throw D.Error("internal-error","Invalid status of call-frame. frame.want is not null, oper or args, but frame.args is still null.");if("number"==typeof l.want){e&&(l.args[l.want]=e,e=null);for(var E=0,I=l.args[E];E<l.args.length;I=l.args[++E])if(null===I){var O=_(f).slice(1);return l.want=E,[z(u,O[E]),null]}l.want="return"}if(!R.Objects(l.args))throw D.Error("internal-error","Invalid status of call-frame. frame.args contains non-objects.");var P=l.args,B=Math.max(0,P.length-b.length-h.length),q=Math.max(0,P.length-b.length-y.length-h.length),U=[].concat(c(b),c(y.slice(0,B)),c(Array.from({length:q},(function(){return g}))),c(h));if("return"===l.want){if("function"==typeof p.body){for(var F,J=g?o({},g.name,[]):{},$=0;$<U.length;$++)"variadic"===U[$].type?J[U[$].name].push(P[$]):J[U[$].name]=P[$];var Z=this.options.acceptableJSValue,W=void 0===Z?function(){return!0}:Z;try{if(F=p.body(J,this,u),!R.Object(F)&&!R.CallStack(F)){if(!W(F))throw D.Error("not-acceptable-js-value",null);F=D.JS("inline",F)}}catch(r){throw R.Object(r)||R.SpecialObject(r)?R.Exception(r)||R.SpecialObject(r)?r:D.Exception(u,r,!1):D.Exception(u,D.JS("inline",r),!1)}return R.CallStack(F)?[F,null]:p.isMacro&&R.Evaluatable(F)?[M(u,F),null]:[k(u),F]}if(R.Continuation(p.body)){var G,H,Y=p.body,rr=L(u),er=L(Y[1]).reverse(),tr=new Set(er),nr=null!==(G=rr.find((function(r){return tr.has(r)})))&&void 0!==G?G:null,ar=rr.slice(0,rr.indexOf(nr)),or=er.slice(er.indexOf(nr)+1),ir=1===P.length?P[0]:D.MultiValue(P),ur=v(ar);try{for(ur.s();!(H=ur.n()).done;){var cr=H.value,lr=V(cr).after;if(lr){var fr=Q.Begin(Q.Call(lr),Q.Call(Y,D.MultiValue([ir])));return[M(cr,fr,{before:null,after:null}),null]}}}catch(r){ur.e(r)}finally{ur.f()}var sr,mr=v(or);try{for(mr.s();!(sr=mr.n()).done;){var pr=sr.value,vr=V(pr).before;if(vr){var dr=Q.Begin(Q.Call(vr),Q.Call(Y,D.MultiValue([ir])));return[z(pr,dr),null]}}}catch(r){mr.e(r)}finally{mr.f()}return[Y[1],ir]}if(R.Parameter(p.body)){var br=this.getDynamic(V(u).env.dynamic,p.body[1]);if(!br)throw D.Error("unbound-variable","Parameter is not defined.");return[k(u),br]}for(var yr=V(r).env.dynamic,gr=T(p.env.static),hr=[],wr=0;wr<U.length;wr++)"variadic"!==U[wr].type?this.defineStatic(gr,D.Symbol(U[wr].name),P[wr]):hr.push(P[wr]);return g&&this.defineStatic(gr,D.Symbol(g.name),K(hr)),p.isMacro?(V(u).want="macro",[z(u,p.body,{env:{static:gr,dynamic:yr}}),null]):[M(u,p.body,{env:{static:gr,dynamic:yr}}),null]}throw D.Error("internal-error","Illegal status (want) of call-frame: ".concat(l.want))}catch(r){if(r=R.Error(r)?D.Exception(u,r,!1):r,R.Exception(r)){var Sr=i(r,4),jr=Sr[1],Nr=Sr[2],xr=Sr[3];if(l.handler){var Er=A(l.handler);if(xr){var Ir=D.Continuation(k(jr)),Or=Q.Call(Ir,Q.Call(Er,D.MultiValue([Nr])));return[M(jr,Or,{handler:C(l.handler)}),null]}var Pr=Q.Raise(Q.Call(Er,D.MultiValue([Nr])));return[M(jr,Pr,{handler:C(l.handler)}),null]}throw r}if(R.JS(r)&&"built-in"===r[1]&&(a=r[2])&&("object"===n(a)||"function"==typeof a)&&"function"==typeof a.then){var Br=D.PromiseContinuation(D.Continuation(u),r[2],"pending");throw r[2].then((function(){return Br[3]="fulfilled"}),(function(){return Br[3]="rejected"})),Br}throw r}}}])&&a(e.prototype,u),l&&a(e,l),r}();r.Interpreter=Vn,r.arrayToList=K,r.assert=F,r.create=D,r.defineBuiltInProcedure=G,r.defineBuiltInProcedureAlias=H,r.forkCS=z,r.forms=Q,r.fromJS=lr,r.fromReferentialJSON=function(r,e){var t=JSON.parse(r),a=new Map;!function r(t){t instanceof Array&&t[0]===e&&t.length>=3?(a.set(t[1],t[2]),Object.keys(t[2]).forEach((function(e){return r(t[2][e])}))):"object"===n(t)&&null!==t&&Object.keys(t).forEach((function(e){return r(t[e])}))}(t);return function r(t){if(t instanceof Array&&t[0]===e&&a.has(t[1])){if(t.length>=3){var o=t[2];if(o instanceof Array)return o.splice.apply(o,[0,o.length].concat(c(o.map((function(e){return r(e)}))))),o;var i=Object.keys(o).reduce((function(e,t){return e[t]=r(o[t]),e}),{});return Object.assign(o,i)}return a.get(t[1])}return t instanceof Array?t.map((function(e){return r(e)})):"object"===n(t)&&null!==t?Object.keys(t).reduce((function(e,n){return e[n]=r(t[n]),e}),{}):t}(t)},r.is=R,r.isCurrentVersionEnvelope=function(r){return!!r&&"object"===n(r)&&r.language===g&&r.version===h&&(R.Object(r.content)||R.SpecialObject(r.content))},r.isEnvelope=er,r.isSuspendEnvelope=tr,r.listToArray=_,r.pairToArrayWithEnd=X,r.parser=fr,r.suspendValueFromEnvelope=function(r){return r.content[2]},r.toJS=function(r){return E(r,{extended:!0})},r.toReferentialJSON=function(r,e){var t=new Set,a=new Set;!function r(o){if(o instanceof Array&&o[0]===e){var i=new Error('ReferenceTag "'.concat(e,'" is already contained in the value.'));throw i.name="reference-tag",i}if("object"!==n(o)||null===o){if("number"!=typeof o||!Number.isNaN(o)&&Number.isFinite(o)){if(null===o||"boolean"==typeof o||"string"==typeof o||"number"==typeof o)return;throw new Error("Unserializable object: <".concat(n(o),">"))}throw new Error("JSON can't contain Infinite/-Infinite/NaN")}var u,c,l=null===(u=o.constructor)||void 0===u?void 0:u.name;if("Object"!==l&&"Array"!==l)throw new Error("Unserializable object: <".concat(n(o)," ").concat(null===(c=o.constructor)||void 0===c?void 0:c.name,">"));t.has(o)?a.has(o)||a.add(o):(t.add(o),Object.keys(o).forEach((function(e){return r(o[e])})))}(r),t.clear();var o=new Map,i=function r(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!i&&o.has(t)?[e,o.get(t)]:!i&&a.has(t)?(o.set(t,o.size+1),[e,o.get(t),r(t,!0)]):t instanceof Array?t.map((function(e){return r(e)})):"object"===n(t)&&null!==t?Object.keys(t).reduce((function(e,n){return e[n]=r(t[n]),e}),{}):t}(r);return a.clear(),o.clear(),JSON.stringify(i)},r.transferCS=M,r.unparser=O,r.wrapBuiltInProcedure=function(r){var e=r.name,t=r.parameters,n=r.body,a=r.isMacro,o=r.hidden,i=console;return{name:e,parameters:t,body:function(r,o,u){var c;i.log('-----[Built-in Procedure Call "'.concat(e,'"]-----\n')+"Is".concat(a?"":" NOT"," a macro procedure.\n")+"-----[Parameters]-----\n"+t.map((function(e,t){var n=r[e.name];return R.Object(n)?"".concat(t,":").concat(e.name,": ").concat(I(n,{maxdepth:20}),"\n"):n instanceof Array?"".concat(t,":").concat(e.name,":length ").concat(n.length,"}\n")+n.map((function(r,e){return" [".concat(e,"]: ").concat(I(r,{maxdepth:20}),"\n")})).join(""):"".concat(t,":").concat(e.name,": ").concat(n,"\n")})).join("")+" --------------------------------------------\nCalling now...\n");try{c=n(r,o,u)}catch(r){throw i.log("-----[Exception]-----\n"+"Exception is".concat(R.Object(r)?"":" NOT"," a LISP Object.\n")+(R.Object(r)?I(r,{maxdepth:20}):"".concat(r))+"\n-----------------------"),r}return i.log("-----[Return]-----\n"+"Return value is ".concat(R.Object(c)?"":"NOT"," a LISP Object.\n")+(R.Object(c)?I(c,{maxdepth:20}):"".concat(c))+"\n-----------------------"),c},isMacro:a,hidden:o}},r.writeObject=I,Object.defineProperty(r,"__esModule",{value:!0})}));
