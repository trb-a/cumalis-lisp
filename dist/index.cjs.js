"use strict";function r(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.push.apply(n,t)}return n}function e(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function n(r){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}function t(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function a(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function o(r,e){return c(r)||function(r,e){var n=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null==n)return;var t,a,o=[],i=!0,u=!1;try{for(n=n.call(r);!(i=(t=n.next()).done)&&(o.push(t.value),!e||o.length!==e);i=!0);}catch(r){u=!0,a=r}finally{try{i||null==n.return||n.return()}finally{if(u)throw a}}return o}(r,e)||f(r,e)||m()}function i(r){return c(r)||l(r)||f(r)||m()}function u(r){return function(r){if(Array.isArray(r))return s(r)}(r)||l(r)||f(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(r){if(Array.isArray(r))return r}function l(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function f(r,e){if(r){if("string"==typeof r)return s(r,e);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(r,e):void 0}}function s(r,e){(null==e||e>r.length)&&(e=r.length);for(var n=0,t=new Array(e);n<e;n++)t[n]=r[n];return t}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(r,e){var n="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!n){if(Array.isArray(r)||(n=f(r))||e&&r&&"number"==typeof r.length){n&&(r=n);var t=0,a=function(){};return{s:a,n:function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=n.call(r)},n:function(){var r=n.next();return i=r.done,r},e:function(r){u=!0,o=r},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}Object.defineProperty(exports,"__esModule",{value:!0});var v,d,b,y="cumalis-lisp",g={quote:"'",quasiquote:"`",unquote:",","unquote-splicing":",@"},h=/^(?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+$/,w={"":"\\a","\b":"\\b","\t":"\\t","\n":"\\n","\r":"\\r",'"':'\\"',"\\":"\\\\","|":"\\|"},j=function(r){var e,n="",t="",a=p(r);try{for(a.s();!(e=a.n()).done;){var o=e.value,i=o.length>2&&0===o.indexOf('""')?o.replace(/^""/,"").replace(/""$/,""):o;n=n+(""===n||"("===t.slice(0,1)||")"===o.slice(-1)||Object.values(g).indexOf(t)>=0?"":" ")+i,t=o}}catch(r){a.e(r)}finally{a.f()}return n},S=function(r){return function r(e){var n,t=[],a=p(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;if("string"==typeof o)t.push(o);else if(o instanceof Array)if("string"==typeof o[0]&&Object.values(g).includes(o[0]))t.push.apply(t,u(r(o)));else if("#"===o[0]||"#u8"===o[0]){if(2!==o.length||!(o[1]instanceof Array))throw new Error("Illegal token tree: #/#u8 must have only one token array");t.push("".concat(o[0],"(")),t.push.apply(t,u(r(o[1]))),t.push(")")}else if("string"==typeof o[0]&&/^#\d+=/.exec(o[0])){if(2!==o.length)throw new Error("Illegal token tree: datum label must have the content");t.push.apply(t,[o[0]].concat(u(r(o.splice(1)))))}else t.push("("),t.push.apply(t,u(r(o))),t.push(")")}}catch(r){a.e(r)}finally{a.f()}return t}(r)},x=function(r,e){var t=null!=e?e:{},a=t.extended,i=void 0!==a&&a,c=t.style,l=void 0===c?"write":c,f=t.labels,s=void 0===f?"cyclic":f,m=t.maxdepth,p=void 0===m?1/0:m,v=new Set,d=new Set;!function r(e,n,t){q.Object(e),!i&&n>p||(i||!("cyclic"===s&&t.has(e)||"shared"===s&&v.has(e))?(v.add(e),t.add(e),D.Pair(e)?(r(e[1],n+1,t),r(e[2],n+1,t)):D.Vector(e)&&e[1].forEach((function(e){return r(e,n+1,t)}))):d.add(e))}(r,0,new Set);var b=new Map;return function r(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(q.Object(e),!i&&t>p)return"...";if(!a&&!i&&d.has(e)){if(b.has(e))return"#".concat(b.get(e),"#");var c=b.size+1;b.set(e,c);var f=r(e,t,!0);return["#".concat(c,"="),f]}switch(e[0]){case"<symbol>":return i||h.test(e[1])?e[1]:"|"+e[1].replace(/[\x00-\x1f\x7f"|\\]/g,(function(r){var e,n;return null!==(e=w[r])&&void 0!==e?e:"\\x".concat(null===(n=r.codePointAt(0))||void 0===n?void 0:n.toString(16))}))+"|";case"<null>":return i?null:[];case"<string>":return i?e[1]:"display"!==l?'"'+e[1].replace(/[\x00-\x1f\x7f]"|\\/g,(function(r){var e,n;return null!==(e=w[r])&&void 0!==e?e:"\\x".concat(null===(n=r.codePointAt(0))||void 0===n?void 0:n.toString(16))}))+'"':'""'+e[1]+'""';case"<number>":return i?P(e):"".concat(e[1]);case"<boolean>":return i?e[1]:e[1]?"#t":"#f";case"<character>":if(i)return e[1];if("display"!==l){var s,m=null!==(s=Object.entries(tr).find((function(r){return o(r,2)[1]===e[1]})))&&void 0!==s?s:[],v=o(m,1),y=v[0];return"#\\".concat(null!=y?y:e[1])}return'""'+e[1]+'""';case"<vector>":return["#",u(e[1].map((function(e){return r(e,t+1)})))];case"<bytevector>":return["#u8",u(e[1].map((function(r){return"".concat(r)})))];case"<pair>":var j=o(e,3),S=j[1],x=j[2];return"<null>"===x[0]?[r(S,t+1)]:"<pair>"!==x[0]?[r(S,t+1),".",r(x,t+1)]:"<symbol>"===S[0]&&g[S[1]]?[g[S[1]]].concat(u(r(x,t+1))):[r(S,t+1)].concat(u(r(x,t+1)));case"<js>":return i?["&",e[1]]:"#<$js[".concat(null===e[1]?"null":n(e[1]),"]>");case"<procedure>":return i?e:"built-in"===e[1]?"#<procedure[built-in/".concat(e[2],"]>"):"#<procedure[".concat(e[1],"]>");default:return i?e:"#".concat(e[0])}}(r,0)},N=function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var t=x(r,e(e({maxdepth:8},n),{},{extended:!1})),a=S([t]);return j(a)}catch(r){return"<!!WRITE-ERROR!!>"}},E=function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=x(r,e(e({},n),{},{extended:!1}));if(!(t instanceof Array&&"begin"===t[0]))throw new Error('fromASTToText error: The top of AST is must be a "begin" expression.');var a=S(t.slice(1));return j(a)},P=function(r){return"number"==typeof r[1]?r[1]:"+inf.0"===r[1]?1/0:"-inf.0"===r[1]?-1/0:NaN},I=function(r){return M.Number(Number.isFinite(r)?Number.isNaN(r)?"+nan.0":r:r<0?"-inf.0":"+inf.0")},O=function(r){return r[2]},B=function(r){return r[1]},C=function(r){return r[2]},A=function(r){for(var e=[],n=r;n;n=C(n))e.push(n);return e},k=function(r){return r[1]},z=function(r,e){var n,t,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=k(r),u=i.env,c=i.handler,l=i.depth,f=i.info;return["#CALL-STACK#",{depth:l+1,env:null!==(n=o.env)&&void 0!==n?n:u,expr:e,want:null,oper:null,args:null,before:null!==(t=o.before)&&void 0!==t?t:null,after:null!==(a=o.after)&&void 0!==a?a:null,handler:c,info:D.Pair(e)&&e[4]||f},r]},L=function(r,e){var n,t,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=k(r),u=i.env,c=i.handler,l=i.depth,f=i.info,s=i.before,m=i.after;return["#CALL-STACK#",{depth:l,env:null!==(n=o.env)&&void 0!==n?n:u,expr:e,want:null!==(t=o.want)&&void 0!==t?t:null,oper:null!==(a=o.oper)&&void 0!==a?a:null,args:null,before:void 0===o.before?s:o.before,after:void 0===o.after?m:o.after,handler:void 0!==o.handler?o.handler:c,info:D.Pair(e)&&e[4]||f},C(r)]},V=function(r){return[r[0],{},r]},M={Symbol:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<symbol>"].concat(e)},String:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<string>"].concat(e)},Number:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<number>"].concat(e)},Boolean:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<boolean>"].concat(e)},Character:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<character>"].concat(e)},Pair:function(r,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;return t?["<pair>",r,e,n,t]:["<pair>",r,e,n]},Null:function(){return["<null>"]},Vector:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<vector>"].concat(e)},ByteVector:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<bytevector>"].concat(e)},EndOfFile:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<end-of-file>"].concat(e)},Procedure:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<procedure>"].concat(e)},Port:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<port>"].concat(e)},RecordType:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<record-type>"].concat(e)},Record:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<record>"].concat(e)},SyntaxRules:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<syntax-rules>"].concat(e)},Parameter:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<parameter>"].concat(e)},MultiValue:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<multi-value>"].concat(e)},Exception:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<exception>"].concat(e)},Undefined:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<undefined>"].concat(e)},Promise:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<promise>"].concat(e)},Error:function(r,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return["<error>",r,e,n]},Continuation:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<continuation>"].concat(e)},JS:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["<js>"].concat(e)},List:function(r){function e(){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return e.reverse().reduce((function(r,e){return["<pair>",e,r,!1]}),["<null>"])})),Suspend:function(r){function e(){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["#SUSPEND#"].concat(e)})),JSPromiseContinuation:function(r){function e(){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["#JS-PROMISE-CONTINUATION#"].concat(e)})),StaticNS:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["#STATIC-NS-STACK#"].concat(e)},DynamicNS:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["#DYNAMIC-NS-STACK#"].concat(e)},HandlerStack:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return["#HANDLER-STACK#"].concat(e)}},T={Call:function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),t=1;t<e;t++)n[t-1]=arguments[t];return M.List.apply(M,[r].concat(n))},CallBuiltIn:function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),t=1;t<e;t++)n[t-1]=arguments[t];return M.List.apply(M,[M.Procedure("built-in",r)].concat(n))},Lambda:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return D.List(e[0])?T.CallBuiltIn.apply(T,["lambda"].concat(u(e))):T.CallBuiltIn.apply(T,["lambda",_(e[0],e[1])].concat(u(e.slice(2))))},CallThunk:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return T.Call(T.CallBuiltIn.apply(T,["lambda",["<null>"]].concat(e)))},Begin:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return T.CallBuiltIn.apply(T,["begin"].concat(e))},Quote:function(r){return T.CallBuiltIn("quote",r)},Set:function(r,e){return T.CallBuiltIn("set!",r,e)},Raise:function(r){return T.CallBuiltIn("raise",r)},RaiseContinuable:function(r){return T.CallBuiltIn("raise-continuable",r)},Let:function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),t=1;t<e;t++)n[t-1]=arguments[t];return T.CallBuiltIn.apply(T,["let",M.List.apply(M,u(r.map((function(r){return M.List.apply(M,u(r))}))))].concat(n))},If:function(r,e,n){return n?T.CallBuiltIn("if",r,e,n):T.CallBuiltIn("if",r,e)},And:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return T.CallBuiltIn.apply(T,["and"].concat(e))},Or:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return T.CallBuiltIn.apply(T,["or"].concat(e))},Cond:function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),t=1;t<e;t++)n[t-1]=arguments[t];return T.CallBuiltIn.apply(T,["cond",r].concat(n))},Case:function(r,e){return T.CallBuiltIn("case",r,M.List.apply(M,u(e.map((function(r){return M.List.apply(M,u(r))})))))},Define:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return T.CallBuiltIn.apply(T,["define"].concat(e))},DefineValues:function(r,e){return T.CallBuiltIn("define-values",D.List(r)?r:M.List.apply(M,u(r)),e)},Append:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return T.CallBuiltIn.apply(T,["append"].concat(e))},Cons:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return T.CallBuiltIn.apply(T,["cons"].concat(e))},Values:function(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return T.CallBuiltIn.apply(T,["values"].concat(e))},BeginIfMultiple:function(){return 0===arguments.length?["<undefined>"]:1===arguments.length?arguments.length<=0?void 0:arguments[0]:T.Begin.apply(T,arguments)}},D={Symbol:function(r){return r instanceof Array&&"<symbol>"===r[0]},String:function(r){return r instanceof Array&&"<string>"===r[0]},Number:function(r){return r instanceof Array&&"<number>"===r[0]},Boolean:function(r){return r instanceof Array&&"<boolean>"===r[0]},Character:function(r){return r instanceof Array&&"<character>"===r[0]},Pair:function(r){return r instanceof Array&&"<pair>"===r[0]},Null:function(r){return r instanceof Array&&"<null>"===r[0]},Vector:function(r){return r instanceof Array&&"<vector>"===r[0]},ByteVector:function(r){return r instanceof Array&&"<bytevector>"===r[0]},EndOfFile:function(r){return r instanceof Array&&"<end-of-file>"===r[0]},Port:function(r){return r instanceof Array&&"<port>"===r[0]},RecordType:function(r){return r instanceof Array&&"<record-type>"===r[0]},Record:function(r){return r instanceof Array&&"<record>"===r[0]},MultiValue:function(r){return r instanceof Array&&"<multi-value>"===r[0]},SyntaxRules:function(r){return r instanceof Array&&"<syntax-rules>"===r[0]},Parameter:function(r){return r instanceof Array&&"<parameter>"===r[0]},Exception:function(r){return r instanceof Array&&"<exception>"===r[0]},Undefined:function(r){return r instanceof Array&&"<undefined>"===r[0]},Promise:function(r){return r instanceof Array&&"<promise>"===r[0]},Error:function(r){return r instanceof Array&&"<error>"===r[0]},Continuation:function(r){return r instanceof Array&&"<continuation>"===r[0]},JS:function(r){return r instanceof Array&&"<js>"===r[0]},List:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return D.Pair(r)||D.Null(r)})),Procedure:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&("<procedure>"===r[0]||"<continuation>"===r[0]||"<parameter>"===r[0])})),Object:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"string"==typeof r[0]&&/^<.*>/.test(r[0])})),Evaluatable:function(r){return D.List(r)||D.Symbol(r)},False:function(r){return D.Boolean(r)&&!1===r[1]},RealNumber:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return D.Number(r)&&"number"==typeof r[1]})),IntegerNumber:function(r){return D.Number(r)&&"number"==typeof r[1]&&Number.isInteger(r[1])},Objects:function(r){return r instanceof Array&&r.every((function(r){return D.Object(r)}))},Suspend:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"#SUSPEND#"===r[0]})),JSPromiseContinuation:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"#JS-PROMISE-CONTINUATION#"===r[0]})),CallStack:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"#CALL-STACK#"===r[0]})),SpecialObject:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return r instanceof Array&&"string"==typeof r[0]&&/^#.+#$/.test(r[0])})),Dictionary:function(r){function e(e){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}((function(r){return"object"===n(r)&&!!r&&r.constructor===Object})),Stack:function(r){return r instanceof Array&&3===r.length&&"string"==typeof r[0]&&/^#.*-STACK#$/.test(r[0])}},Q=function(r,e){return function(n,t){if(!r(n))throw M.Error("domain-error",null!=t?t:e)}},R=function(r,e){return function(n,t){if(!(n instanceof Array))throw M.Error("domain-error",null!=t?t:e);var a,o=p(n);try{for(o.s();!(a=o.n()).done;){var i=a.value;if(!r(i))throw M.Error("domain-error",null!=t?t:e)}}catch(r){o.e(r)}finally{o.f()}}},q={List:Q(D.List,"A <pair> or <null> is expected."),Pair:Q(D.Pair,"A <pair> is expected."),Symbol:Q(D.Symbol,"A <symbol> is expected."),Number:Q(D.Number,"A <number> is expected."),Boolean:Q(D.Boolean,"A <boolean> is expected."),Object:Q(D.Object,"A Scheme object is expected."),String:Q(D.String,"A <string> is expected."),Vector:Q(D.Vector,"A <vector> is expected."),ByteVector:Q(D.ByteVector,"A <bytevector> is expected."),Character:Q(D.Character,"A <character> is expected."),Promise:Q(D.Promise,"A <promise> is expected."),Error:Q(D.Error,"A <error> is expected."),Procedure:Q(D.Procedure,"A <procedure> is expected."),SyntaxRules:Q(D.SyntaxRules,"A <syntax-rules> is expected."),Parameter:Q(D.Parameter,"A <parameter> is expected."),RecordType:Q(D.RecordType,"A <record-type> is expected."),Record:Q(D.Record,"A <record> is expected."),MultiValue:Q(D.MultiValue,"A <multi-value> is expected."),Port:Q(D.Port,"A <port> is expected."),Lists:R(D.List,"An array of <pair>/<null> is expected."),Pairs:R(D.Pair,"An array of <pair> is expected."),Symbols:R(D.Symbol,"An array of <symbol> is expected."),Numbers:R(D.Number,"An array of <number> is expected."),Booleans:R(D.Boolean,"An array of <boolean> is expected."),Objects:R(D.Object,"An array of Scheme object is expected."),Strings:R(D.String,"An array of <string> is expected."),Vectors:R(D.Vector,"An array of <vector> is expected."),ByteVectors:R(D.ByteVector,"An array of  <bytevector> is expected."),Characters:R(D.Character,"An array of <character> is expected."),RealNumber:Q(D.RealNumber,"A real <number> (not infinite, not NaN) is expected."),IntegerNumber:Q(D.IntegerNumber,"A integer <number> is expected."),RealNumbers:R(D.RealNumber,"An array of real <number> is expected."),IntegerNumbers:R(D.IntegerNumber,"An array of integer <number> is expected.")},U=function(r){if(null==r)throw M.Error("program-error","Required object.")},J=function(r){return"object"===n(r)&&null!==r&&"Object"===r.constructor.name},F=Object.prototype.hasOwnProperty,$=function(r){var e=new Set;return function r(n){if(D.Pair(n)){var t=o(n,3),a=t[1],i=t[2];if(e.has(i))throw new Error("Circular list detected.");return e.add(i),[a].concat(u(r(D.List(i)?i:["<null>"])))}return[]}(r)},Z=function r(e){var n=new Set;return function(e){var t=o(e,3),a=t[1],i=t[2];if(D.Pair(i)){if(n.has(i))throw new Error("Circular list detected.");n.add(i);var c=o(r(i),2),l=c[0],f=c[1];return[[a].concat(u(l)),f]}return[[a],i]}(e)},_=function(r,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;return r.reverse().reduce((function(e,a,o){return t&&o===r.length-1?M.Pair(a,e,n,t):M.Pair(a,e,n)}),e||["<null>"])},X=(v=0,d=0,b=0,function(){return"::"+"T-S-XXXXXXX".replace(/[TSX]/g,(function(r){return d=Date.now(),"T"===r?"0000000000000".concat(d.toString(16)).slice(-14):"S"===r?"000".concat((v===d?(v=d,b=0):b++).toString(16)).slice(-4):"000".concat((Math.random()*Math.pow(16,4)|0).toString(16)).slice(-4)}))}),K=function(r,e,n){var t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e.filter((function(r){return"variadic"===r.type})).length>1)throw new Error("Only one variadic parameter is allowed.");return{name:r,parameters:e,body:n,isMacro:t,hidden:a}},W=function(r,n){return e(e({},n),{},{name:r})},G=function(r,e){return r.length===e.length&&r.every((function(r,n){return r===e[n]}))},H=function(r){if(D.List(r)){if(D.Null(r))return[[],null];var e,n=o(Z(r),2),t=n[0],a=n[1];return q.Symbols(t),D.Null(a)||q.Symbol(a),[t.map((function(r){var e;return{name:null!==(e=r[3])&&void 0!==e?e:r[1]}})),D.Null(a)?null:{name:null!==(e=a[3])&&void 0!==e?e:a[1],type:"variadic"}]}var i;return q.Symbol(r),[[],{name:null!==(i=r[3])&&void 0!==i?i:r[1],type:"variadic"}]},Y=function(r){return!!r&&"object"===n(r)&&r.language===y&&!!r.version&&(D.Object(r.content)||D.SpecialObject(r.content))},rr=function(r){return Y(r)&&D.Suspend(r.content)},er=new RegExp("(?:"+[/\s+/.source,/;[^\n]*(?:\n|$)/.source,/(?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+/.source,/\|(?:[^|\\]|\n|\\(?:.|\n))+\|/.source,/#!(?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+/.source,/"(?:[^"\\]|\n|\\(?:.|\n))*"/.source,/(?:[()[\]{}'`]|,(?!@)|,@)/.source,/#(?:t(?:rue)?|f(?:alse)?|\(|u8\(|\d+[#=]|;)/.source,/#[dDbBoOxXeEiI](?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+/.source,/#\\(?:(?:[^A-Za-z]|\n)|[A-Za-z](?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])*)/.source,Array(16).fill(/#\|(?:[^|#]|\|[^#]|#[^|]|\n|(?:NEST))*\|#/.source).reduce((function(r,e){return r.replace("NEST",e)}))].join("|")+")","y"),nr={a:"",b:"\b",t:"\t",n:"\n",r:"\r"},tr={alarm:"",backspace:"\b",delete:"",escape:"",newline:"\n",null:"\0",return:"\r",space:" ",tab:"\t"},ar=function(r,e){var n=function(r){for(var e,n=[0],t=/\n/g;e=t.exec(r);)n.push(e.index+1);return function(e){var t,a=n.filter((function(r){return r<=e})).slice(-1)[0],o=r.slice(a,e);return[n.indexOf(a)+1,o.length+(null!==(t=o.match(/[^\x01-\x7E\xA1-\xDF]/g))&&void 0!==t?t:[]).length+1]}}(r),t=[];er.lastIndex=0;for(var a=!1;er.lastIndex<r.length;){var i,u=er.lastIndex,c=o(n(u),2),l=c[0],f=c[1],s=e?{filename:e,line:l,column:f}:{line:l,column:f},m=o(null!==(i=er.exec(r))&&void 0!==i?i:[],1)[0];if(null==m){var p=r.slice(u).split(/(\s|\n)+/,2)[0]||r[u],v=p.length>10?p.slice(0,10)+"...":p;throw new Error('Tokenize failed. Unexpected token is: "'.concat(v,'": ').concat(JSON.stringify(s)))}"#!fold-case"!==m&&"#!no-fold-case"!==m?(a&&(m.match(/^(?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+$/)||m.match(/#\\(?:(?:[^A-Za-z]|\n)|[A-Za-z](?:[A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])*)/))&&(m=m.toLowerCase()),t.push([m,s])):a=!m.includes("#!no-")}return t},or=function(r){var e=r.filter((function(r){return!r[0].match(/^(\s|;|#\||#!(no-)?fold-case)/)}));return[function r(){for(var n=[],t=e.shift();t;t=e.shift()){var a=o(t,2),i=a[0],c=a[1];if(!i.match(/^(\s|;|#\|)/))if("("===i)n.push(r().concat(c));else if(["#(","#u8("].includes(i))n.push([i.slice(0,-1),r(),c]);else{if(["'","`",",",",@","#;"].includes(i)||i.match(/^#\d+=$/)){var l=r(),f=l.shift();if(null==f)throw'Unexpected end of source after quoting/datum label "'.concat(i,'": ').concat(JSON.stringify(c));return"#;"!==i&&n.push([i,f]),n.push.apply(n,u(l)),n}if(")"===i)return n;n.push(i)}}return n}(),e]},ir=function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map;if("string"==typeof e){var c;if(c=/^([+-])(nan|inf)\.0$/i.exec(e))return M.Number(c[0].toLowerCase());if(c=/^(?:#d)?[-+]?\d+(?:\.\d*)?(?:e[-+]?\d+)?$/i.exec(e))return I(Number(e.replace(/^(#d)?0*/i,"")));if(c=/^(?:#b[-+]?[01]+|#o[-+]?[0-7]+|#x[-+]?[0-9A-Fa-f]+)/i.exec(e))return I(Number(e.replace(/^#([xob])([+-]?)/i,"0$1"))*(e.includes("-")?-1:1));if(/^#[dboxei]/i.exec(e))throw new Error("Unsupported type of number literal: ".concat(e,": ").concat(JSON.stringify(t)));if(c=/^"((?:.|\n)*)"$/.exec(e)){var l=c[1].replace(/\\(x[0-9a-fA-F]+;|[ \t]*\n[ \t]*|[^x \t\n])/g,(function(r){return"x"===r[1]?String.fromCodePoint(Number("0x".concat(r.replace(/;$/,"").slice(2)))):/\s|\n/.test(r[1])?"":null!==(e=nr[r[1]])&&void 0!==e?e:r[1];var e}));return M.String(l,!0)}if(c=/^#([tf])/.exec(e))return M.Boolean("t"===c[1]);if(c=/^#\\((.|\n)*)$/.exec(e)){var f=1===c[1].length?c[1]:c[1].match(/^x[0-9A-Fa-f]+$/)?String.fromCodePoint(Number("0x".concat(c[1].slice(1)))):tr[c[1]];if(!f)throw new Error("Illegal character literal: ".concat(f,": ").concat(JSON.stringify(t)));return M.Character(f)}if("."!==e&&(c=/^(([A-Za-z0-9]|[^\x00-\x7f]|[!$%&*+\-./:<=>?@^_~])+)$/.exec(e)))return M.Symbol(c[1]);if("."!==e&&(c=/^\|(([^\\]|\n|\\(.|\n))+)\|$/.exec(e))){var s=c[1].replace(/\\(x[0-9a-fA-F]+;|\s*\n\s*|[^x\s\n])/g,(function(r){return"x"===r[1]?String.fromCodePoint(Number("0x".concat(r.replace(/;$/,"").slice(2)))):/\s|\n/.test(r[1])?"":null!==(e=nr[r[1]])&&void 0!==e?e:r[1];var e}));return M.Symbol(s)}if(c=/^#(\d+)#$/.exec(e)){var m=c[1];if(!i.has(m))throw new Error("Invalid datum reference (".concat(e,"): ").concat(JSON.stringify(t)));return i.get(m)}throw new Error('Parse error: unexpected token: "'.concat(e,'": ').concat(JSON.stringify(t)))}if(e instanceof Array&&"&"!==e[0]){var p;t=null!==(p=e.find((function(r){return J(r)})))&&void 0!==p?p:t;var v=e.filter((function(r){return!J(r)}));if(0===v.length)return M.Null();if(2===v.length&&"."===v[0])return r(v[1],t,a,i);if("#"===v[0]){if(2!==v.length)throw new Error("Illegal vector literal. No datum: ".concat(JSON.stringify(t)));if(!(v[1]instanceof Array))throw new Error("Illegal vector literal. Datum is not an array: ".concat(JSON.stringify(t)));return M.Vector(v[1].map((function(e){return r(e,t,a,i)})),!0)}if("#u8"===v[0]){if(2!==v.length)throw new Error("Illegal byte vector literal. No datum: ".concat(JSON.stringify(t)));if(!(v[1]instanceof Array))throw new Error("Illegal byte vector literal. Byte vector must have an array: ".concat(JSON.stringify(t)));var d=v[1].map((function(e){return r(e,t,a,i)}));if(!d.every((function(r){return D.RealNumber(r)&&Number.isInteger(r[1])&&r[1]>=0&&r[1]<=255})))throw new Error("Illegal byte vector literal. All the contents of a byte vector must be 0-255.: ".concat(JSON.stringify(t)));return M.ByteVector(d.map(P),!0)}if("string"==typeof v[0]&&["'","`",",",",@"].includes(v[0])){if(2!==v.length)throw new Error('Illegal quote "'.concat(v[0],'". Quoted item must be a datum: ').concat(JSON.stringify(t)));var b={"'":"quote","`":"quasiquote",",":"unquote",",@":"unquote-splicing"}[v[0]];return M.Pair(M.Symbol(b),M.Pair(r(v[1],t,a,i),M.Null(),!0),!0,null!=a&&a.removeLineInfo?null:t)}if("string"==typeof v[0]&&/^#(\d+)=$/.exec(v[0])){var y,g=/^#(\d+)=$/.exec(v[0]),h=o(g,2),w=h[1];if(2!==v.length)throw new Error("Illegal datum label. No next datum: ".concat(JSON.stringify(t)));var j=M.Symbol(v[0]);i.set(w,j);var S=r(v[1],t,a,i);return(y=j).splice.apply(y,[0,j.length].concat(u(S))),j}if(null!=a&&a.extended&&D.Object(e))return e;if(null!=a&&a.extended&&"&"===e[0]){if(2!=e.length)throw new Error('Parse error: JS Node must be like ["&", <object>]: '.concat(n(e)," value: ").concat(e));return M.JS("inline",e[1])}return M.Pair(r(v[0],t,a,i),r(v.slice(1),t,a,i),!0,null!=a&&a.removeLineInfo?null:t)}if(null!=a&&a.extended&&null===e)return M.Null();if(null!=a&&a.extended&&"number"==typeof e)return I(e);if(null!=a&&a.extended&&"boolean"==typeof e)return M.Boolean(e);throw new Error("Parse error: unexpected node type: ".concat(n(e)," value: ").concat(e))},ur=function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0;return ir(r,n,e(e({},null!=t?t:{}),{},{extended:!0}))},cr=function(r,e){var n=ar(r),t=o(or(n),2),a=t[0],i=t[1];if(i.length>0)throw new Error("Parse error: extra tokens. (missing right curly?), ".concat(JSON.stringify(i[0][1])));return ir(["begin"].concat(u(a)),null,e)},lr=K("not",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.False(e))})),fr=K("boolean?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Boolean(e))})),sr=K("boolean=?",[{name:"boolean1"},{name:"boolean2"},{name:"booleans",type:"variadic"}],(function(r){var e=r.boolean1,n=r.boolean2,t=r.booleans;return q.Boolean(e),q.Boolean(n),q.Booleans(t),M.Boolean([n].concat(u(t)).every((function(r){return r[1]===e[1]})))})),mr={not:lr,booleanQ:fr,booleanEQ:sr},pr=K("bytevector?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.ByteVector(e))})),vr=K("make-bytevector",[{name:"k"},{name:"byte",type:"optional"}],(function(r){var e=r.k,n=r.byte;return q.IntegerNumber(e),n&&q.IntegerNumber(n),M.ByteVector(Array(e[1]).fill(n?n[1]:0),!1)})),dr=K("bytevector",[{name:"bytes",type:"variadic"}],(function(r){var e=r.bytes;return q.IntegerNumbers(e),M.ByteVector(e.map((function(r){return r[1]})),!1)})),br=K("bytevector-length",[{name:"bvec"}],(function(r){var e=r.bvec;return q.ByteVector(e),M.Number(e[1].length)})),yr=K("bytevector-u8-ref",[{name:"bvec"},{name:"k"}],(function(r){var e=r.bvec,n=r.k;if(q.ByteVector(e),q.IntegerNumber(n),!(n[1]in e[1]))throw M.Error("out-of-range","Index is out of range.");return M.Number(e[1][n[1]])})),gr=K("bytevector-u8-set!",[{name:"bvec"},{name:"k"},{name:"byte"}],(function(r){var e=r.bvec,n=r.k,t=r.byte;if(q.ByteVector(e),q.IntegerNumber(n),q.IntegerNumber(t),!(n[1]in e[1]))throw M.Error("out-of-range","Index is out of range.");return e[1][n[1]]=t[1],["<undefined>"]})),hr=K("bytevector-copy",[{name:"bvec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.bvec,n=r.start,t=r.end;q.ByteVector(e);var a=e[1];if(0===a.length)return M.ByteVector([],!1);var o=D.Number(n)?n[1]:0,i=D.Number(t)?t[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw M.Error("domain-error","Index must be integer.");return M.ByteVector(a.slice(o,i),!1)})),wr=K("bytevector-copy!",[{name:"to"},{name:"at"},{name:"from"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e,n=r.to,t=r.at,a=r.from,o=r.start,i=r.end;q.ByteVector(n),q.IntegerNumber(t),q.ByteVector(a);var c=D.Number(o)?o[1]:0,l=D.Number(i)?i[1]:a[1].length;if("number"!=typeof c||!Number.isInteger(c)||"number"!=typeof l||!Number.isInteger(l))throw M.Error("domain-error","Index must be integer.");if(!(t[1]in n[1]))throw M.Error("out-of-range","Index is out of range.");if(n[1].length-t[1]<l-c)throw M.Error("out-of-range","Index is out of range.");var f=a[1].slice(c,l);return(e=n[1]).splice.apply(e,[t[1],f.length].concat(u(f))),["<undefined>"]})),jr=K("bytevector-append",[{name:"vecs",type:"variadic"}],(function(r){var e=r.vecs;return q.ByteVectors(e),M.ByteVector(e.map((function(r){return r[1]})).flat(),!1)})),Sr=K("utf8->string",[{name:"bvec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.bvec,n=r.start,t=r.end;q.ByteVector(e);var a=e[1],o=D.Number(n)?n[1]:0,i=D.Number(t)?t[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw M.Error("domain-error","Index must be integer.");var u=new Uint8Array(a.slice(o,i));return M.String((new TextDecoder).decode(u),!1)})),xr=K("string->utf8",[{name:"str"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,n=r.start,t=r.end;q.String(e);var a=e[1],o=D.Number(n)?n[1]:0,i=D.Number(t)?t[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw M.Error("domain-error","Index must be integer.");var u=(new TextEncoder).encode(a.slice(o,i));return M.ByteVector(Array.from(u),!1)})),Nr={bytevectorQ:pr,makeBytevector:vr,bytevector:dr,bytevectorLength:br,bytevectorU8Ref:yr,bytevectorU8SetD:gr,bytevectorCopy:hr,bytevectorCopyD:wr,bytevectorAppend:jr,utf8ToString:Sr,stringToUtf8:xr},Er=K("char?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Character(e))})),Pr=K("char=?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,n=r.char2,t=r.chars;return q.Character(e),q.Character(n),q.Characters(t),M.Boolean([n].concat(u(t)).every((function(r){return r[1]===e[1]})))})),Ir=K("char<?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,n=r.char2,t=r.chars;q.Character(e),q.Character(n),q.Characters(t);var a=[e,n].concat(u(t)).map((function(r){return r[1]}));return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]<r})))})),Or=K("char>?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,n=r.char2,t=r.chars;q.Character(e),q.Character(n),q.Characters(t);var a=[e,n].concat(u(t)).map((function(r){return r[1]}));return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]>r})))})),Br=K("char<=?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,n=r.char2,t=r.chars;q.Character(e),q.Character(n),q.Characters(t);var a=[e,n].concat(u(t)).map((function(r){return r[1]}));return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]<=r})))})),Cr=K("char>=?",[{name:"char1"},{name:"char2"},{name:"chars",type:"variadic"}],(function(r){var e=r.char1,n=r.char2,t=r.chars;q.Character(e),q.Character(n),q.Characters(t);var a=[e,n].concat(u(t)).map((function(r){return r[1]}));return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]>=r})))})),Ar=K("char->integer",[{name:"char"}],(function(r){var e=r.char;q.Character(e);var n=e[1].codePointAt(0);if(void 0===n)throw M.Error("out-of-range","Can't convert character to codepoint.");return M.Number(n)})),kr=K("integer->char",[{name:"n"}],(function(r){var e=r.n;return q.IntegerNumber(e),M.Character(String.fromCodePoint(e[1]))})),zr={charQ:Er,charEQ:Pr,charLtQ:Ir,charGtQ:Or,charLeQ:Br,charGeQ:Cr,charToInteger:Ar,integerToChar:kr},Lr=K("procedure?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Procedure(e))}),!0),Vr=K("apply",[{name:"proc"},{name:"args",type:"variadic"}],(function(r,e,n){var t,a=r.proc,o=r.args;if(q.Procedure(a),q.Objects(o),U(e),U(n),0===o.length)t=[];else{var i=[o.slice(0,o.length-1),o[o.length-1]],c=i[0],l=i[1];q.List(l),t=[].concat(u(c),u($(l)))}return T.Call(a,M.MultiValue(t))}),!0),Mr=K("map",[{name:"proc"},{name:"list1"},{name:"lists",type:"variadic"}],(function(r){var e=r.proc,n=r.list1,t=r.lists;q.Procedure(e),q.List(n),q.Lists(t);var a=[n].concat(u(t));return a.every((function(r){return D.Pair(r)}))?T.Cons(T.Call(e,M.MultiValue(a.map((function(r){return r[1]})))),T.CallBuiltIn("map",M.MultiValue([e].concat(u(a.map((function(r){return r[2]}))))))):T.Quote(["<null>"])}),!0),Tr=K("string-map",[{name:"proc"},{name:"str1"},{name:"strs",type:"variadic"}],(function(r){var e=r.proc,n=r.str1,t=r.strs;q.Procedure(e),q.String(n),q.Strings(t);var a=[n].concat(u(t));return a.every((function(r){return r[1].length>1}))?T.CallBuiltIn("string-append",T.CallBuiltIn("string",T.Call.apply(T,[e].concat(u(a.map((function(r){return M.Character(r[1][0])})))))),T.CallBuiltIn.apply(T,["string-map",e].concat(u(a.map((function(r){return M.String(r[1].slice(1),!1)})))))):a.every((function(r){return 1===r[1].length}))?T.CallBuiltIn("string",T.Call.apply(T,[e].concat(u(a.map((function(r){return M.Character(r[1][0])})))))):M.String("",!1)}),!0),Dr=K("vector-map",[{name:"proc"},{name:"vector1"},{name:"vectors",type:"variadic"}],(function(r){var e=r.proc,n=r.vector1,t=r.vectors;q.Procedure(e),q.Vector(n),q.Vectors(t);var a=[n].concat(u(t));return a.every((function(r){return r[1].length>1}))?T.CallBuiltIn("vector-append",T.CallBuiltIn("vector",T.Call(e,M.MultiValue(a.map((function(r){return r[1][0]}))))),T.CallBuiltIn.apply(T,["vector-map",e].concat(u(a.map((function(r){return M.Vector(r[1].slice(1),!1)})))))):a.every((function(r){return r[1].length>=1}))?T.CallBuiltIn("vector",T.Call(e,M.MultiValue(a.map((function(r){return r[1][0]}))))):M.Vector([],!1)}),!0),Qr=K("for-each",[{name:"proc"},{name:"list1"},{name:"lists",type:"variadic"}],(function(r){var e=r.proc,n=r.list1,t=r.lists;q.Procedure(e),q.List(n),q.Lists(t);var a=[n].concat(u(t));return a.every((function(r){return D.Pair(r)}))?T.Begin(T.Call(e,M.MultiValue(a.map((function(r){return r[1]})))),T.CallBuiltIn("for-each",M.MultiValue([e].concat(u(a.map((function(r){return r[2]}))))))):["<undefined>"]}),!0),Rr=K("string-for-each",[{name:"proc"},{name:"str1"},{name:"strs",type:"variadic"}],(function(r){var e=r.proc,n=r.str1,t=r.strs;q.Procedure(e),q.String(n),q.Strings(t);var a=[n].concat(u(t));return a.every((function(r){return r[1].length>1}))?T.Begin(T.Call.apply(T,[e].concat(u(a.map((function(r){return M.Character(r[1][0])}))))),T.CallBuiltIn.apply(T,["string-for-each",e].concat(u(a.map((function(r){return M.String(r[1].slice(1),!1)})))))):a.every((function(r){return 1===r[1].length}))?T.Call.apply(T,[e].concat(u(a.map((function(r){return M.Character(r[1][0])}))))):["<undefined>"]}),!0),qr=K("vector-for-each",[{name:"proc"},{name:"vector1"},{name:"vectors",type:"variadic"}],(function(r){var e=r.proc,n=r.vector1,t=r.vectors;q.Procedure(e),q.Vector(n),q.Vectors(t);var a=[n].concat(u(t));return a.every((function(r){return r[1].length>1}))?T.Begin(T.Call(e,M.MultiValue(a.map((function(r){return r[1][0]})))),T.CallBuiltIn.apply(T,["vector-for-each",e].concat(u(a.map((function(r){return M.Vector(r[1].slice(1),!1)})))))):a.every((function(r){return 1===r[1].length}))?T.Call(e,M.MultiValue(a.map((function(r){return r[1][0]})))):T.Quote(["<null>"])}),!0),Ur=K("call-with-current-continuation",[{name:"proc"}],(function(r,e,n){var t=r.proc;return q.Procedure(t),U(n),T.Call(t,M.Continuation(C(n)))}),!0),Jr=W("call/cc",Ur),Fr=K("values",[{name:"objs",type:"variadic"}],(function(r){var e=r.objs;return q.Objects(e),1===e.length?e[0]:M.MultiValue(e)})),$r=K("call-with-values",[{name:"producer"},{name:"consumer"}],(function(r,e,n){var t=r.producer,a=r.consumer;q.Procedure(t),q.Procedure(a),U(n);var o=L(n,M.List(a),{want:"args",oper:a});return z(o,M.List(t))})),Zr=K("dynamic-wind",[{name:"before"},{name:"thunk"},{name:"after"}],(function(r,e,n){var t=r.before,a=r.thunk,o=r.after;q.Procedure(t),q.Procedure(a),q.Procedure(o),U(n);var i=M.Continuation(C(n));return z(n,T.Begin(T.Call(t),T.Call(i,T.Call(a))),{before:t,after:o})})),_r={procedureQ:Lr,apply:Vr,map:Mr,stringMap:Tr,vectorMap:Dr,forEach:Qr,stringForEach:Rr,vectorForEach:qr,callWithCurrentContinuation:Ur,callCC:Jr,values:Fr,callWithValues:$r,dynamicWind:Zr},Xr=K("eqv?",[{name:"obj1"},{name:"obj2"}],(function(r){var e=r.obj1,n=r.obj2;q.Object(e),q.Object(n);var t=function(r){return D.String(r)||D.ByteVector(r)||D.Vector(r)?r.slice(0,r.length-1):D.Pair(r)?r.slice(0,3):r};return M.Boolean(e===n||G(t(e),t(n)))})),Kr=W("eq?",Xr),Wr=K("equal?",[{name:"obj1"},{name:"obj2"}],(function(r){var e=r.obj1,n=r.obj2;q.Object(e),q.Object(n);return M.Boolean(function r(e,n){return e===n||(D.Pair(e)&&D.Pair(n)?r(e[1],n[1])&&r(e[2],n[2]):D.Vector(e)&&D.Vector(n)?e[1]===n[1]||e[1].length===n[1].length&&e[1].every((function(e,t){return r(e,n[1][t])})):D.ByteVector(e)&&D.ByteVector(n)?G(e[1],n[1]):Xr.body({obj1:e,obj2:n})[1])}(e,n))})),Gr={eqvQ:Xr,eqQ:Kr,equalQ:Wr},Hr=K("with-exception-handler",[{name:"handler"},{name:"thunk"}],(function(r,e,n){var t=r.handler,a=r.thunk;return q.Procedure(t),q.Procedure(a),U(n),L(n,T.Call(a),{handler:M.HandlerStack(t,k(n).handler)})})),Yr=K("raise",[{name:"obj"}],(function(r,e,n){var t=r.obj;throw q.Object(t),U(n),M.Exception(n,t,!1)})),re=K("raise-continuable",[{name:"obj"}],(function(r,e,n){var t=r.obj;throw q.Object(t),U(n),M.Exception(n,t,!0)})),ee=K("error",[{name:"message"},{name:"objs",type:"variadic"}],(function(r,e,n){var t=r.message,a=r.objs;throw q.String(t),q.Objects(a),U(n),M.Exception(n,M.Error("error",t[1],a),!0)})),ne=K("error-object?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Error(e))})),te=K("error-object-message",[{name:"err"}],(function(r){var e,n=r.err;return q.Error(n),M.String(null!==(e=n[2])&&void 0!==e?e:n[1],!1)})),ae=K("error-object-irritants",[{name:"err"}],(function(r){var e=r.err;return q.Error(e),M.List.apply(M,u(e[3]))})),oe=K("read-error?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Error(e)&&"read-error"===e[1])})),ie=K("file-error?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Error(e)&&"file-error"===e[1])})),ue={withExceptionHandler:Hr,raise:Yr,raiseContinuable:re,error:ee,errorObjectQ:ne,errorObjectMessage:te,errorObjectIrritants:ae,readErrorQ:oe,fileErrorQ:ie},ce=K("quote",[{name:"value",evaluate:!1}],(function(r){var e=r.value;return q.Object(e),e})),le=K("lambda",[{name:"formals",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.formals,a=r.body;q.Object(t),q.Objects(a),U(n);var i=o(H(t),2),c=i[0],l=i[1];return M.Procedure("lambda",l?[].concat(u(c),[l]):c,T.BeginIfMultiple.apply(T,u(a)),!1,k(n).env)})),fe=K("if",[{name:"test"},{name:"consequent",evaluate:!1},{name:"alternate",type:"optional",evaluate:!1}],(function(r){var e=r.test,n=r.consequent,t=r.alternate;return q.Object(e),q.Object(n),D.False(e)?t?(q.Object(t),t):["<undefined>"]:n}),!0),se=K("set!",[{name:"variable",evaluate:!1},{name:"expr"}],(function(r,e,n){var t=r.variable,a=r.expr;if(U(e),U(n),q.Symbol(t),q.Object(a),D.Undefined(a))throw M.Error("undefined-variable",'Attempt to set undefined value to a variable "'.concat(t[1],'"'));if(!e.setStatic(k(n).env.static,t,a))throw M.Error("unbound-variable",'Attempt to set value to an unbound variable "'.concat(t[1],'"'));return["<undefined>"]})),me=K("cond",[{name:"clause",evaluate:!1},{name:"clauses",type:"variadic",evaluate:!1}],(function(r){var e=r.clause,n=r.clauses;q.Pair(e),q.Pairs(n);var t=0===n.length?["<undefined>"]:T.Cond.apply(T,[n[0]].concat(u(n.splice(1)))),a=i($(e)),o=a[0],c=a[1],l=a.slice(2);if(D.Symbol(o)&&"else"===o[1])return T.BeginIfMultiple.apply(T,[c].concat(u(l)));if(c){if(D.Symbol(c)&&"=>"===c[1]){if(1!==l.length)throw M.Error("syntax-error","Illegal cond syntax (test => expression).");var f=M.Symbol(X());return T.Let([[f,o]],T.If(f,T.Call(l[0],f),t))}return T.If(o,T.BeginIfMultiple.apply(T,[c].concat(u(l))),t)}return T.Or(o,t)}),!0),pe=K("case",[{name:"key"},{name:"clauses",type:"variadic",evaluate:!1}],(function(r){var e=r.key,n=r.clauses;q.Object(e),q.Pairs(n);var t=n.find((function(r,t){if(D.Symbol(r[1])&&"else"===r[1][1]){if(t!==n.length-1)throw M.Error("syntax-error","Illegal case syntax (else placement).");return!0}return q.Pair(r[1]),$(r[1]).some((function(r){return Xr.body({obj1:r,obj2:e})[1]}))}));if(t){var a=i($(t)),o=a[1],c=a.slice(2);if(o){if(D.Symbol(o)&&"=>"===o[1]){if(1!==c.length)throw M.Error("syntax-error","Illegal cond syntax (test => expression).");return T.Call(c[0],M.MultiValue([e]))}return T.BeginIfMultiple.apply(T,[o].concat(u(c)))}throw M.Error("syntax-error","Illegal cond syntax (short clause).")}return["<undefined>"]}),!0),ve=K("and",[{name:"first",type:"optional"},{name:"rest",type:"variadic",evaluate:!1}],(function(r){var e=r.first,n=r.rest;return e?(q.Object(e),q.Objects(n),0===n.length||D.False(e)?T.Quote(e):T.And.apply(T,u(n))):M.Boolean(!0)}),!0),de=K("or",[{name:"first",type:"optional"},{name:"rest",type:"variadic",evaluate:!1}],(function(r){var e=r.first,n=r.rest;return e?(q.Object(e),q.Objects(n),0!==n.length&&D.False(e)?T.Or.apply(T,u(n)):T.Quote(e)):M.Boolean(!1)}),!0),be=K("when",[{name:"test"},{name:"expr",evaluate:!1},{name:"exprs",type:"variadic",evaluate:!1}],(function(r){var e=r.test,n=r.expr,t=r.exprs;return q.Object(e),q.Object(n),q.Objects(t),D.False(e)?["<undefined>"]:T.BeginIfMultiple.apply(T,[n].concat(u(t)))}),!0),ye=K("unless",[{name:"test"},{name:"expr",evaluate:!1},{name:"exprs",type:"variadic",evaluate:!1}],(function(r){var e=r.test,n=r.expr,t=r.exprs;return q.Object(e),q.Object(n),q.Objects(t),D.False(e)?T.BeginIfMultiple.apply(T,[n].concat(u(t))):["<undefined>"]}),!0),ge=K("let",[{name:"args",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.args;q.Objects(t);var a=i(D.Symbol(t[0])?t:[null].concat(u(t))),c=a[0],l=a[1],f=a.slice(2);q.List(l),q.Objects(f),U(n);var s=$(l).map((function(r){q.Pair(r),q.Symbol(r[1]),q.Pair(r[2]);var e=o(r,3);return[e[1],o(e[2],2)[1]]})),m=s.map((function(r){return o(r,1)[0]})),p=s.map((function(r){return o(r,2)[1]})),v=T.Lambda.apply(T,[m,null].concat(u(f)));return c?(q.Symbol(c),T.CallThunk(T.Define(c,v),T.Call.apply(T,[c].concat(u(p))))):T.Call.apply(T,[v].concat(u(p)))}),!0),he=K("let*",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.bindings,a=r.body;if(q.List(t),q.Objects(a),U(n),D.Pair(t)){q.Pair(t[1]),q.Pair(t[1][2]);var i=o(t,3),c=o(i[1],3),l=c[1],f=o(c[2],2)[1],s=i[2];return q.Symbol(l),T.Call(T.Lambda([l],null,T.CallBuiltIn.apply(T,["let*",s].concat(u(a)))),f)}return T.BeginIfMultiple.apply(T,u(a))}),!0),we=K("letrec",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.bindings,a=r.body;q.List(t),q.Objects(a),U(e),U(n);var i=$(t).map((function(r){q.Pair(r),q.Symbol(r[1]),q.Pair(r[2]);var e=o(r,3);return[e[1],o(e[2],2)[1]]})),c=k(n).env,l=c.static,f=c.dynamic,s=V(l);return i.forEach((function(r){var n=o(r,1)[0];return e.defineStatic(s,n,["<undefined>"])})),T.Call(M.Procedure("lambda",[],T.Begin.apply(T,[T.DefineValues(i.map((function(r){return o(r,1)[0]})),T.Values.apply(T,u(i.map((function(r){return o(r,2)[1]})))))].concat(u(a))),!1,{static:s,dynamic:f}))}),!0),je=K("letrec*",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.bindings,a=r.body;q.List(t),q.Objects(a),U(e),U(n);var i=$(t).map((function(r){q.Pair(r),q.Symbol(r[1]),q.Pair(r[2]);var e=o(r,3);return[e[1],o(e[2],2)[1]]})),c=k(n).env,l=c.static,f=c.dynamic,s=V(l);return i.forEach((function(r){var n=o(r,1)[0];return e.defineStatic(s,n,["<undefined>"])})),T.Call(M.Procedure("lambda",[],T.Begin.apply(T,u(i.map((function(r){var e=o(r,2),n=e[0],t=e[1];return T.Set(n,t)}))).concat(u(a))),!1,{static:s,dynamic:f}))}),!0),Se=K("let-values",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.bindings,a=r.body;return q.List(t),q.Objects(a),U(n),T.CallThunk.apply(T,u($(t).map((function(r){q.Pair(r),q.Pair(r[2]);var e=o(r,3),t=e[1],a=o(e[2],2)[1],i=M.Procedure("lambda",[],a,!1,k(n).env);return T.CallBuiltIn("define-values",t,T.Call(i))}))).concat(u(a)))}),!0),xe=K("let*-values",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.bindings,a=r.body;if(q.List(t),q.Objects(a),U(n),D.Pair(t)){q.Pair(t[1]),q.Pair(t[1][2]);var i=o(t,3),c=o(i[1],3),l=c[1],f=o(c[2],2)[1],s=i[2];return T.CallThunk(T.CallBuiltIn("define-values",l,f),T.CallBuiltIn.apply(T,["let*-values",s].concat(u(a))))}return T.BeginIfMultiple.apply(T,u(a))}),!0),Ne=K("begin",[{name:"exprs",type:"variadic",evaluate:!0},{name:"last",type:"tail",evaluate:!1}],(function(r,e,n){var t=r.exprs,a=r.last;return function(r){if(!(r instanceof Array))throw M.Error("program-error","An array is expected.")}(t),q.Object(a),U(n),0===k(n).depth?z(n,a):a}),!0),Ee=K("do",[{name:"specs",evaluate:!1},{name:"clause",evaluate:!1},{name:"commands",type:"variadic",evaluate:!1}],(function(r){var e=r.specs,n=r.clause,t=r.commands;q.List(e),q.List(n),q.Objects(t);var a=$(e).map((function(r){q.Pair(r),q.Pair(r[2]),q.Symbol(r[1]);var e=o(r,3),n=e[1],t=o(e[2],3),a=t[1],i=t[2];return[n,a,D.Pair(i)?i[1]:null]})),i=o(n,3),c=i[1],l=i[2];return q.Object(c),q.List(l),T.Let(a.map((function(r){var e=o(r,2);return[e[0],e[1]]})),T.If(c,T.Begin.apply(T,u($(l))),T.Begin.apply(T,u(t).concat([T.CallBuiltIn.apply(T,["do",M.List.apply(M,u(a.map((function(r){var e=o(r,3),n=e[0],t=e[2];return M.List(n,null!=t?t:n,null!=t?t:n)})))),n].concat(u(t)))]))))}),!0),Pe=K("make-parameter",[{name:"init"},{name:"converter",type:"optional"}],(function(r,e,n){var t=r.init,a=r.converter;q.Object(t),U(e),U(n);for(var o=X();o in k(n).env.dynamic[1];)o=X();return a&&q.Procedure(a),e.defineDynamic(k(n).env.dynamic,o,t),M.Parameter(o,null!=a?a:null)})),Ie=K("parameterize",[{name:"assocs",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.assocs,a=r.body;q.Pair(t),q.Pairs(a),U(e),U(n);var i=k(n).env,c=$(t).map((function(r){q.Pair(r),q.Pair(r[2]);var e=o(r,3);return[e[1],o(e[2],2)[1]]})),l={static:i.static,dynamic:M.DynamicNS({},i.dynamic)},f=T.BeginIfMultiple.apply(T,u(c.map((function(r){var e=o(r,2),n=e[0],t=e[1];return T.CallBuiltIn("define-parameter",n,t)}))).concat(u(a)));return L(n,f,{env:l})})),Oe=K("define-parameter",[{name:"param"},{name:"value",evaluate:!1}],(function(r,e,n){var t=r.param,a=r.value;q.Parameter(t),q.Object(a),U(e),U(n);var i=o(t,3)[2];return T.CallBuiltIn("define-parameter-1",t,i?T.Call(i,a):a)}),!0,!0),Be=K("define-parameter-1",[{name:"param"},{name:"value"}],(function(r,e,n){var t,a=r.param,o=r.value;if(q.Parameter(a),q.Object(o),U(e),U(n),!D.Undefined(null!==(t=B(k(n).env.dynamic)[a[1]])&&void 0!==t?t:["<undefined>"]))throw M.Error("redefine-variable",null);return e.defineDynamic(k(n).env.dynamic,a[1],o),["<undefined>"]}),!1,!0),Ce=K("guard",[{name:"arg1",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.arg1,a=r.body;q.Pair(t),q.Objects(a),q.Symbol(t[1]),q.Pair(t[2]),U(n);var i=o(t,3),c=i[1],l=i[2],f=M.Continuation(C(n)),s=M.Procedure("lambda",[{name:c[1]}],T.Call(f,T.CallBuiltIn.apply(T,["cond"].concat(u($(l)),[M.List(M.Symbol("else"),T.RaiseContinuable(c))]))),!1,k(n).env);return T.CallBuiltIn("with-exception-handler",s,T.Lambda.apply(T,[[],null].concat(u(a))))}),!0),Ae=K("quasiquote",[{name:"template",evaluate:!1}],(function(r){var e=r.template;q.Object(e);var n=[],t=[],a=function r(e,a){if(D.Pair(e)){var i=o(e,3),u=i[1],c=i[2];if(D.Symbol(u)&&"quasiquote"===u[1])return M.Pair(u,r(c,a+1));if(D.Symbol(u)&&"unquote"===u[1]||"unquote-splicing"===u[1]){if(0!==a)return M.Pair(u,r(c,a-1));var l=M.Symbol("unquote-splicing"===u[1]?"@"+X():X());return q.Pair(c),n.push(l),t.push(c[1]),l}return M.Pair(r(u,a),r(c,a))}return D.Vector(e)?M.Vector(e[1].map((function(e){return r(e,a)})),!1):e}(e,0);return T.CallBuiltIn.apply(T,["quasiquote-1",a,M.List.apply(M,n)].concat(t))}),!0),ke=K("quasiquote-1",[{name:"template",evaluate:!1},{name:"marks",evaluate:!1},{name:"exprs",type:"variadic"}],(function(r){var e=r.template,n=r.marks,t=r.exprs;q.Object(e),q.List(n),q.Objects(t);var a=$(n);q.Symbols(a);var i=new Map;if(a.length!==t.length)throw M.Error("arity-error","quasiquote-1: marks and exprs unmatch.");a.forEach((function(r,e){return i.set(r[1],t[e])}));return function r(e){if(D.Pair(e)){var n=o(e,3),t=n[1],a=n[2];if(D.Symbol(t)&&"@"===t[1][0]&&i.has(t[1])){var u=i.get(t[1]);if(D.List(u))return D.Null(u)?r(a):_($(u),r(a));throw M.Error("error","unquote-splicing evaluated as non-list object.")}return M.Pair(r(t),r(a))}return D.Vector(e)?M.Vector(e[1].map((function(e){if(D.Symbol(e)&&"@"===e[1][0]&&i.has(e[1])){var n=i.get(e[1]);if(D.List(n))return D.Null(n)?[]:$(n);throw M.Error("error","unquote-splicing evaluated as non-list object.")}return[r(e)]})).flat(),!1):D.Symbol(e)&&i.has(e[1])&&"@"!==e[1][0]?i.get(e[1]):e}(e)}),!1,!0),ze=K("let-syntax",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.bindings,a=r.body;q.List(t,"aa"),q.Objects(a),U(n);var i=$(t).map((function(r){q.Pair(r),q.Pair(r[2]),q.Symbol(r[1]);var e=o(r,3),t=e[1],a=o(e[2],2)[1];return[t,M.Procedure("lambda",[],a,!1,k(n).env)]}));return T.CallThunk.apply(T,u(i.map((function(r){var e=o(r,2),n=e[0],t=e[1];return T.CallBuiltIn("define-syntax",n,T.Call(t))}))).concat(u(a)))}),!0),Le=K("letrec-syntax",[{name:"bindings",evaluate:!1},{name:"body",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.bindings,a=r.body;q.List(t),q.Objects(a),U(e),U(n);var i=$(t).map((function(r){q.Pair(r),q.Pair(r[2]),q.Symbol(r[1]);var e=o(r,3);return[e[1],o(e[2],2)[1]]})),c=k(n).env,l=c.static,f=c.dynamic,s=V(l);return i.forEach((function(r){var n=o(r,1)[0];return e.defineStatic(s,n,["<undefined>"])})),T.Call(M.Procedure("lambda",[],T.Begin.apply(T,u(i.map((function(r){var e=o(r,2),n=e[0],t=e[1];return T.CallBuiltIn("define-syntax",n,t)}))).concat(u(a))),!1,{static:s,dynamic:f}))}),!0),Ve=K("syntax-rules",[{name:"arg1",evaluate:!1},{name:"arg2",evaluate:!1},{name:"args",type:"variadic",evaluate:!1}],(function(r,e,n){var t=r.arg1,a=r.arg2,i=r.args;q.Object(t),q.Object(a),q.Objects(i),U(e),U(n);var c=o(D.Symbol(t)?[t[1],a,i]:["...",t,[a].concat(u(i))],3),l=c[0],f=c[1],s=c[2];q.List(f);var m=$(f).map((function(r){return q.Symbol(r),r[1]})),v=function r(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(D.Pair(t))return M.Pair(r(t[1],a),r(t[2],a));if(D.Symbol(t)){var o;if(e.getStatic(k(n).env.static,t))return M.Symbol(t[1],k(n).env.static,null!==(o=t[3])&&void 0!==o?o:null);if(m.includes(t[1])||l===t[1]||"_"===t[1])return t;if(a.has(t[1]))return a.get(t[1]);var i=M.Symbol(t[1],null,X());return a.set(t[1],i),i}return t};q.Pairs(s);var d,b=[],y=p(s);try{for(y.s();!(d=y.n()).done;){var g,h=v(d.value);q.Pair(h),q.Pair(h[2]);var w=o(h,3),j=w[1],S=o(w[2],2)[1];q.Pair(j);var x=o(Z(j),1)[0],N=x.findIndex((function(r){return D.Symbol(r)&&r[1]===l})),E=N<0?x.slice(1):x.slice(1,N-1),P=N<0?[]:x.slice(N+1),I=["<syntax-rule-pattern>",E,N<0?null:null!==(g=x[N-1])&&void 0!==g?g:null,P];b.push([I,S])}}catch(r){y.e(r)}finally{y.f()}return M.SyntaxRules(l,m,b)})),Me=K("use-syntax-rules",[{name:"spec"},{name:"args",type:"variadic"}],(function(r,e,n){var t=r.spec,a=r.args;q.SyntaxRules(t),q.Objects(a),U(e),U(n);var i,c=o(t,4),l=c[1],f=c[2],s=c[3];if(0===a.length)i=[];else{var m=[a.slice(0,a.length-1),a[a.length-1]],v=m[0],d=m[1];q.List(d),i=[].concat(u(v),u($(d)))}var b,y=new Map,g=null,h=k(C(n)).env.static,w=function(r,n){if(D.Symbol(r)&&f.includes(r[1])){if(D.Symbol(n)){var t=e.getStatic(h,r),a=e.getStatic(h,r);return r[1]===n[1]&&t===a}return!1}return!!D.Symbol(r)||!!Wr.body({obj1:r,obj2:n})[1]},j=p(s);try{for(j.s();!(b=j.n()).done;){var S=b.value,x=o(S,1),N=o(x[0],4),E=N[1],P=N[2],I=N[3];if(P?i.length>=E.length+I.length:i.length===E.length+I.length){var O=i.length-E.length-I.length,B=[].concat(u(E),u(Array(O).fill(P)),u(I));if(B.every((function(r,e){return w(r,i[e])}))){D.Symbol(P)&&y.set(P[1],[]),g=S[1];for(var A=0;A<B.length;A++){var z=B[A],L=i[A];if(D.Symbol(z)&&"_"!==z[1]){var V=y.get(z[1]);V&&!D.Object(V)?V.push(L):y.set(z[1],L)}}break}}}}catch(r){j.e(r)}finally{j.f()}if(!g)throw M.Error("syntax-rules-unmatch","No rules match arguments.");return function r(e){if(D.Pair(e)){var n=o(e,3),t=n[1],a=n[2];if(D.Symbol(t)&&y.has(t[1])&&D.Symbol(a[1])&&a[1][1]===l){var i=y.get(t[1]);if(!i||D.Object(i))throw M.Error("syntax-error",'Pattern variable "'.concat(t[1],' is not variadic." '));return _(i,r(a[2]))}return D.Pair(t)&&D.Symbol(t[1])&&t[1][1]===l&&D.Pair(t[2])?M.Pair(r(t[2][1]),r(a)):M.Pair(r(t),r(a))}if(D.Symbol(e)&&y.has(e[1])){var u=y.get(e[1]);if(!D.Object(u))throw M.Error("syntax-error",'Pattern variable "'.concat(e[1],'" must be variadic. (add "').concat(l,'" after the symbol)" '));return u}return e}(g)}),!1,!0),Te=K("syntax-error",[{name:"message"},{name:"args",type:"variadic"}],(function(r){var e=r.message,n=r.args;throw q.String(e),q.Objects(n),M.Error("syntax-error",e[1],n)})),De={quote:ce,lambda:le,If:fe,setD:se,cond:me,Case:pe,and:ve,or:de,when:be,unless:ye,Let:ge,LetStar:he,letrecStar:je,letrec:we,letValues:Se,letStarValues:xe,begin:Ne,Do:Ee,makeParameter:Pe,parameterize:Ie,defineParameter:Oe,defineParameter1:Be,guard:Ce,quasiquote:Ae,quasiquote1:ke,letSyntax:ze,letrecSyntax:Le,syntaxRules:Ve,applySyntaxRules:Me,syntaxError:Te},Qe=K("pair?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Pair(e))})),Re=K("cons",[{name:"obj1"},{name:"obj2"}],(function(r){var e=r.obj1,n=r.obj2;return q.Object(e),q.Object(n),M.Pair(e,n)})),qe=K("car",[{name:"pair"}],(function(r){var e=r.pair;return q.Pair(e),e[1]})),Ue=K("cdr",[{name:"pair"}],(function(r){var e=r.pair;return q.Pair(e),e[2]})),Je=K("set-car!",[{name:"pair"},{name:"obj"}],(function(r){var e=r.pair,n=r.obj;if(q.Pair(e),q.Object(n),e[3])throw M.Error("immutable-object","Specified list is immutable");return e[1]=n,e})),Fe=K("set-cdr!",[{name:"pair"},{name:"obj"}],(function(r){var e=r.pair,n=r.obj;if(q.Pair(e),q.Object(n),e[3])throw M.Error("immutable-object","Specified list is immutable");return e[2]=n,e})),$e=K("caar",[{name:"pair"}],(function(r){var e=r.pair;return q.Pair(e),q.Pair(e[1]),e[1][1]})),Ze=K("cadr",[{name:"pair"}],(function(r){var e=r.pair;return q.Pair(e),q.Pair(e[2]),e[2][1]})),_e=K("cdar",[{name:"pair"}],(function(r){var e=r.pair;return q.Pair(e),q.Pair(e[1]),e[1][2]})),Xe=K("cddr",[{name:"pair"}],(function(r){var e=r.pair;return q.Pair(e),q.Pair(e[2]),e[2][2]})),Ke=K("null?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Null(e))})),We=K("list?",[{name:"obj"}],(function(r){var e=r.obj;if(q.Object(e),!D.List(e))return M.Boolean(!1);if(D.Null(e))return M.Boolean(!0);try{var n=o(Z(e),2)[1];return M.Boolean(D.Null(n))}catch(r){return M.Boolean(!1)}})),Ge=K("make-list",[{name:"k"},{name:"fill",type:"optional"}],(function(r){var e=r.k,n=r.fill;return q.IntegerNumber(e),n?(q.Object(n),M.List.apply(M,u(Array.from({length:e[1]},(function(){return n}))))):M.List.apply(M,u(Array.from({length:e[1]},(function(){return["<undefined>"]}))))})),He=K("list",[{name:"objs",type:"variadic"}],(function(r){var e=r.objs;return q.Objects(e),M.List.apply(M,u(e))})),Ye=K("length",[{name:"list"}],(function(r){var e=r.list;return q.List(e),M.Number($(e).length)})),rn=K("append",[{name:"args",type:"variadic"}],(function(r){var e=r.args;if(q.Objects(e),0===e.length)return["<null>"];if(1===e.length)return e[0];var n=[e.slice(0,e.length-1),e[e.length-1]],t=n[0],a=n[1];return q.Lists(t),_(t.map((function(r){return $(r)})).flat(),a)})),en=K("reverse",[{name:"list"}],(function(r){var e=r.list;return q.List(e),M.List.apply(M,u($(e).reverse()))})),nn=K("list-tail",[{name:"list"},{name:"k"}],(function(r){var e=r.list,n=r.k;if(q.Object(e),q.IntegerNumber(n),0===n[1])return e;q.List(e);for(var t=e,a=0;D.Pair(t);t=t[2],a++)if(a===n[1])return t;throw M.Error("out-of-range","Specified list is shorter than specified number ".concat(n[1]))})),tn=K("list-ref",[{name:"list"},{name:"k"}],(function(r){var e=r.list,n=r.k;q.Pair(e),q.IntegerNumber(n);for(var t=e,a=0;D.Pair(t);t=t[2],a++)if(a===n[1])return t[1];throw M.Error("out-of-range","Specified list is shorter than specified number ".concat(n[1]))})),an=K("list-set!",[{name:"list"},{name:"k"},{name:"obj"}],(function(r){var e=r.list,n=r.k,t=r.obj;q.Pair(e),q.IntegerNumber(n),q.Object(t);for(var a=e,o=0;D.Pair(a);a=a[2],o++)if(o===n[1]){if(a[3])throw M.Error("immutable-object","Specified list is immutable");return a[1]=t,["<undefined>"]}throw M.Error("out-of-range","Specified list is shorter than specified number ".concat(n[1]))})),on=K("memq",[{name:"obj"},{name:"list"}],(function(r){var e=r.obj,n=r.list;q.Object(e),q.List(n);var t=$(n).findIndex((function(r){return Kr.body({obj1:e,obj2:r})[1]}));return t<0?M.Boolean(!1):nn.body({list:n,k:M.Number(t)})})),un=K("memv",[{name:"obj"},{name:"list"}],(function(r){var e=r.obj,n=r.list;q.Object(e),q.List(n);var t=$(n).findIndex((function(r){return Xr.body({obj1:e,obj2:r})[1]}));return t<0?M.Boolean(!1):nn.body({list:n,k:M.Number(t)})})),cn=K("member",[{name:"obj"},{name:"list"},{name:"compare",type:"optional"}],(function(r){var e=r.obj,n=r.list,t=r.compare;if(q.Object(e),q.List(n),D.Null(n))return M.Boolean(!1);if(t){q.Procedure(t);var a=o(n,3),i=a[1],u=a[2];return T.If(T.Call(t,i,e),n,T.CallBuiltIn("member",e,u,t))}var c=$(n).findIndex((function(r){return Wr.body({obj1:e,obj2:r})[1]}));return c<0?M.Boolean(!1):T.Quote(nn.body({list:n,k:M.Number(c)}))}),!0),ln=K("assq",[{name:"obj"},{name:"alist"}],(function(r){var e=r.obj,n=r.alist;q.Object(e),q.List(n);var t=$(n).find((function(r){return q.Pair(r),Kr.body({obj1:e,obj2:r[1]})[1]}));return null!=t?t:M.Boolean(!1)})),fn=K("assv",[{name:"obj"},{name:"alist"}],(function(r){var e=r.obj,n=r.alist;q.Object(e),q.List(n);var t=$(n).find((function(r){return q.Pair(r),Xr.body({obj1:e,obj2:r[1]})[1]}));return null!=t?t:M.Boolean(!1)})),sn=K("assoc",[{name:"obj"},{name:"alist"},{name:"compare",type:"optional"}],(function(r){var e=r.obj,n=r.alist,t=r.compare;if(q.Object(e),q.List(n),D.Null(n))return M.Boolean(!1);if(t){q.Procedure(t);var a=o(n,3),i=a[1],u=a[2];return q.Pair(i),T.If(T.Call(t,M.MultiValue([i[1],e])),T.Quote(i),T.CallBuiltIn("assoc",M.MultiValue([e,u,t])))}var c=$(n).find((function(r){return q.Pair(r),Wr.body({obj1:e,obj2:r[1]})[1]}));return c?T.Quote(c):M.Boolean(!1)}),!0),mn=K("list-copy",[{name:"obj"}],(function(r){var e=r.obj;if(q.Object(e),D.List(e)){if(D.Null(e))return["<null>"];var n=o(Z(e),2),t=n[0],a=n[1];return _(t,a)}return e})),pn={pairQ:Qe,cons:Re,car:qe,cdr:Ue,setCarD:Je,setCdrD:Fe,caar:$e,cadr:Ze,cdar:_e,cddr:Xe,nullQ:Ke,listQ:We,makeList:Ge,list:He,length:Ye,append:rn,reverse:en,listTail:nn,listRef:tn,listSetD:an,memq:on,memv:un,member:cn,assq:ln,assv:fn,assoc:sn,listCopy:mn},vn=K("number?",[{name:"obj"}],(function(r){var e=r.obj;return M.Boolean(D.Number(e))})),dn=K("real?",[{name:"obj"}],(function(r){var e=r.obj;return M.Boolean(D.Number(e))})),bn=K("integer?",[{name:"obj"}],(function(r){var e=r.obj;return M.Boolean(D.Number(e)&&Number.isInteger(P(e)))})),yn=K("exact?",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return M.Boolean(Number.isSafeInteger(n))})),gn=K("inexact?",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return M.Boolean(!Number.isSafeInteger(n))})),hn=W("exact-integer?",yn),wn=K("=",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,n=r.z2,t=r.zs;q.Number(e),q.Number(n),q.Numbers(t);var a=[e,n].concat(u(t)).map(P);return M.Boolean(a.slice(1).every((function(r){return a[0]===r})))})),jn=K("<",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,n=r.z2,t=r.zs;q.Number(e),q.Number(n),q.Numbers(t);var a=[e,n].concat(u(t)).map(P);return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]<r})))})),Sn=K(">",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,n=r.z2,t=r.zs;q.Number(e),q.Number(n),q.Numbers(t);var a=[e,n].concat(u(t)).map(P);return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]>r})))})),xn=K("<=",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,n=r.z2,t=r.zs;q.Number(e),q.Number(n),q.Numbers(t);var a=[e,n].concat(u(t)).map(P);return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]<=r})))})),Nn=K(">=",[{name:"z1"},{name:"z2"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,n=r.z2,t=r.zs;q.Number(e),q.Number(n),q.Numbers(t);var a=[e,n].concat(u(t)).map(P);return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]>=r})))})),En=K("nan?",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return M.Boolean(Number.isNaN(n))})),Pn=K("zero?",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return M.Boolean(0===n)})),In=K("positive?",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return M.Boolean(n>0)})),On=K("negative?",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return M.Boolean(n<0)})),Bn=K("odd?",[{name:"n"}],(function(r){var e=r.n;q.Number(e);var n=P(e);return M.Boolean(Number.isInteger(n)&&1===Math.abs(n%2))})),Cn=K("even?",[{name:"n"}],(function(r){var e=r.n;q.Number(e);var n=P(e);return M.Boolean(Number.isInteger(n)&&0===Math.abs(n%2))})),An=K("max",[{name:"xs",type:"variadic"}],(function(r){var e=r.xs;return q.Numbers(e),I(Math.max.apply(Math,u(e.map(P))))})),kn=K("min",[{name:"xs",type:"variadic"}],(function(r){var e=r.xs;return q.Numbers(e),I(Math.min.apply(Math,u(e.map(P))))})),zn=K("+",[{name:"zs",type:"variadic"}],(function(r){var e=r.zs;return q.Numbers(e),I(e.map(P).reduce((function(r,e){return r+e}),0))})),Ln=K("-",[{name:"z1"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,n=r.zs;q.Number(e),q.Numbers(n);var t=P(e),a=n.map(P);return I(0===a.length?-t:a.reduce((function(r,e){return r-e}),t))})),Vn=K("*",[{name:"zs",type:"variadic"}],(function(r){var e=r.zs;return q.Numbers(e),I(e.map(P).reduce((function(r,e){return r*e}),1))})),Mn=K("/",[{name:"z1"},{name:"zs",type:"variadic"}],(function(r){var e=r.z1,n=r.zs;q.Number(e),q.Numbers(n);var t=P(e),a=n.map(P);return a.includes(0)?M.Error("division-by-zero",null):I(0===a.length?1/t:a.reduce((function(r,e){return r/e}),t))})),Tn=K("abs",[{name:"x"}],(function(r){var e=r.x;q.Number(e);var n=P(e);return I(Math.abs(n))})),Dn=K("floor/",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,n=r.n2;q.Number(e),q.Number(n);var t=P(e),a=P(n),o=(t%a+a)%a,i=(t-o)/a;return M.MultiValue([I(i),I(o)])})),Qn=K("floor-quotient",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,n=r.n2;q.Number(e),q.Number(n);var t=P(e),a=P(n);return I((t-(t%a+a)%a)/a)})),Rn=K("floor-remainder",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,n=r.n2;q.Number(e),q.Number(n);var t=P(e),a=P(n);return I((t%a+a)%a)})),qn=K("truncate/",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,n=r.n2;q.Number(e),q.Number(n);var t=P(e),a=P(n),o=t%a,i=(t-o)/a;return M.MultiValue([I(i),I(o)])})),Un=K("truncate-quotient",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,n=r.n2;q.Number(e),q.Number(n);var t=P(e),a=P(n);return I((t-t%a)/a)})),Jn=K("truncate-remainder",[{name:"n1"},{name:"n2"}],(function(r){var e=r.n1,n=r.n2;q.Number(e),q.Number(n);var t=P(e),a=P(n);return I(t%a)})),Fn=W("quotient",Un),$n=W("remainder",Jn),Zn=W("modulo",Rn),_n=K("gcd",[{name:"ns",type:"variadic"}],(function(r){var e=r.ns;if(q.Numbers(e),0===e.length)return I(0);return I(Math.abs(e.map(P).reduce((function r(e,n){return 0!==n?r(n,e%n):e}))))})),Xn=K("lcm",[{name:"ns",type:"variadic"}],(function(r){var e=r.ns;if(q.Numbers(e),0===e.length)return I(1);var n=function r(e,n){return 0!==n?r(n,e%n):e};return I(Math.abs(e.map(P).reduce((function(r,e){return r*e/n(r,e)}))))})),Kn=K("floor",[{name:"x"}],(function(r){var e=r.x;q.Number(e);var n=P(e);return I(Math.floor(n))})),Wn=K("ceiling",[{name:"x"}],(function(r){var e=r.x;q.Number(e);var n=P(e);return I(Math.ceil(n))})),Gn=K("truncate",[{name:"x"}],(function(r){var e=r.x;q.Number(e);var n=P(e);return I(Math.trunc(n))})),Hn=K("round",[{name:"x"}],(function(r){var e=r.x;q.Number(e);var n=P(e);return I(Math.round(n))})),Yn={numberQ:vn,realQ:dn,integerQ:bn,exactQ:yn,inexactQ:gn,exactIntegerQ:hn,eq:wn,lt:jn,gt:Sn,le:xn,ge:Nn,nanQ:En,zeroQ:Pn,positiveQ:In,negativeQ:On,oddQ:Bn,evenQ:Cn,max:An,min:kn,add:zn,sub:Ln,mul:Vn,div:Mn,abs:Tn,floorS:Dn,floorQuotient:Qn,floorRemainder:Rn,truncateS:qn,truncateQuotient:Un,truncateRemainder:Jn,quotient:Fn,remainder:$n,modulo:Zn,gcd:_n,lcm:Xn,floor:Kn,ceiling:Wn,truncate:Gn,rationalize:K("rationalize",[{name:"x"},{name:"y"}],(function(){throw M.Error("not-supported",'"Fraction numbers are not supported.')})),round:Hn,square:K("square",[{name:"x"}],(function(r){var e=r.x;q.Number(e);var n=P(e);return I(Math.pow(n,2))})),exactIntegerSqrt:K("exact-integer-sqrt",[{name:"k"}],(function(r){var e=r.k;q.IntegerNumber(e);var n=P(e);if(!Number.isSafeInteger(n)||n<0)throw M.Error("out-of-range","exact-integer-sqrt can calculate safe integer & positive value.");for(var t=n;t>0;t--){var a=Math.floor(Math.sqrt(t)),o=n-Math.pow(a,2);if(n<Math.pow(a+1,2))return M.MultiValue([I(a),I(o)])}return M.MultiValue([I(0),I(n)])})),expt:K("expt",[{name:"z1"},{name:"z2"}],(function(r){var e=r.z1,n=r.z2;q.Number(e),q.Number(n);var t=P(e),a=P(n);return I(Math.pow(t,a))})),inexact:K("inexact",[{name:"z"}],(function(r){var e=r.z;return q.Number(e),e})),exact:K("exact",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e),t=Number(n.toFixed());if(!Number.isSafeInteger(t))throw M.Error("out-of-range",'"exact" can\'t calculate exact number for '.concat(e[1],"."));return e})),numberToString:K("number->string",[{name:"z"},{name:"radix",type:"optional"}],(function(r){var e=r.z,n=r.radix;q.Number(e),q.Number(n);var t=P(e);if(isNaN(t))return M.String("+nan.0",!1);if(isFinite(t)){n&&q.IntegerNumber(n);var a=n?P(n):10;if(![2,8,10,16].includes(a))throw M.Error("out-of-range","radix must be one of 2, 8, 10, 16.");return M.String(t.toString(a),!1)}return M.String("".concat(t>0?"+":"-","inf.0"),!1)})),stringToNumber:K("string->number",[{name:"str"},{name:"radix",type:"optional"}],(function(r){var e=r.str,n=r.radix;q.String(e);var t,a=e[1];if(n){if(q.IntegerNumber(n),![2,8,10,16].includes(P(n)))throw M.Error("out-of-range","radix must be one of 2, 8, 10, 16.");var o="#".concat({2:"b",8:"o",10:"d",16:"x"}[P(n)]);a=a.replace(/^(#[dDbBoOxX])?/,o)}try{t=ur(a)}catch(r){return M.Boolean(!1)}return D.Number(t)?t:M.Boolean(!1)}))},rt=K("call-with-port",[{name:"port"},{name:"proc"}],(function(r){var e=r.port,n=r.proc;return q.Port(e),q.Procedure(n),T.Begin(T.Call(n,e),T.CallBuiltIn("close-port",e))})),et=K("input-port?",[{name:"obj"}],(function(r){var e,n=r.obj;return q.Object(n),M.Boolean(!(!D.Port(n)||null===(e=n[3])||void 0===e||!e.includes("r")))})),nt=K("output-port?",[{name:"obj"}],(function(r){var e,n=r.obj;return q.Object(n),M.Boolean(!(!D.Port(n)||null===(e=n[3])||void 0===e||!e.includes("w")))})),tt=K("textual-port?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Port(e)&&"string"==typeof e[5])})),at=K("binary-port?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Port(e)&&"string"!=typeof e[5])})),ot=K("port?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Port(e))})),it=K("input-port-open?",[{name:"port"}],(function(r){var e,n=r.port;return q.Port(n),M.Boolean(!(null===(e=n[3])||void 0===e||!e.includes("r")))})),ut=K("output-port-open?",[{name:"port"}],(function(r){var e,n=r.port;return q.Port(n),M.Boolean(!(null===(e=n[3])||void 0===e||!e.includes("w")))})),ct=K("close-port",[{name:"port"}],(function(r,e){var n=r.port;if(q.Port(n),!n[3])return["<undefined>"];if("built-in"===n[1]){var t;if(!e)throw M.Error("program-error","No interpreter object.");var a=e.getBuiltInPort(n[2]);if(!a)throw M.Error("program-error","Illegal built-in file object.");null===(t=a.close)||void 0===t||t.call(a)}else if("string"!==n[1]){if("file"===n[1]){if(null==e||!e.fs)throw M.Error("program-error",'No interpreter object or No Node.js "fs" object set on Interpreter.');return e.fs.closeSync(n[2]),M.Boolean(!0)}throw M.Error("program-error",'Unknown port type "'.concat(n[1],'"'))}return n[3]=null,["<undefined>"]})),lt=K("close-input-port",[{name:"port"}],(function(r){var e,n=r.port;if(q.Port(n),null===(e=n[3])||void 0===e||!e.includes("r"))return["<undefined>"];if("built-in"===n[1])throw M.Error("program-error","Can't close only output port for built-in port.");if("string"===n[1]);else if("bytevector"!==n[1])throw"file"===n[1]?M.Error("program-error","Can't close only input port for file port."):M.Error("program-error",'Unknown port type "'.concat(n[1],'"'));return n[3]=n[3].replace("r","")||null,["<undefined>"]})),ft=K("close-output-port",[{name:"port"}],(function(r){var e,n=r.port;if(q.Port(n),null===(e=n[3])||void 0===e||!e.includes("w"))return["<undefined>"];if("built-in"===n[1])throw M.Error("program-error","Can't close only output port for built-in port.");if("string"===n[1]);else if("bytevector"!==n[1])throw"file"===n[1]?M.Error("program-error","Can't close only output port for file port."):M.Error("program-error",'Unknown port type "'.concat(n[1],'"'));return n[3]=n[3].replace("w","")||null,["<undefined>"]})),st=K("open-input-string",[{name:"str"}],(function(r){var e=r.str;return q.String(e),M.Port("string",e[1],"r",null,"")})),mt=K("open-output-string",[],(function(){return M.Port("string","","w",null,"")})),pt=K("get-output-string",[{name:"port"}],(function(r){var e,n=r.port;if(q.Port(n),"string"!==n[1]||null===(e=n[3])||void 0===e||!e.includes("w"))throw M.Error("read-error","Not a port created by open-output-string.");return M.String(n[2],!1)})),vt=K("open-input-bytevector",[{name:"bvec"}],(function(r){var e=r.bvec;return q.ByteVector(e),M.Port("bytevector",u(e[1]),"r",null,[])})),dt=K("open-output-bytevector",[],(function(){return M.Port("bytevector",[],"w",null,[])})),bt=K("get-output-bytevector",[{name:"port"}],(function(r){var e,n=r.port;if(q.Port(n),"bytevector"!==n[1]||null===(e=n[3])||void 0===e||!e.includes("w"))throw M.Error("read-error","Not a port created by open-output-string.");return M.ByteVector(u(n[2]),!1)})),yt=K("read-char",[{name:"port",type:"optional"}],(function(r,e,n){var t,a=r.port;if(U(e),U(n),a||(a=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(a),null===(t=a[3])||void 0===t||!t.includes("r"))throw M.Error("read-error","Port is not open.");if("string"!=typeof a[5])throw M.Error("read-error","Not a text port.");var o=void 0;if(a[5].length>0)o=a[5][0],a[5]=a[5].slice(1);else if("built-in"===a[1]){var i,u=null==e?void 0:e.getBuiltInPort(a[2]);o=null==u||null===(i=u.read)||void 0===i?void 0:i.call(u,"character",null)}else if("string"===a[1])a[2].length>0?(o=a[2][0],a[2]=a[2].slice(1)):o=null;else{if("file"!==a[1])throw M.Error("program-error","Illegal type of port.");if(null==e||!e.fs)throw M.Error("read-error","No Interpreter or fs object.");for(var c=Buffer.alloc(4),l=0;;l++){if(!e.fs.readSync(a[2],c,{length:1,offset:l})){o=null;break}var f=c.toString("utf8",0,l+1);if(!f.includes("�")){o=f;break}if(l>=4)throw M.Error("read-error","Not a valid text(UTF-8) file.")}}if(null===o)return M.EndOfFile();if(void 0===o)throw M.Error("read-error",null);if("string"!=typeof o)throw M.Error("read-error","Read-data is not a expected format (number).");return M.Character(o)})),gt=K("peek-char",[{name:"port",type:"optional"}],(function(r,e,n){var t=r.port;U(e),U(n),t||(t=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(t);var a=yt.body({port:t},e,n);return D.EndOfFile(a)||(t[5]="string"==typeof t[5]?a[1]+t[5]:a[1]),a})),ht=K("read-line",[{name:"port",type:"optional"}],(function(r,e,n){var t=r.port;U(e),U(n),t||(t=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(t);for(var a="";;){var o=yt.body({port:t},e,n);if(D.EndOfFile(o))return""===a?o:M.String(a,!1);if("\n"===o[1])return M.String(a,!1);a+=o[1]}})),wt=K("eof-object?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.EndOfFile(e))})),jt=K("eof-object",[],(function(){return M.EndOfFile()})),St=K("char-ready?",[{name:"port",type:"optional"}],(function(r,e,n){var t,a=r.port;if(U(e),U(n),a||(a=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(a),null===(t=a[3])||void 0===t||!t.includes("r"))return M.Boolean(!1);if("built-in"===a[1]){var o;if(!e)throw M.Error("program-error","No interpreter object.");var i=e.getBuiltInPort(a[2]);if(!i)throw M.Error("program-error","Illegal built-in file object.");return M.Boolean(!(null===(o=i.ready)||void 0===o||!o.call(i)))}if("string"===a[1])return M.Boolean(!0);if("bytevector"===a[1])return M.Boolean(!1);throw"file"===a[1]?M.Error("program-error",'"Node.js file "ready" method is not implemented."'):M.Error("program-error",'Unknown port type "'.concat(a[1],'"'))})),xt=K("read-string",[{name:"k"},{name:"port",type:"optional"}],(function(r,e,n){var t=r.k,a=r.port;q.IntegerNumber(t),U(e),U(n),a||(a=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(a);for(var o="";;){var i=yt.body({port:a},e,n);if(D.EndOfFile(i))return 0===o.length?i:M.String(o,!1);if((o+=i[1]).length>=t[1])return M.String(o,!1)}})),Nt=K("read-u8",[{name:"port",type:"optional"}],(function(r,e,n){var t,a=r.port;if(U(e),U(n),a||(a=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(a),null===(t=a[3])||void 0===t||!t.includes("r"))throw M.Error("read-error","Port is not open.");if("string"==typeof a[5])throw M.Error("read-error","Not a binary port.");var o=void 0;if(a[5].length>0)o=a[5][0],a[5]=a[5].slice(1);else if("built-in"===a[1]){var i,u=null==e?void 0:e.getBuiltInPort(a[2]);o=null==u||null===(i=u.read)||void 0===i?void 0:i.call(u,"byte",null)}else if("bytevector"===a[1])a[2].length>0?(o=a[2][0],a[2]=a[2].slice(1)):o=null;else{if("file"!==a[1])throw M.Error("program-error","Illegal type of port.");if(null==e||!e.fs)throw M.Error("read-error","No Interpreter or fs object.");var c=Buffer.alloc(1);o=e.fs.readSync(a[2],c)?c[0]:null}if(null===o)return M.EndOfFile();if(void 0===o)throw M.Error("read-error",null);if("number"!=typeof o)throw M.Error("read-error","Read-data is not a expected format (string).");return M.Number(o)})),Et=K("peek-u8",[{name:"port",type:"optional"}],(function(r,e,n){var t=r.port;U(e),U(n),t||(t=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(t);var a=Nt.body({port:t},e,n);return D.EndOfFile(a)||(t[5]="string"!=typeof t[5]?[a[1]].concat(u(t[5])):[a[1]]),a})),Pt=K("u8-ready?",[{name:"port",type:"optional"}],(function(r,e,n){var t,a=r.port;if(U(e),U(n),a||(a=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(a),null===(t=a[3])||void 0===t||!t.includes("r"))return M.Boolean(!1);if("built-in"===a[1]){var o;if(!e)throw M.Error("program-error","No interpreter object.");var i=e.getBuiltInPort(a[2]);if(!i)throw M.Error("program-error","Illegal built-in file object.");return M.Boolean(!(null===(o=i.ready)||void 0===o||!o.call(i)))}if("string"===a[1])return M.Boolean(!1);if("bytevector"===a[1])return M.Boolean(!0);if("file"===a[1]){if(null==e||!e.fs)throw M.Error("read-error","No Interpreter or fs object.");throw M.Error("program-error",'"Node.js file "ready" method is not implemented."')}throw M.Error("program-error",'Unknown port type "'.concat(a[1],'"'))})),It=K("read-bytevector",[{name:"k"},{name:"port",type:"optional"}],(function(r,e,n){var t=r.k,a=r.port;q.IntegerNumber(t),U(e),U(n),a||(a=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(a);for(var o=[];;){var i=Nt.body({port:a},e,n);if(D.EndOfFile(i))return 0===o.length?i:M.ByteVector(o,!1);if(o.push(i[1]),o.length>=t[1])return M.ByteVector(o,!1)}})),Ot=K("read-bytevector!",[{name:"bvec"},{name:"port",type:"optional"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r,e,n){var t=r.bvec,a=r.port,o=r.start,i=r.end;q.ByteVector(t),U(e),U(n);var u=D.Number(o)?o[1]:0,c=D.Number(i)?i[1]:t[1].length;if("number"!=typeof u||!Number.isInteger(u)||"number"!=typeof c||!Number.isInteger(c))throw M.Error("domain-error","Index must be integer.");var l=c-u,f=It.body({k:M.Number(l),port:a},e,n);if(D.EndOfFile(f))return f;for(var s=0;s<f[1].length;s++)t[1][u+s]=f[1][s];return M.Number(f[1].length)})),Bt=K("newline",[{name:"port",type:"optional"}],(function(r,e,n){var t=r.port;return At.body({str:M.String("\n",!1),port:t,start:null,end:null},e,n)})),Ct=K("write-char",[{name:"char"},{name:"port",type:"optional"}],(function(r,e,n){var t=r.char,a=r.port;return q.Character(t),At.body({str:M.String(t[1],!1),port:a,start:null,end:null},e,n)})),At=K("write-string",[{name:"str"},{name:"port",type:"optional"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r,e,n){var t,a=r.str,o=r.port,i=r.start,u=r.end;q.String(a),U(e),U(n);var c=D.Number(i)?i[1]:0,l=D.Number(u)?u[1]:a[1].length;if("number"!=typeof c||!Number.isInteger(c)||"number"!=typeof l||!Number.isInteger(l))throw M.Error("domain-error","Index must be integer.");var f=a[1].slice(c,l);if(o||(o=e.getDynamic(k(n).env.dynamic,"current-output-port")),q.Port(o),null===(t=o[3])||void 0===t||!t.includes("w"))throw M.Error("write-error","Port is not open for writing.");if("string"!=typeof o[5])throw M.Error("write-error","Not a text port.");if("built-in"===o[1]){if(!e)throw M.Error("program-error","No interpreter object.");var s=e.getBuiltInPort(o[2]);if(!s||!s.write)throw M.Error("program-error","No built-in method defined to write.");s.write(f)}else if("string"===o[1])o[2]=o[2]+f;else{if("file"!==o[1])throw M.Error("program-error","Illegal type of port for writing.");if(null==e||!e.fs)throw M.Error("write-error","No Interpreter or fs object.");e.fs.writeSync(o[2],f)}return["<undefined>"]})),kt=K("write-u8",[{name:"byte"},{name:"port",type:"optional"}],(function(r,e,n){var t=r.byte,a=r.port;return q.IntegerNumber(t),zt.body({bvec:M.ByteVector([t[1]],!1),port:a},e,n)})),zt=K("write-bytevector",[{name:"bvec"},{name:"port",type:"optional"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r,e,n){var t,a=r.bvec,o=r.port,i=r.start,c=r.end;q.ByteVector(a),U(e),U(n);var l=D.Number(i)?i[1]:0,f=D.Number(c)?c[1]:a[1].length;if("number"!=typeof l||!Number.isInteger(l)||"number"!=typeof f||!Number.isInteger(f))throw M.Error("domain-error","Index must be integer.");var s=a[1].slice(l,f);if(o||(o=e.getDynamic(k(n).env.dynamic,"current-output-port")),q.Port(o),null===(t=o[3])||void 0===t||!t.includes("w"))throw M.Error("write-error","Port is not open for writing.");if("string"==typeof o[5])throw M.Error("write-error","Not a binary port.");if("built-in"===o[1]){if(!e)throw M.Error("program-error","No interpreter object.");var m=e.getBuiltInPort(o[2]);if(!m||!m.write)throw M.Error("program-error","No built-in method defined to write.");m.write(new Uint8Array(s))}else if("bytevector"===o[1]){var p;(p=o[2]).push.apply(p,u(s))}else{if("file"!==o[1])throw M.Error("program-error","Illegal type of port for writing.");if(null==e||!e.fs)throw M.Error("write-error","No Interpreter or fs object.");e.fs.writeSync(o[2],new Uint8Array(s))}return["<undefined>"]})),Lt=K("flush-output-port",[{name:"port",type:"optional"}],(function(r,e,n){var t,a=r.port;if(U(e),U(n),a||(a=e.getDynamic(k(n).env.dynamic,"current-output-port")),q.Port(a),null===(t=a[3])||void 0===t||!t.includes("w"))throw M.Error("write-error","Port is not open for writing.");if("built-in"===a[1]){var o;if(!e)throw M.Error("program-error","No interpreter object.");var i=e.getBuiltInPort(a[2]);if(!i)throw M.Error("program-error","No built-in method defined to write.");null===(o=i.flush)||void 0===o||o.call(i)}else if("file"===a[1]){if(null==e||!e.fs)throw M.Error("write-error","No Interpreter or fs object.");e.fs.fsyncSync(a[2])}return["<undefined>"]})),Vt={callWithPort:rt,inputPortQ:et,outputPortQ:nt,textualPortQ:tt,binaryPortQ:at,portQ:ot,inputPortOpenQ:it,outputPortOpenQ:ut,closePort:ct,closeInputPort:lt,closeOutputPort:ft,openInputString:st,openOutputString:mt,getOutputString:pt,openInputBytevector:vt,openOutputBytevector:dt,getOutputBytevector:bt,readChar:yt,peekChar:gt,readLine:ht,eofObjectQ:wt,eofObject:jt,charReadyQ:St,readString:xt,readU8:Nt,peekU8:Et,u8ReadyQ:Pt,readBytevector:It,readBytevectorD:Ot,newline:Bt,writeChar:Ct,writeString:At,writeU8:kt,writeBytevector:zt,flushOutputPort:Lt},Mt={stringQ:K("string?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.String(e))})),makeString:K("make-string",[{name:"k"},{name:"char",type:"optional"}],(function(r){var e=r.k,n=r.char;return q.IntegerNumber(e),n&&q.Character(n),M.String((n?n[1]:" ").repeat(e[1]),!1)})),string:K("string",[{name:"chars",type:"variadic"}],(function(r){var e=r.chars;return q.Characters(e),M.String(e.map((function(r){return r[1]})).join(""),!1)})),stringLength:K("string-length",[{name:"str"}],(function(r){var e=r.str;return q.String(e),M.Number(e[1].length)})),stringRef:K("string-ref",[{name:"str"},{name:"k"}],(function(r){var e=r.str,n=r.k;q.String(e),q.IntegerNumber(n);var t=e[1][n[1]];if(!t)throw M.Error("out-of-range","The specified string doesn't have character with index ".concat(n[1],"."));return M.Character(t)})),stringSetD:K("string-set!",[{name:"str"},{name:"k"},{name:"char"}],(function(r){var e=r.str,n=r.k,t=r.char;return q.String(e),q.IntegerNumber(n),q.Character(t),e[1]=e[1].slice(0,n[1])+t[1]+e[1].slice(n[1]+t[1].length),["<undefined>"]})),stringEQ:K("string=?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,n=r.str2,t=r.strs;return q.String(e),q.String(n),q.Strings(t),M.Boolean([n].concat(u(t)).every((function(r){return r[1]===e[1]})))})),stringLtQ:K("string<?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,n=r.str2,t=r.strs;q.String(e),q.String(n),q.Strings(t);var a=[e,n].concat(u(t)).map((function(r){return r[1]}));return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]<r})))})),stringGtQ:K("string>?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,n=r.str2,t=r.strs;q.String(e),q.String(n),q.Strings(t);var a=[e,n].concat(u(t)).map((function(r){return r[1]}));return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]>r})))})),stringLeQ:K("string<=?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,n=r.str2,t=r.strs;q.String(e),q.String(n),q.Strings(t);var a=[e,n].concat(u(t)).map((function(r){return r[1]}));return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]<=r})))})),stringGeQ:K("string>=?",[{name:"str1"},{name:"str2"},{name:"strs",type:"variadic"}],(function(r){var e=r.str1,n=r.str2,t=r.strs;q.String(e),q.String(n),q.Strings(t);var a=[e,n].concat(u(t)).map((function(r){return r[1]}));return M.Boolean(a.every((function(r,e){return 0===e||a[e-1]>=r})))})),substring:K("substring",[{name:"str"},{name:"start"},{name:"end"}],(function(r){var e=r.str,n=r.start,t=r.end;return q.String(e),q.IntegerNumber(n),q.IntegerNumber(t),0===e[1].length?M.String("",!1):M.String(e[1].slice(n[1],t[1]),!1)})),stringAppend:K("string-append",[{name:"strs",type:"variadic"}],(function(r){var e=r.strs;return q.Strings(e),M.String(e.map((function(r){return r[1]})).join(""),!1)})),stringToList:K("string->list",[{name:"str"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,n=r.start,t=r.end;q.String(e);var a=e[1],o=D.Number(n)?n[1]:0,i=D.Number(t)?t[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw M.Error("domain-error","Index must be integer.");return M.List.apply(M,u(a.slice(o,i).split("").map((function(r){return M.Character(r)}))))})),listToString:K("list->string",[{name:"list"}],(function(r){var e=r.list;q.List(e);var n=$(e);return q.Characters(n),M.String(n.map((function(r){return r[1]})).join(""),!1)})),stringCopy:K("string-copy",[{name:"str"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,n=r.start,t=r.end;q.String(e);var a=e[1],o=D.Number(n)?n[1]:0,i=D.Number(t)?t[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw M.Error("domain-error","Index must be integer.");return M.String(a.slice(o,i),!1)})),stringCopyD:K("string-copy!",[{name:"to"},{name:"at"},{name:"from"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.to,n=r.at,t=r.from,a=r.start,o=r.end;q.String(e),q.IntegerNumber(n),q.String(t);var i=t[1],u=D.Number(a)?a[1]:0,c=D.Number(o)?o[1]:i.length;if("number"!=typeof u||!Number.isInteger(u)||"number"!=typeof c||!Number.isInteger(c))throw M.Error("domain-error","Index must be integer.");if(n[1]<0||n[1]>=i.length)throw M.Error("out-of-range","Index is out of range.");if(i.length-n[1]<c-u)throw M.Error("out-of-range","Index is out of range.");var l=i.slice(u,c);return e[1]=e[1].slice(0,n[1])+l+e[1].slice(n[1]+l.length),["<undefined>"]})),stringFillD:K("string-fill!",[{name:"str"},{name:"fill"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,n=r.fill,t=r.start,a=r.end;q.String(e),q.Character(n);var o=e[1],i=D.Number(t)?t[1]:0,u=D.Number(a)?a[1]:o.length;if("number"!=typeof i||!Number.isInteger(i)||"number"!=typeof u||!Number.isInteger(u))throw M.Error("domain-error","Index must be integer.");var c=o.slice(i,u);return e[1]=e[1].slice(0,i)+n[1].repeat(c.length)+e[1].slice(u),e}))},Tt={Import:K("import",[{name:"sets",type:"variadic",evaluate:!1}],(function(r,e,n){var t,a=r.sets;if(q.Objects(a),U(e),U(n),!(k(n).depth<=(null!==(t=e.getOptions().toplevelDepth)&&void 0!==t?t:1)))throw M.Error("not-implemented",'"import" is only supported on the toplevel.');var o=a.map((function(r){return N(r)}));if(o.some((function(r){return["(only ","(except ","(prefix ","(rename "].some((function(e){return 0===r.indexOf(e)}))})))throw M.Error("not-implemented",'"import" with "only", "except", "prefix", or "rename" is not supported yet.');var i,u=p(o);try{for(u.s();!(i=u.n()).done;){var c=i.value;if("(scheme base)"!==c){var l=e.getBuiltInLibrary(c);if(!l)throw M.Error("error",'Library "'.concat(l,' not found."'));for(var f=l(e),s=0,m=Object.keys(f);s<m.length;s++){var v=m[s];e.defineStatic(k(n).env.static,M.Symbol(v),f[v])}}}}catch(r){u.e(r)}finally{u.f()}return["<undefined>"]}),!0),define:K("define",[{name:"arg1",evaluate:!1},{name:"arg2",type:"variadic",evaluate:!1}],(function(r,e,n){var t,a=r.arg1,i=r.arg2;q.Object(a),q.Objects(i),U(e),U(n);var c,l=k(n).depth<=(null!==(t=e.getOptions().toplevelDepth)&&void 0!==t?t:1);if(D.Symbol(a)){var f,s=a,m=o(i,1)[0];if(!l&&!D.Undefined(null!==(f=B(k(n).env.static)[s[1]])&&void 0!==f?f:["<undefined>"]))throw M.Error("redefine-variable",null);return e.defineStatic(k(n).env.static,s,["<undefined>"]),T.Set(s,m)}q.Pair(a);var p=o(a,3),v=p[1],d=p[2],b=i;if(q.Symbol(v),q.List(d),!l&&!D.Undefined(null!==(c=B(k(n).env.static)[v[1]])&&void 0!==c?c:["<undefined>"]))throw M.Error("redefine-variable",null);var y=o(H(d),2),g=y[0],h=y[1];return e.defineStatic(k(n).env.static,v,M.Procedure("lambda",h?[].concat(u(g),[h]):g,T.BeginIfMultiple.apply(T,u(b)),!1,k(n).env)),["<undefined>"]}),!0),defineValues:K("define-values",[{name:"formals",evaluate:!1},{name:"expr"}],(function(r,e,n){var t,a=r.formals,i=r.expr;q.Object(a),q.Object(i),U(e),U(n);for(var c=k(n).depth<=(null!==(t=e.getOptions().toplevelDepth)&&void 0!==t?t:1),l=o(H(a),2),f=l[0],s=l[1],m=D.MultiValue(i)?i[1]:[i],p=0;p<f.length;p++){var v;if(!m[p])throw M.Error("arity-error",null);if(!c&&!D.Undefined(null!==(v=B(k(n).env.static)[f[p].name])&&void 0!==v?v:["<undefined>"]))throw M.Error("redefine-variable",null);e.defineStatic(k(n).env.static,M.Symbol(f[p].name),m[p])}return s&&e.defineStatic(k(n).env.static,M.Symbol(s.name),M.List.apply(M,u(m.slice(f.length)))),["<undefined>"]})),defineSyntax:K("define-syntax",[{name:"keyword",evaluate:!1},{name:"spec"}],(function(r,e,n){var t,a,o=r.keyword,i=r.spec;if(q.Symbol(o),q.SyntaxRules(i),U(e),U(n),!(k(n).depth<=(null!==(t=e.getOptions().toplevelDepth)&&void 0!==t?t:1))&&!D.Undefined(null!==(a=B(k(n).env.static)[o[1]])&&void 0!==a?a:["<undefined>"]))throw M.Error("redefine-variable",null);var u=M.Procedure("lambda",[{name:"exprs",type:"variadic",evaluate:!1}],T.CallBuiltIn("use-syntax-rules",i,M.Symbol("exprs")),!0,k(n).env);return e.defineStatic(k(n).env.static,o,u),["<undefined>"]})),defineRecordType:K("define-record-type",[{name:"name",evaluate:!1},{name:"ctor",evaluate:!1},{name:"pred",evaluate:!1},{name:"fields",evaluate:!1,type:"variadic"}],(function(r,e,n){var t,a,c,l=r.name,f=r.ctor,s=r.pred,m=r.fields;q.Symbol(l),q.Pair(f),q.Symbol(s),q.Pairs(m),U(e),U(n);var v=k(n).depth<=(null!==(t=e.getOptions().toplevelDepth)&&void 0!==t?t:1);if(!(v||D.Undefined(null!==(a=B(k(n).env.static)[l[1]])&&void 0!==a?a:["<undefined>"])&&D.Undefined(null!==(c=B(k(n).env.static)[s[1]])&&void 0!==c?c:["<undefined>"])))throw M.Error("redefine-variable",null);var d=k(n).env,b=M.RecordType(l[1]),y=i($(f)),g=y[0],h=y.slice(1);q.Symbol(g),q.Symbols(h);var w=M.Symbol("rec");e.defineStatic(k(n).env.static,g,M.Procedure("lambda",h.map((function(r){return{name:r[1]}})),T.BeginIfMultiple.apply(T,[T.Define(w,T.CallBuiltIn("make-record",b))].concat(u(h.map((function(r){return T.CallBuiltIn("record-set!",w,r,r)}))),[w])),!1,d));var j=M.Symbol("rec");e.defineStatic(k(n).env.static,s,M.Procedure("lambda",[{name:j[1]}],T.CallBuiltIn("record-type?",j,b),!1,d));var S,x=p(m);try{var N=function(){var r,t=S.value,a=o($(t),3),i=a[0],u=a[1],c=a[2];if(q.Symbol(i),q.Symbol(u),!h.some((function(r){return r[1]===i[1]})))throw M.Error("domain-error","Unknown field name");if(!v&&!D.Undefined(null!==(r=B(k(n).env.static)[u[1]])&&void 0!==r?r:["<undefined>"]))throw M.Error("redefine-variable",null);var l=M.Symbol("rec");if(e.defineStatic(k(n).env.static,u,M.Procedure("lambda",[{name:l[1]}],T.CallBuiltIn("record-get",l,i),!1,d)),c){var f;if(q.Symbol(c),!v&&!D.Undefined(null!==(f=B(k(n).env.static)[c[1]])&&void 0!==f?f:["<undefined>"]))throw M.Error("redefine-variable",null);var s=M.Symbol("rec"),m=M.Symbol("value");e.defineStatic(k(n).env.static,c,M.Procedure("lambda",[{name:s[1]},{name:m[1]}],T.CallBuiltIn("record-set!",s,i,m),!1,d))}};for(x.s();!(S=x.n()).done;)N()}catch(r){x.e(r)}finally{x.f()}return["<undefined>"]})),makeRecord:K("make-record",[{name:"type"}],(function(r){var e=r.type;return q.RecordType(e),M.Record(e,{})}),!1,!0),recordTypeQ:K("record-type?",[{name:"rec"},{name:"type"}],(function(r){var e=r.rec,n=r.type;return q.Object(e),q.RecordType(n),D.Record(e)?Xr.body({obj1:e[1],obj2:n}):M.Boolean(!1)}),!1,!0),recordGet:K("record-get",[{name:"rec"},{name:"field",evaluate:!1}],(function(r){var e,n=r.rec,t=r.field;return q.Record(n),q.Symbol(t),null!==(e=n[2][t[1]])&&void 0!==e?e:["<undefined>"]}),!1,!0),recordSetD:K("record-set!",[{name:"rec"},{name:"field",evaluate:!1},{name:"value"}],(function(r){var e=r.rec,n=r.field,t=r.value;if(q.Record(e),q.Symbol(n),q.Object(t),D.Undefined(t))throw M.Error("undefined-value","Attempt to set an undefined value.");return e[2][n[1]]=t,["<undefined>"]}),!1,!0)},Dt={symbolQ:K("symbol?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Symbol(e))})),symbolEQ:K("symbol=?",[{name:"symbol1"},{name:"symbol2"},{name:"symbols",type:"variadic"}],(function(r){var e=r.symbol1,n=r.symbol2,t=r.symbols;return q.Symbol(e),q.Symbol(n),q.Symbols(t),M.Boolean([n].concat(u(t)).every((function(r){return r[1]===e[1]})))})),symbolToString:K("symbol->string",[{name:"obj"}],(function(r){var e=r.obj;return q.Symbol(e),M.String(e[1],!0)})),stringToSymbol:K("string->symbol",[{name:"obj"}],(function(r){var e=r.obj;return q.String(e),M.Symbol(e[1])}))},Qt={vectorQ:K("vector?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Vector(e))})),makeVector:K("make-vector",[{name:"k"},{name:"fill",type:"optional"}],(function(r){var e=r.k,n=r.fill;return q.IntegerNumber(e),n&&q.Object(n),M.Vector(Array(e[1]).fill(n||["<undefined>"]),!1)})),vector:K("vector",[{name:"objs",type:"variadic"}],(function(r){var e=r.objs;return q.Objects(e),M.Vector(e,!1)})),vectorLength:K("vector-length",[{name:"vec"}],(function(r){var e=r.vec;return q.Vector(e),M.Number(e[1].length)})),vectorRef:K("vector-ref",[{name:"vec"},{name:"k"}],(function(r){var e=r.vec,n=r.k;if(q.Vector(e),q.IntegerNumber(n),!(n[1]in e[1]))throw M.Error("out-of-range","Index is out of range.");return e[1][n[1]]})),vectorSetD:K("vector-set!",[{name:"vec"},{name:"k"},{name:"obj"}],(function(r){var e=r.vec,n=r.k,t=r.obj;if(q.Vector(e),q.IntegerNumber(n),q.Object(t),!(n[1]in e[1]))throw M.Error("out-of-range","Index is out of range.");if(D.Undefined(t))throw M.Error("undefined-value","Attempt to set a undefined value to vector.");return e[1][n[1]]=t,["<undefined>"]})),vector2list:K("vector->list",[{name:"vec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.vec,n=r.start,t=r.end;q.Vector(e);var a=e[1],o=D.Number(n)?n[1]:0,i=D.Number(t)?t[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw M.Error("domain-error","Index must be integer.");return M.List.apply(M,u(a.slice(o,i)))})),list2vector:K("list->vector",[{name:"list"}],(function(r){var e=r.list;return q.List(e),M.Vector($(e),!1)})),vector2string:K("vector->string",[{name:"vec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.vec,n=r.start,t=r.end;q.Vector(e);var a=e[1],o=D.Number(n)?n[1]:0,i=D.Number(t)?t[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw M.Error("domain-error","Index must be integer.");return M.String(a.slice(o,i).map((function(r){return q.Character(r),r[1]})).join(""),!1)})),string2vector:K("string->vector",[{name:"str"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.str,n=r.start,t=r.end;q.String(e);var a=e[1],o=D.Number(n)?n[1]:0,i=D.Number(t)?t[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw M.Error("domain-error","Index must be integer.");return M.Vector(a.slice(o,i).split("").map((function(r){return M.Character(r)})),!1)})),vectorCopy:K("vector-copy",[{name:"vec"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.vec,n=r.start,t=r.end;q.Vector(e);var a=e[1];if(0===a.length)return M.Vector([],!1);var o=D.Number(n)?n[1]:0,i=D.Number(t)?t[1]:a.length;if("number"!=typeof o||!Number.isInteger(o)||"number"!=typeof i||!Number.isInteger(i))throw M.Error("domain-error","Index must be integer.");return M.Vector(a.slice(o,i),!1)})),vectorCopyD:K("vector-copy!",[{name:"to"},{name:"at"},{name:"from"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e,n=r.to,t=r.at,a=r.from,o=r.start,i=r.end;q.Vector(n),q.IntegerNumber(t),q.Vector(a);var c=D.Number(o)?o[1]:0,l=D.Number(i)?i[1]:a[1].length;if("number"!=typeof c||!Number.isInteger(c)||"number"!=typeof l||!Number.isInteger(l))throw M.Error("domain-error","Index must be integer.");if(!(t[1]in n[1]))throw M.Error("out-of-range","Index is out of range.");if(n[1].length-t[1]<l-c)throw M.Error("out-of-range","Index is out of range.");var f=a[1].slice(c,l);return(e=n[1]).splice.apply(e,[t[1],f.length].concat(u(f))),["<undefined>"]})),vectorAppend:K("vector-append",[{name:"vecs",type:"variadic"}],(function(r){var e=r.vecs;return q.Vectors(e),M.Vector(e.map((function(r){return r[1]})).flat(),!1)})),vectorFillD:K("vector-fill!",[{name:"vec"},{name:"fill"},{name:"start",type:"optional"},{name:"end",type:"optional"}],(function(r){var e=r.vec,n=r.fill,t=r.start,a=r.end;if(q.Vector(e),q.Object(n),D.Undefined(n))throw M.Error("undefined-value","Attempt to fill vector with an undefined value.");var o=e[1],i=D.Number(t)?t[1]:0,u=D.Number(a)?a[1]:o.length;if("number"!=typeof i||!Number.isInteger(i)||"number"!=typeof u||!Number.isInteger(u))throw M.Error("domain-error","Index must be integer.");for(var c=i;c<u;c++)c in o&&(o[c]=n);return e}))},Rt={features:K("features",[],(function(){return M.List(M.Symbol("r7rs"),M.Symbol(y),M.Symbol(y+"-0.5.5"))}))},qt={suspend:K("suspend",[{name:"obj",type:"optional"}],(function(r,e,n){var t=r.obj;throw U(n),t&&q.Object(t),M.Suspend(M.Continuation(C(n)),null!=t?t:M.Undefined())}))},Ut=[K("write",[{name:"obj"},{name:"port",type:"optional"}],(function(r){var e,n=r.obj,t=r.port;q.Object(n),t&&q.Object(t);try{e=j(S([x(n)]))}catch(r){if(r instanceof Error)throw M.Error("write-error",r.message);throw r}return t?T.CallBuiltIn("write-string",M.String(e,!1),t):T.CallBuiltIn("write-string",M.String(e,!1))}),!0,!0),K("write-shared",[{name:"obj"},{name:"port",type:"optional"}],(function(r){var e,n=r.obj,t=r.port;q.Object(n),t&&q.Object(t);try{e=j(S([x(n,{labels:"shared"})]))}catch(r){if(r instanceof Error)throw M.Error("write-error",r.message);throw r}return t?T.CallBuiltIn("write-string",M.String(e,!1),t):T.CallBuiltIn("write-string",M.String(e,!1))}),!0,!0),K("write-simple",[{name:"obj"},{name:"port",type:"optional"}],(function(r){var e,n=r.obj,t=r.port;q.Object(n),t&&q.Object(t);try{e=j(S([x(n,{labels:"simple"})]))}catch(r){if(r instanceof Error)throw M.Error("write-error",r.message);throw r}return t?T.CallBuiltIn("write-string",M.String(e,!1),t):T.CallBuiltIn("write-string",M.String(e,!1))}),!0,!0),K("display",[{name:"obj"},{name:"port",type:"optional"}],(function(r){var e,n=r.obj,t=r.port;q.Object(n),t&&q.Object(t);try{e=j(S([x(n,{style:"display"})]))}catch(r){if(r instanceof Error)throw M.Error("write-error",r.message);throw r}return t?T.CallBuiltIn("write-string",M.String(e,!1),t):T.CallBuiltIn("write-string",M.String(e,!1))}),!0,!0)],Jt=[K("read",[{name:"port",type:"optional"}],(function(r,e,n){var t=r.port;if(U(e),U(n),t||(t=e.getDynamic(k(n).env.dynamic,"current-input-port")),q.Port(t),"string"!=typeof t[5])throw M.Error("read-error","Not a text port.");for(var a,u,c="";;){var l=yt.body({port:t},e,n);if(D.EndOfFile(l))break;c+=l[1]}try{var f=ar(c),s=o(or(f),2);a=s[0],u=s[1]}catch(r){throw r instanceof Error?M.Error("read-error",r.message):M.Error("read-error","Error occured while reading.")}if(0===a.length){if(u.length>0)throw M.Error("read-error","The external representation is incomplete and therefore not parsable,");return M.EndOfFile()}var m=i(a),p=m[0],v=m.slice(1),d=ir(p,null,{removeLineInfo:!0}),b=S(v),y=j(b);return t[5]=y+t[5],d}),!1,!0)],Ft=K("delay",[{name:"expr",evaluate:!1}],(function(r,e,n){var t=r.expr;q.Object(t),U(n);var a=M.Procedure("lambda",[],t,!1,k(n).env);return M.Promise(a,null)}),!1,!0),$t=K("delay-force",[{name:"expr",evaluate:!1}],(function(r,e,n){var t=r.expr;q.Object(t),U(n);var a=M.Procedure("lambda",[],t,!1,k(n).env),o=M.Promise(a,null);return T.CallBuiltIn("force",o)}),!0,!0),Zt=K("force",[{name:"promise"}],(function(r){var e=r.promise;if(q.Object(e),D.Promise(e)){if(e[2])return T.Quote(e[2]);var n=e[1];if(!n)throw M.Error("error","Illegal promise.");return T.CallBuiltIn("force-1",e,T.Call(n))}return T.Quote(e)}),!0,!0),_t=K("force-1",[{name:"promise"},{name:"obj"}],(function(r){var e=r.promise,n=r.obj;return q.Promise(e),q.Object(n),e[2]=n,n}),!1,!0),Xt=[Ft,$t,Zt,K("promise?",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Boolean(D.Promise(e))}),!1,!0),K("make-promise",[{name:"obj"}],(function(r){var e=r.obj;return q.Object(e),M.Promise(null,e)}),!1,!0)],Kt=[_t],Wt=[K("current-second",[],(function(){return M.Number(Date.now()/1e3)}),!1,!0),K("current-jiffy",[],(function(){var r=Function("return this")();return M.Number(Math.round(r.performance?performance.now():Date.now()))}),!1,!0),K("jiffies-per-second",[],(function(){return M.Number(1e3)}),!1,!0)],Gt=[K("finite?",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return M.Boolean(Number.isFinite(n))})),K("infinite?",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return M.Boolean(!Number.isNaN(n)&&!Number.isFinite(n))})),K("exp",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return I(Math.exp(n))})),K("log",[{name:"z1"},{name:"z2",type:"optional"}],(function(r){var e=r.z1,n=r.z2;q.Number(e);var t=P(e);if(n){q.Number(n);var a=P(n);return I(Math.log(t)/Math.log(a))}return I(Math.log(t))})),K("sin",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return I(Math.sin(n))})),K("cos",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return I(Math.cos(n))})),K("tan",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return I(Math.tan(n))})),K("asin",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return I(Math.asin(n))})),K("acos",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return I(Math.acos(n))})),K("atan",[{name:"z1"},{name:"z2",type:"optional"}],(function(r){var e=r.z1,n=r.z2;q.Number(e);var t=P(e);if(n){q.Number(n);var a=P(n);return I(Math.atan2(t,a))}return I(Math.atan(t))})),K("sqrt",[{name:"z"}],(function(r){var e=r.z;q.Number(e);var n=P(e);return I(Math.sqrt(n))}))],Ht=[].concat(u(Object.values(mr)),u(Object.values(Nr)),u(Object.values(zr)),u(Object.values(_r)),u(Object.values(Gr)),u(Object.values(ue)),u(Object.values(De)),u(Object.values(pn)),u(Object.values(Yn)),u(Object.values(Vt)),u(Object.values(Mt)),u(Object.values(Tt)),u(Object.values(Dt)),u(Object.values(Qt)),u(Object.values(Rt)),u(Object.values(qt))),Yt={"(scheme write)":function(r){Ut.forEach((function(e){return r.setBuiltInProcedure(e)}));var e={};return Ut.forEach((function(r){var n=r.name;return e[n]=M.Procedure("built-in",n)})),e},"(scheme read)":function(r){Jt.forEach((function(e){return r.setBuiltInProcedure(e)}));var e={};return Jt.forEach((function(r){var n=r.name;return e[n]=M.Procedure("built-in",n)})),e},"(scheme lazy)":function(r){[].concat(Xt,Kt).forEach((function(e){return r.setBuiltInProcedure(e)}));var e={};return Xt.forEach((function(r){var n=r.name;return e[n]=M.Procedure("built-in",n)})),e},"(scheme time)":function(r){[].concat(Wt).forEach((function(e){return r.setBuiltInProcedure(e)}));var e={};return Wt.forEach((function(r){var n=r.name;return e[n]=M.Procedure("built-in",n)})),e},"(scheme inexact)":function(r){[].concat(Gt).forEach((function(e){return r.setBuiltInProcedure(e)}));var e={};return Gt.forEach((function(r){var n=r.name;return e[n]=M.Procedure("built-in",n)})),e}},ra=[],ea=console,na=function(){function r(e){var n,t,i=this;!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),a(this,"builtins",{jsObject:{},procedure:{},port:{"//input":{},"//output":{write:function(r){return ea.log(r)}},"//error":{write:function(r){return ea.warn(r)}}},static:{"current-input-port":M.Parameter("current-input-port",null),"current-output-port":M.Parameter("current-output-port",null),"current-error-port":M.Parameter("current-error-port",null)},dynamic:{"current-input-port":M.Port("built-in","//input","r",null,""),"current-output-port":M.Port("built-in","//output","w",null,""),"current-error-port":M.Port("built-in","//error","w",null,"")},library:{}}),a(this,"fs",null),this.options=null!=e?e:{},this.fs=null!==(n=null==e?void 0:e.fs)&&void 0!==n?n:null,ra.forEach((function(r){var e=o(r,2),n=e[0],t=e[1];return i.setBuiltInJSObject(n,t)})),Ht.forEach((function(r){return i.setBuiltInProcedure(r)})),Object.keys(Yt).forEach((function(r){return i.setBuiltInLibrary(r,Yt[r])})),null==e||null===(t=e.plugins)||void 0===t||t.forEach((function(r){return r(i)}))}var i,c,l;return i=r,(c=[{key:"getOptions",value:function(){return this.options}},{key:"setBuiltInProcedure",value:function(r){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=M.Procedure("built-in",r.name);return!e&&this.getProcedureContent(n)||(this.builtins.procedure[r.name]=r),n}},{key:"setBuiltInJSObject",value:function(r,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=M.JS("built-in",r);return!n&&this.getJSObjectContent(t)||(this.builtins.jsObject[r]=e),t}},{key:"setBuiltInPort",value:function(r,e){var n,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=M.Port("built-in",r,null,null,null!==(n=e.binary)&&void 0!==n&&n.call(e)?[]:"");return!t&&this.getBuiltInPort(r)||(this.builtins.port[r]=e),a}},{key:"setBuiltInLibrary",value:function(r,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!n&&this.getBuiltInPort(r)||(this.builtins.library[r]=e),M.Symbol(r)}},{key:"getProcedureContent",value:function(r){if(D.Continuation(r))return{parameters:[{name:"arg",evaluate:!0,type:"variadic"}],body:r,isMacro:!1,env:null};if(D.Parameter(r))return{parameters:[],body:r,isMacro:!1,env:null};if("lambda"===r[1]){var e=o(r,6);return{parameters:e[2],body:e[3],isMacro:e[4],env:e[5]}}var n=o(r,3)[2];if(F.call(this.builtins.procedure,n)){var t=this.builtins.procedure[n],a=t.parameters,i=t.body,u=t.isMacro;return{parameters:a,body:i,isMacro:void 0!==u&&u,env:null}}return null}},{key:"getJSObjectContent",value:function(r){if("inline"===r[1])return r[2];var e=r[2];return F.call(this.builtins.jsObject,e)?this.builtins.jsObject[e]:null}},{key:"getBuiltInPort",value:function(r){return F.call(this.builtins.port,r)?this.builtins.port[r]:null}},{key:"getBuiltInLibrary",value:function(r){return F.call(this.builtins.library,r)?this.builtins.library[r]:null}},{key:"defineStatic",value:function(r,e,n){var t=e[3]?e[3]:e[1];return r=e[2]?e[2]:r,B(r)[t]=n,t}},{key:"defineDynamic",value:function(r,e,n){return B(r)[e]=n,e}},{key:"setStatic",value:function(r,e,n){for(var t=e[3]?e[3]:e[1],a=r=e[2]?e[2]:r;null!==a;a=O(a)){var o=B(a);if(F.call(o,t))return o[t]=n}return null}},{key:"setDynamic",value:function(r,e,n){for(var t=r;null!==t;t=O(t)){var a=B(t);if(F.call(a,e))return a[e]=n}return null}},{key:"getStatic",value:function(r,e){for(var n=e[3]?e[3]:e[1],t=r=e[2]?e[2]:r;null!==t;t=O(t)){var a=B(t);if(F.call(a,n))return a[n]}return F.call(this.builtins.static,n)?this.builtins.static[n]:F.call(this.builtins.procedure,n)&&!this.builtins.procedure[n].hidden?["<procedure>","built-in",n]:null}},{key:"getDynamic",value:function(r,e){for(var n=r;null!==n;n=O(n)){var t=B(n);if(F.call(t,e))return t[e]}return F.call(this.builtins.dynamic,e)?this.builtins.dynamic[e]:null}},{key:"eval",value:function(r){return this.evalAST(cr(r))}},{key:"evalJS",value:function(r){return this.evalAST(T.Begin(ur(r)))}},{key:"resume",value:function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.Undefined();if(Y(r)&&!rr(r))throw new Error("The content of envelope is not #SUSPEND# object.");var n=rr(r)?r.content[1]:r[1];return this.evalAST(T.Begin(T.Call(n,e)))}},{key:"evalAST",value:function(r){var e,n=(e=r,["#CALL-STACK#",{depth:0,env:{static:M.StaticNS({},null),dynamic:M.DynamicNS({},null)},expr:e,want:null,oper:null,args:null,before:null,after:null,handler:null,info:D.Pair(e)&&e[4]||null},null]),t=null;try{for(var a=n;a;){var i,u;if(k(a).depth>(null!==(i=this.options.stack)&&void 0!==i?i:16384))throw new Error("Call-stack overflow.");if(this.options.beforeExecute){var c,l=o(null!==(c=this.options.beforeExecute(a,t))&&void 0!==c?c:[a,t],2);a=l[0],t=l[1]}this.options.debug&&ea.log("Executing(".concat(null!==(u=a[1].want)&&void 0!==u?u:"initial","/depth:").concat(a[1].depth,") ").concat(N(a[1].expr)));var f=o(this.execute(a,t),2),s=f[0],m=f[1];if(this.options.debug){var p,v=s?C(s)===a?"wind":C(a)===s?"unwind":C(s)==C(s)?"transfer":"unknown":"finish";ea.log("Result: ".concat(m?N(m):m," (").concat(v,").")),s&&this.options.verbose&&ea.log("Next(".concat(null!==(p=s[1].want)&&void 0!==p?p:"initial","/depth:").concat(s[1].depth,") ").concat(N(s[1].expr)))}this.options.afterExecute&&this.options.afterExecute(s,m,a,t),a=s,t=m}}catch(r){if(D.Exception(r)){var d=o(r,3),b=d[1],g=d[2],h=o(D.Error(g)?g:[null,"exception",N(g)],3),w=h[1],j=h[2],S=A(b).map((function(r){var e=o(r,2)[1],n=e.depth,t=e.want,a=e.expr,i=e.info;return"".concat(n,": ").concat(null!=t?t:"initial",": ").concat(N(a,{maxdepth:20}).slice(0,100),": ").concat(JSON.stringify(i))})).join("\n")+"\n";throw this.options.debug&&ea.log("UNHANDLED ERROR: ".concat(w,", ").concat(j,"\n").concat(S)),Object.assign(new Error,{name:w,message:null!=j?j:w,stack:S})}if(D.Object(r)||D.SpecialObject(r))throw{language:y,version:"0.5.5",content:r};throw r}if(!t)throw new Error("AST didn't return value");return t}},{key:"execute",value:function(r,t){var i,c=function(r){var n=k(r),t=n.args;return["#CALL-STACK#",e(e({},n),{},{args:t?u(t):null}),C(r)]}(r),l=k(c),f=l.expr;try{if(t){if("return"===l.want)return[C(c),t];if("macro"===l.want)return[L(c,t),null]}if(null===l.want){if(t)throw M.Error("internal-error",'Call-frame was given a value without any want. "'.concat(l.want,'"'));if(D.Symbol(f)){var s,m=this.getStatic(null!==(s=f[2])&&void 0!==s?s:k(c).env.static,f);if(m)return[C(c),m];throw M.Error("unbound-variable","".concat(f[1]," is not defined."))}if(D.Null(f))throw M.Error("program-error","Evaluating an empty list is an error in Scheme.");if(!D.Pair(f))return[C(c),f];l.want="oper"}if(!D.Pair(f))throw M.Error("internal-error","Illegal status of call-frame. frane.want is not null, but expr is not a <pair>.");if("oper"===l.want)if(t){if(!D.Procedure(t))throw M.Error("not-a-procedure","Operator evaluation didn't return a valid procedure");l.oper=t,l.want="args",t=null}else{if(!D.Procedure(f[1])){if(D.Symbol(f[1])||D.Pair(f[1]))return[z(c,f[1]),null];throw M.Error("invalid-procedure","Operator is not a valid procedure.")}l.oper=f[1],l.want="args"}if(!l.oper)throw M.Error("internal-error","Illegal status of call-frame. frame.want is not null or oper, but oper is still null.");var v=this.getProcedureContent(l.oper);if(!v)throw M.Error("program-error","Operator is not a valid procedure.");var d,b=v.parameters.filter((function(r){return!r.type||"head"===r.type})),y=v.parameters.filter((function(r){return"optional"===r.type})),g=o(v.parameters.filter((function(r){return"variadic"===r.type})),1)[0],h=v.parameters.filter((function(r){return"tail"===r.type}));if("args"===l.want)if(t?(d=[t],t=null):d=o(Z(f),1)[0].slice(1),1===d.length&&D.MultiValue(d[0])){var w=o(d,1),j=o(w[0],2)[1];if(j.length<b.length+h.length||!g&&j.length>b.length+h.length+y.length)throw M.Error("arity-error","Length of items in `multiple-value' object does not match the length of parameters.");l.args=j,l.want="return"}else{if(d.length<b.length+h.length||!g&&d.length>b.length+h.length+y.length)throw M.Error("arity-error","Length of arguments does not match the length of parameters.");var S=Math.max(0,d.length-b.length-h.length),x=Math.max(0,d.length-b.length-y.length-h.length),N=[].concat(u(b),u(y.slice(0,S)),u(Array.from({length:x},(function(){return g}))),u(h));l.args=d.map((function(r,e){var n;return(null===(n=N[e].evaluate)||void 0===n||n)&&D.Evaluatable(r)?null:r})),l.want=-1}if(!l.args)throw M.Error("internal-error","Invalid status of call-frame. frame.want is not null, oper or args, but frame.args is still null.");if("number"==typeof l.want){t&&(l.args[l.want]=t,t=null);for(var E=0,P=l.args[E];E<l.args.length;P=l.args[++E])if(null===P){var I=$(f).slice(1);return l.want=E,[z(c,I[E]),null]}l.want="return"}if(!D.Objects(l.args))throw M.Error("internal-error","Invalid status of call-frame. frame.args contains non-objects.");var Q=l.args,R=Math.max(0,Q.length-b.length-h.length),q=Math.max(0,Q.length-b.length-y.length-h.length),U=[].concat(u(b),u(y.slice(0,R)),u(Array.from({length:q},(function(){return g}))),u(h));if("return"===l.want){if("function"==typeof v.body){for(var J,F=g?a({},g.name,[]):{},X=0;X<U.length;X++)"variadic"===U[X].type?F[U[X].name].push(Q[X]):F[U[X].name]=Q[X];var K=this.options.acceptableJSValue,W=void 0===K?function(){return!0}:K;try{if(J=v.body(F,this,c),!D.Object(J)&&!D.CallStack(J)){if(!W(J))throw M.Error("not-acceptable-js-value",null);J=M.JS("inline",J)}}catch(r){throw D.Object(r)||D.SpecialObject(r)?D.Exception(r)||D.SpecialObject(r)?r:M.Exception(c,r,!1):r instanceof Error?r:M.Exception(c,M.JS("inline",r),!1)}return D.CallStack(J)?[J,null]:v.isMacro&&D.Evaluatable(J)?[L(c,J),null]:[C(c),J]}if(D.Continuation(v.body)){var G,H,Y=v.body,rr=A(c),er=A(Y[1]).reverse(),nr=new Set(er),tr=null!==(G=rr.find((function(r){return nr.has(r)})))&&void 0!==G?G:null,ar=rr.slice(0,rr.indexOf(tr)),or=er.slice(er.indexOf(tr)+1),ir=1===Q.length?Q[0]:M.MultiValue(Q),ur=p(ar);try{for(ur.s();!(H=ur.n()).done;){var cr=H.value,lr=k(cr).after;if(lr){var fr=T.Begin(T.Call(lr),T.Call(Y,M.MultiValue([ir])));return[L(cr,fr,{before:null,after:null}),null]}}}catch(r){ur.e(r)}finally{ur.f()}var sr,mr=p(or);try{for(mr.s();!(sr=mr.n()).done;){var pr=sr.value,vr=k(pr).before;if(vr){var dr=T.Begin(T.Call(vr),T.Call(Y,M.MultiValue([ir])));return[z(pr,dr),null]}}}catch(r){mr.e(r)}finally{mr.f()}return[Y[1],ir]}if(D.Parameter(v.body)){var br=this.getDynamic(k(c).env.dynamic,v.body[1]);if(!br)throw M.Error("unbound-variable","Parameter is not defined.");return[C(c),br]}for(var yr=k(r).env.dynamic,gr=V(v.env.static),hr=[],wr=0;wr<U.length;wr++)"variadic"!==U[wr].type?this.defineStatic(gr,M.Symbol(U[wr].name),Q[wr]):hr.push(Q[wr]);return g&&this.defineStatic(gr,M.Symbol(g.name),_(hr)),v.isMacro?(k(c).want="macro",[z(c,v.body,{env:{static:gr,dynamic:yr}}),null]):[L(c,v.body,{env:{static:gr,dynamic:yr}}),null]}throw M.Error("internal-error","Illegal status (want) of call-frame: ".concat(l.want))}catch(r){if(r=D.Error(r)?M.Exception(c,r,!1):r,D.Exception(r)){var jr=o(r,4),Sr=jr[1],xr=jr[2],Nr=jr[3];if(l.handler){var Er=B(l.handler);if(Nr){var Pr=M.Continuation(C(Sr)),Ir=T.Call(Pr,T.Call(Er,M.MultiValue([xr])));return[L(Sr,Ir,{handler:O(l.handler)}),null]}var Or=T.Raise(T.Call(Er,M.MultiValue([xr])));return[L(Sr,Or,{handler:O(l.handler)}),null]}throw r}if(D.JS(r)&&"built-in"===r[1]&&(i=r[2])&&("object"===n(i)||"function"==typeof i)&&"function"==typeof i.then){var Br=M.JSPromiseContinuation(M.Continuation(c),r[2],"pending");throw r[2].then((function(){return Br[3]="fulfilled"}),(function(){return Br[3]="rejected"})),Br}throw r}}}])&&t(i.prototype,c),l&&t(i,l),r}();exports.Interpreter=na,exports.arrayToList=_,exports.assert=q,exports.create=M,exports.defineBuiltInProcedure=K,exports.defineBuiltInProcedureAlias=W,exports.forkCS=z,exports.forms=T,exports.fromJS=ur,exports.fromReferentialJSON=function(r,e){var t=JSON.parse(r),a=new Map;!function r(t){t instanceof Array&&t[0]===e&&t.length>=3?(a.set(t[1],t[2]),Object.keys(t[2]).forEach((function(e){return r(t[2][e])}))):"object"===n(t)&&null!==t&&Object.keys(t).forEach((function(e){return r(t[e])}))}(t);return function r(t){if(t instanceof Array&&t[0]===e&&a.has(t[1])){if(t.length>=3){var o=t[2];if(o instanceof Array)return o.splice.apply(o,[0,o.length].concat(u(o.map((function(e){return r(e)}))))),o;var i=Object.keys(o).reduce((function(e,n){return e[n]=r(o[n]),e}),{});return Object.assign(o,i)}return a.get(t[1])}return t instanceof Array?t.map((function(e){return r(e)})):"object"===n(t)&&null!==t?Object.keys(t).reduce((function(e,n){return e[n]=r(t[n]),e}),{}):t}(t)},exports.is=D,exports.isCurrentVersionEnvelope=function(r){return!!r&&"object"===n(r)&&r.language===y&&"0.5.5"===r.version&&(D.Object(r.content)||D.SpecialObject(r.content))},exports.isEnvelope=Y,exports.isSuspendEnvelope=rr,exports.listToArray=$,exports.pairToArrayWithEnd=Z,exports.parser=cr,exports.suspendValueFromEnvelope=function(r){return r.content[2]},exports.toJS=function(r){return x(r,{extended:!0})},exports.toReferentialJSON=function(r,e){var t=new Set,a=new Set;!function r(o){if(o instanceof Array&&o[0]===e){var i=new Error('ReferenceTag "'.concat(e,'" is already contained in the value.'));throw i.name="reference-tag",i}if("object"!==n(o)||null===o){if("number"!=typeof o||!Number.isNaN(o)&&Number.isFinite(o)){if(null===o||"boolean"==typeof o||"string"==typeof o||"number"==typeof o)return;throw new Error("Unserializable object: <".concat(n(o),">"))}throw new Error("JSON can't contain Infinite/-Infinite/NaN")}var u,c,l=null===(u=o.constructor)||void 0===u?void 0:u.name;if("Object"!==l&&"Array"!==l)throw new Error("Unserializable object: <".concat(n(o)," ").concat(null===(c=o.constructor)||void 0===c?void 0:c.name,">"));t.has(o)?a.has(o)||a.add(o):(t.add(o),Object.keys(o).forEach((function(e){return r(o[e])})))}(r),t.clear();var o=new Map,i=function r(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!i&&o.has(t)?[e,o.get(t)]:!i&&a.has(t)?(o.set(t,o.size+1),[e,o.get(t),r(t,!0)]):t instanceof Array?t.map((function(e){return r(e)})):"object"===n(t)&&null!==t?Object.keys(t).reduce((function(e,n){return e[n]=r(t[n]),e}),{}):t}(r);return a.clear(),o.clear(),JSON.stringify(i)},exports.transferCS=L,exports.unparser=E,exports.wrapBuiltInProcedure=function(r){var e=r.name,n=r.parameters,t=r.body,a=r.isMacro,o=r.hidden,i=console;return{name:e,parameters:n,body:function(r,o,u){var c;i.log('-----[Built-in Procedure Call "'.concat(e,'"]-----\n')+"Is".concat(a?"":" NOT"," a macro procedure.\n")+"-----[Parameters]-----\n"+n.map((function(e,n){var t=r[e.name];return D.Object(t)?"".concat(n,":").concat(e.name,": ").concat(N(t,{maxdepth:20}),"\n"):t instanceof Array?"".concat(n,":").concat(e.name,":length ").concat(t.length,"}\n")+t.map((function(r,e){return" [".concat(e,"]: ").concat(N(r,{maxdepth:20}),"\n")})).join(""):"".concat(n,":").concat(e.name,": ").concat(t,"\n")})).join("")+" --------------------------------------------\nCalling now...\n");try{c=t(r,o,u)}catch(r){throw i.log("-----[Exception]-----\n"+"Exception is".concat(D.Object(r)?"":" NOT"," a LISP Object.\n")+(D.Object(r)?N(r,{maxdepth:20}):"".concat(r))+"\n-----------------------"),r}return i.log("-----[Return]-----\n"+"Return value is ".concat(D.Object(c)?"":"NOT"," a LISP Object.\n")+(D.Object(c)?N(c,{maxdepth:20}):"".concat(c))+"\n-----------------------"),c},isMacro:a,hidden:o}},exports.writeObject=N;
